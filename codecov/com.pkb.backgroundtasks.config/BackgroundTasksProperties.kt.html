<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BackgroundTasksProperties.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">E2E Tests Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.pkb.backgroundtasks.config</a> &gt; <span class="el_source">BackgroundTasksProperties.kt</span></div><h1>BackgroundTasksProperties.kt</h1><pre class="source lang-java linenums">package com.pkb.backgroundtasks.config

import com.pkb.backgroundtasks.entity.AccountTaskType
import com.pkb.entities.enums.UploadedDataDestination
import org.springframework.boot.context.properties.ConfigurationProperties
import org.springframework.boot.context.properties.ConstructorBinding
import org.springframework.cloud.context.config.annotation.RefreshScope
import java.time.Duration

<span class="fc" id="L10">@ConstructorBinding</span>
@ConfigurationProperties(prefix = &quot;backgroundtasks&quot;)
@RefreshScope
<span class="fc" id="L13">data class BackgroundTasksProperties(</span>
<span class="pc" id="L14">    val phrUrl: String = &quot;http://pkb-frontend&quot;,</span>
<span class="fc" id="L15">    val keyAvailableForAccountMigrationsSubscriptionName: String = &quot;keyAvailableAccountMigrations-backgroundtasks&quot;,</span>
<span class="fc" id="L16">    val grantOrgAccessRequestSubscriptionName: String = &quot;grantOrgAccessRequest-backgroundtasks&quot;,</span>
<span class="fc" id="L17">    val grantAccessToOrgRequestSubscriptionName: String = &quot;grantAccessToOrgRequest-backgroundtasks&quot;,</span>
<span class="fc" id="L18">    val aggregatedUpdateSubscriptionName: String = &quot;aggregatedUpdateNotification-backgroundtasks&quot;,</span>
<span class="pc" id="L19">    val apiAuthSessionCleanUp: ApiAuthSessionCleanUpProperties = ApiAuthSessionCleanUpProperties(),</span>
<span class="pc" id="L20">    val uploadedData: UploadedDataProperties = UploadedDataProperties(),</span>
<span class="pc" id="L21">    val accountTasks: AccountTaskServiceProperties = AccountTaskServiceProperties(),</span>
<span class="fc" id="L22">    val ehrMigrationsMigrator: EhrMigrationsMigratorProperties = EhrMigrationsMigratorProperties(),</span>
<span class="pc" id="L23">    val migrateDocuments: MigrateDocumentsProperties = MigrateDocumentsProperties(),</span>
<span class="pc" id="L24">    val gcsDocumentDeletion: GcsDocumentDeletionProperties = GcsDocumentDeletionProperties(),</span>
<span class="pc" id="L25">    val deleteOrphanedGcsDocuments: DeleteOrphanedGcsDocumentsProperties = DeleteOrphanedGcsDocumentsProperties(),</span>
<span class="fc" id="L26">    val nhsNotificationRetry: NHSNotificationRetryProperties = NHSNotificationRetryProperties(),</span>
<span class="pc" id="L27">    val recordsService: WayfinderRecordsServiceProperties = WayfinderRecordsServiceProperties(),</span>
<span class="fc" id="L28">    val fakeGcsHost: String = &quot;http://gcs:4443&quot;,</span>

    /* In case we access any external services using our service account in keycloak */
<span class="fc" id="L31">    val keycloakRealm: String = &quot;pkb&quot;,</span>
<span class="pc" id="L32">    val keycloakUrl: String = &quot;http://keycloak:8080&quot;,</span>
<span class="fc" id="L33">    val keycloakClientId: String = &quot;backgroundtasks&quot;,</span>
<span class="pc" id="L34">    val keycloakClientSecret: String = &quot;&quot;,</span>
<span class="fc" id="L35">)</span>

<span class="fc" id="L37">data class UploadedDataProperties(</span>
<span class="fc" id="L38">    val batchSize: Int = 5,</span>
<span class="fc" id="L39">    val requestTimeoutSeconds: Long = 60,</span>
<span class="pc" id="L40">    val enabled: Boolean = false,</span>
<span class="pc" id="L41">    val destinations: List&lt;UploadedDataDestination&gt; = emptyList(),</span>
<span class="fc" id="L42">    val maxConcurrency: Int = 25</span>
<span class="fc" id="L43">)</span>

<span class="pc" id="L45">data class ApiAuthSessionCleanUpProperties(</span>
<span class="pc" id="L46">    val clientApiIds: List&lt;String&gt; = listOf(&quot;pkb-spa-user&quot;),</span>
<span class="pc" id="L47">    val retentionPeriodDays: Long = 14L</span>
<span class="nc" id="L48">)</span>

<span class="fc" id="L50">data class AccountTaskServiceProperties(</span>
<span class="fc" id="L51">    val enabled: Boolean = true,</span>
<span class="pc" id="L52">    val disabledTasks: List&lt;AccountTaskType&gt; = emptyList(),</span>
<span class="fc" id="L53">    val pageSize: Int = 300,</span>
<span class="pc" id="L54">    val loopRateMs: Int = 300000</span>
<span class="fc" id="L55">)</span>

<span class="fc" id="L57">data class EhrMigrationsMigratorProperties(</span>
<span class="fc" id="L58">    val pageSize: Int = 300</span>
<span class="fc" id="L59">)</span>

<span class="pc" id="L61">data class MigrateDocumentsProperties(</span>
<span class="pc" id="L62">    val batchSize: Int = 100,</span>
<span class="pc" id="L63">    val requestTimeoutSeconds: Long = 60,</span>
<span class="pc" id="L64">    val fixedDelay: Long = 3600000,</span>
<span class="pc" id="L65">    val initialDelay: Long = 600000,</span>
<span class="pc" id="L66">    val enabled: Boolean = false</span>
<span class="nc" id="L67">)</span>

<span class="pc" id="L69">data class GcsDocumentDeletionProperties(</span>
<span class="pc" id="L70">    val requestTimeoutSeconds: Long = 60,</span>
<span class="pc" id="L71">    val fixedDelay: Long = 3600000,</span>
<span class="pc" id="L72">    val initialDelay: Long = 600000,</span>
<span class="pc" id="L73">    val enabled: Boolean = false</span>
<span class="nc" id="L74">)</span>

<span class="pc" id="L76">data class DeleteOrphanedGcsDocumentsProperties(</span>
<span class="pc" id="L77">    val requestTimeoutSeconds: Long = 60,</span>
<span class="pc" id="L78">    val fixedDelay: Long = 3600000,</span>
<span class="pc" id="L79">    val initialDelay: Long = 600000,</span>
<span class="pc" id="L80">    val enabled: Boolean = false</span>
<span class="nc" id="L81">)</span>

<span class="fc" id="L83">data class NHSNotificationRetryProperties(</span>
<span class="pc" id="L84">    val recordExpiryInterval: Duration = Duration.ofDays(14)</span>
<span class="fc" id="L85">)</span>

<span class="fc" id="L87">data class WayfinderRecordsServiceProperties(</span>
<span class="pc" id="L88">    val enabled: Boolean = false,</span>
    /* Configuration for communicating with Servita's Wayfinder Records Service */
<span class="pc" id="L90">    val requestUrl: String = &quot;http://fakehttp-server/fake-records-service&quot;,</span>
<span class="fc" id="L91">    val clientId: String = &quot;pkb&quot;,</span>
<span class="fc" id="L92">    val apiKey: String = &quot;&quot;,</span>
    /* URL of FHIR server which contains records we might notify Wayfinder Records Service about */
<span class="pc" id="L94">    val aidboxUrl: String = &quot;http://aggregated.multibox:8080&quot;,</span>
    // bulk load configuration
<span class="pc" id="L96">    val bulkLoaderEnabled: Boolean = false,</span>
<span class="pc" id="L97">    val bulkLoaderBatchSize: Int = 5000,</span>
<span class="fc" id="L98">    val bulkLoaderVerboseLogging: Boolean = false,</span>
<span class="pc" id="L99">    val wayfinderOnboardedTrustOdsCodes: List&lt;String&gt; = mutableListOf(),</span>
<span class="fc" id="L100">)</span>

/**
 * This is a bit of a hack, but it's better than any alternative I've found so far.
 * If you want to access spring properties from an annotation using SpEL you can
 * either (a)  reference the properties directly as named in the properties file
 * or (b) access them by referencing the properties bean from the app context.
 *
 * The downside of (a) is that you skip out a lot of useful parts of spring
 * property handling - environment hookup etc - because it's connected directly
 * to the properties sources rather than the abstract properties mechanism that
 * sits on top of them.
 *
 * The problem with (b) is that spring gives properties beans bound with
 * @ConfigurationProperties funky names that are hard to reference from a SpEL
 * expression. By creating an instance of this wrapper as a bean we put something
 * into the context that has a predictable name that is easy to reference from
 * an annotation.
 */
<span class="pc" id="L119">data class PropsWrapper(val props: BackgroundTasksProperties)</span>
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>