<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AppointmentDTO.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">E2E Tests Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.pkb.calendar.entity</a> &gt; <span class="el_source">AppointmentDTO.java</span></div><h1>AppointmentDTO.java</h1><pre class="source lang-java linenums">package com.pkb.calendar.entity;

import com.pkb.annotation.EHRField;
import com.pkb.annotation.EHRField.QueryField;
import com.pkb.app.dto.DTOBaseFields;
import com.pkb.app.entity.SourceDetails;
import com.pkb.app.interfaces.IBaseDTO;
import com.pkb.entities.enums.AppointmentStatus;
import com.pkb.entities.enums.MenuDataType;
import org.apache.commons.lang3.StringUtils;
import org.jetbrains.annotations.Nullable;

import java.io.Serializable;
import java.time.Instant;
import java.util.ArrayList;
import java.util.List;
import java.util.Optional;

/**
 * A calendar appointment
 *
 * @author robwhelan
 */
public class AppointmentDTO implements IBaseDTO, Comparable&lt;AppointmentDTO&gt;, Serializable {
    private static final long serialVersionUID = 1L;

<span class="fc" id="L27">    public static final MenuDataType MS_PATH = MenuDataType.appointment;</span>

    // non-encrypted
    public final static String COMMON_ID = &quot;commonId&quot;;
    public final static String START_TIMESTAMP = &quot;startTimestamp&quot;;
    public final static String END_TIMESTAMP = &quot;endTimestamp&quot;;
    public final static String TYPE_CODE = &quot;typeCode&quot;;
    public final static String STATUS = &quot;status&quot;;

    @EHRField(queryField = QueryField.id)
    private Long id;

    /**
     * common ID for this appointment across accounts
     */
    @EHRField(queryField = QueryField.string01)
    private String commonId;

    /**
     * the patient in this appointment (only one possible)
     */
    @EHRField
    private String patientId;

    /**
     * like labOrderId for test results - the identifier from the source (HL7)
     */
    @EHRField(queryField = QueryField.string03)
    private String externalId;

    /**
     * some hospitals use codes to categorize appointments
     */
    @EHRField(queryField = QueryField.code01Code)
    private String typeCode;
    @EHRField(queryField = QueryField.code01CodeSystem)
    private String typeCodingSystem;

    // this copy of this appt belongs to... (not persisted to menudata)
    private String personId;

    @EHRField(queryField = QueryField.date01)
    private Instant startTimestamp;
    @EHRField(queryField = QueryField.date02)
    private Instant endTimestamp;

    @EHRField
    private String subject;
    @EHRField
    private String location;
    @EHRField
    private String description;

    @EHRField(queryField = QueryField.string02)
    private AppointmentStatus status;

    // TODO: Why is this value here? See PHR-5211.
    @EHRField
    private String updatedSpeciality;

    @EHRField
    private List&lt;String&gt; nonPkbParticipants;

    @EHRField(queryField = QueryField.string04)
    private String appointmentRequestConversationId;

    private List&lt;AppointmentRequestDTO&gt; appointmentRequestList;
<span class="fc" id="L94">    private DTOBaseFields baseFields = new DTOBaseFields();</span>
    private SourceDetails source;

    private Boolean emisAppointmentLive;
    private Long emisSlotId;

    private boolean returnToAppointment; // After editing privacy, go back to appointment OR list

    /**
     * DELIBERATELY PROTECTED DO NOT CHANGE! Use the available constructors!
     * &lt;p&gt;
     * Would have even less visibility but JPA spec &amp; Hibernate requires a no arg const. which is public or protected.
     * Other than those, nothing should be able to construct without parameters, as changelog wouldn't be filled correctly etc.
     */
<span class="fc" id="L108">    protected AppointmentDTO() {</span>
<span class="fc" id="L109">        this.source = new SourceDetails();</span>
<span class="fc" id="L110">    }</span>

<span class="fc" id="L112">    public AppointmentDTO(SourceDetails sourceDetails) {</span>
<span class="fc" id="L113">        this.source = sourceDetails;</span>
<span class="fc" id="L114">    }</span>

    public String getParticipantIdSetCsv() {
<span class="nc" id="L117">        List&lt;String&gt; pIdList = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L118" title="All 2 branches missed.">        for (AppointmentRequestDTO r : getAppointmentRequestList()) {</span>
<span class="nc" id="L119">            pIdList.add(r.getParticipantId());</span>
<span class="nc" id="L120">        }</span>

<span class="nc" id="L122">        return StringUtils.join(pIdList, &quot;,&quot;);</span>
    }

    @Nullable
    public AppointmentRequestDTO getAppointmentRequestByCommonId(String commonId) {
<span class="fc bfc" id="L127" title="All 2 branches covered.">        for (AppointmentRequestDTO req : getAppointmentRequestList()) {</span>
<span class="fc bfc" id="L128" title="All 2 branches covered.">            if (req.getCommonId().equals(commonId)) {</span>
<span class="fc" id="L129">                return req;</span>
            }
<span class="fc" id="L131">        }</span>
<span class="fc" id="L132">        return null; // not found</span>
    }

    @Override
    public int compareTo(AppointmentDTO o) {
<span class="nc" id="L137">        int startCompare = compareNullables(startTimestamp, o.getStartTimestamp());</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">        if (startCompare != 0) {</span>
<span class="nc" id="L139">            return startCompare;</span>
        }

<span class="nc" id="L142">        return compareNullables(endTimestamp, o.getEndTimestamp());</span>
    }

    private int compareNullables(Comparable c1, Comparable c2) {
<span class="nc bnc" id="L146" title="All 4 branches missed.">        if ((c1 == null) &amp;&amp; (c2 == null)) {</span>
<span class="nc" id="L147">            return 0;</span>
<span class="nc bnc" id="L148" title="All 2 branches missed.">        } else if (c1 == null) {</span>
<span class="nc" id="L149">            return -1;</span>
<span class="nc bnc" id="L150" title="All 2 branches missed.">        } else if (c2 == null) {</span>
<span class="nc" id="L151">            return 1;</span>
        } else {
<span class="nc" id="L153">            return c1.compareTo(c2);</span>
        }
    }

    @Override
    public Long getId() {
<span class="fc" id="L159">        return id;</span>
    }

    @Override
    public void setId(Long id) {
<span class="fc" id="L164">        this.id = id;</span>
<span class="fc" id="L165">    }</span>

    public String getPersonId() {
<span class="nc" id="L168">        return personId;</span>
    }

    public void setPersonId(String personId) {
<span class="fc" id="L172">        this.personId = personId;</span>
<span class="fc" id="L173">    }</span>

    public Instant getStartTimestamp() {
<span class="fc" id="L176">        return startTimestamp;</span>
    }

    public void setStartTimestamp(Instant startTimestamp) {
<span class="fc" id="L180">        this.startTimestamp = startTimestamp;</span>
<span class="fc" id="L181">    }</span>

    public Instant getEndTimestamp() {
<span class="fc" id="L184">        return endTimestamp;</span>
    }

    public void setEndTimestamp(Instant endTimestamp) {
<span class="fc" id="L188">        this.endTimestamp = endTimestamp;</span>
<span class="fc" id="L189">    }</span>

    public String getSubject() {
<span class="fc" id="L192">        return subject;</span>
    }

    public void setSubject(String subject) {
<span class="fc" id="L196">        this.subject = subject;</span>
<span class="fc" id="L197">    }</span>

    public String getLocation() {
<span class="fc" id="L200">        return location;</span>
    }

    public void setLocation(String location) {
<span class="fc" id="L204">        this.location = location;</span>
<span class="fc" id="L205">    }</span>

    public String getDescription() {
<span class="fc" id="L208">        return description;</span>
    }

    public void setDescription(String description) {
<span class="fc" id="L212">        this.description = description;</span>
<span class="fc" id="L213">    }</span>

    public List&lt;String&gt; getNonPkbParticipants() {
<span class="fc bfc" id="L216" title="All 2 branches covered.">        if (nonPkbParticipants == null) {</span>
<span class="fc" id="L217">            nonPkbParticipants = new ArrayList&lt;&gt;();</span>
        }

<span class="fc" id="L220">        return nonPkbParticipants;</span>
    }

    public void setNonPkbParticipants(List&lt;String&gt; nonPkbParticipants) {
<span class="fc" id="L224">        this.nonPkbParticipants = nonPkbParticipants;</span>
<span class="fc" id="L225">    }</span>

    public List&lt;AppointmentRequestDTO&gt; getAppointmentRequestList() {
<span class="fc bfc" id="L228" title="All 2 branches covered.">        if (appointmentRequestList == null) {</span>
<span class="fc" id="L229">            appointmentRequestList = new ArrayList&lt;&gt;();</span>
        }

<span class="fc" id="L232">        return appointmentRequestList;</span>
    }

    public void setAppointmentRequestList(
            List&lt;AppointmentRequestDTO&gt; appointmentRequestList) {
<span class="fc" id="L237">        this.appointmentRequestList = appointmentRequestList;</span>
<span class="fc" id="L238">    }</span>

    public String getCommonId() {
<span class="fc" id="L241">        return commonId;</span>
    }

    public void setCommonId(String commonId) {
<span class="fc" id="L245">        this.commonId = commonId;</span>
<span class="fc" id="L246">    }</span>

    public String getTypeCode() {
<span class="fc" id="L249">        return typeCode;</span>
    }

    public void setTypeCode(String typeCode) {
<span class="fc" id="L253">        this.typeCode = typeCode;</span>
<span class="fc" id="L254">    }</span>

    public String getTypeCodingSystem() {
<span class="fc" id="L257">        return typeCodingSystem;</span>
    }

    public void setTypeCodingSystem(String typeCodingSystem) {
<span class="fc" id="L261">        this.typeCodingSystem = typeCodingSystem;</span>
<span class="fc" id="L262">    }</span>

    public String getPatientId() {
<span class="fc" id="L265">        return patientId;</span>
    }

    public void setPatientId(String patientId) {
<span class="fc" id="L269">        this.patientId = patientId;</span>
<span class="fc" id="L270">    }</span>

    public String getUpdatedSpeciality() {
<span class="fc" id="L273">        return updatedSpeciality;</span>
    }

    public void setUpdatedSpeciality(String updatedSpeciality) {
<span class="fc" id="L277">        this.updatedSpeciality = updatedSpeciality;</span>
<span class="fc" id="L278">    }</span>

    @Override
    public SourceDetails getSource() {
<span class="fc" id="L282">        return source;</span>
    }

    @Override
    public DTOBaseFields getBaseFields() {
<span class="fc" id="L287">        return baseFields;</span>
    }

    public String getExternalId() {
<span class="fc" id="L291">        return externalId;</span>
    }

    public void setExternalId(String externalId) {
<span class="fc" id="L295">        this.externalId = externalId;</span>
<span class="fc" id="L296">    }</span>

    public AppointmentStatus getStatus() {
<span class="fc" id="L299">        return status;</span>
    }

    public void setStatus(AppointmentStatus status) {
<span class="fc" id="L303">        this.status = status;</span>
<span class="fc" id="L304">    }</span>

    public boolean isCancelledAppointment() {
<span class="fc bfc" id="L307" title="All 2 branches covered.">        return this.status == AppointmentStatus.CANCELLED;</span>
    }

    public boolean isDidNotAttendAppointment() {
<span class="fc bfc" id="L311" title="All 2 branches covered.">        return this.status == AppointmentStatus.DNA;</span>
    }

    public boolean isNotActive() {
<span class="fc bfc" id="L315" title="All 2 branches covered.">        return status != AppointmentStatus.ACTIVE;</span>
    }

    public boolean isEmptySpeciality() {
<span class="nc" id="L319">        return StringUtils.isBlank(updatedSpeciality);</span>
    }

    public boolean isEmptyLocation() {
<span class="nc" id="L323">        return StringUtils.isBlank(location);</span>
    }

    public boolean isCompleteInfo() {
<span class="nc bnc" id="L327" title="All 4 branches missed.">        return !isEmptySpeciality() &amp;&amp; !isEmptyLocation();</span>
    }

    public boolean isAttendedByNonPKBParticipants() {
<span class="pc bpc" id="L331" title="1 of 4 branches missed.">        return getNonPkbParticipants() != null &amp;&amp; !getNonPkbParticipants().isEmpty();</span>
    }

    public Optional&lt;String&gt; getNonPkbParticipantsNames() {
<span class="fc" id="L335">        List&lt;String&gt; participants = getNonPkbParticipants();</span>

<span class="pc bpc" id="L337" title="1 of 4 branches missed.">        if (participants == null || participants.isEmpty()) {</span>
<span class="fc" id="L338">            return Optional.empty();</span>
        }

<span class="fc bfc" id="L341" title="All 2 branches covered.">        if (participants.size() == 1) {</span>
<span class="fc" id="L342">            return Optional.of(participants.get(0));</span>
        }

<span class="fc" id="L345">        int last = participants.size() - 1;</span>
<span class="fc" id="L346">        return Optional.of(String.join(&quot; &amp; &quot;,</span>
<span class="fc" id="L347">                String.join(&quot;, &quot;, participants.subList(0, last)),</span>
<span class="fc" id="L348">                participants.get(last)));</span>
    }

    public void setEmisAppointmentLive(boolean emisAppointmentLive) {
<span class="fc" id="L352">        this.emisAppointmentLive = emisAppointmentLive;</span>
<span class="fc" id="L353">    }</span>

    public boolean isEmisAppointmentLive() {
<span class="fc" id="L356">        return emisAppointmentLive;</span>
    }

    public void setSource(SourceDetails source) {
<span class="fc" id="L360">        this.source = source;</span>
<span class="fc" id="L361">    }</span>

    public Long getEmisSlotId() {
<span class="fc" id="L364">        return emisSlotId;</span>
    }

    public void setEmisSlotId(Long emisSlotId) {
<span class="fc" id="L368">        this.emisSlotId = emisSlotId;</span>
<span class="fc" id="L369">    }</span>

    public void setAppointmentRequestConversationId(String appointmentRequestConversationId) {
<span class="fc" id="L372">        this.appointmentRequestConversationId = appointmentRequestConversationId;</span>
<span class="fc" id="L373">    }</span>

    public String getAppointmentRequestConversationId() {
<span class="fc" id="L376">        return appointmentRequestConversationId;</span>
    }

    public boolean isReturnToAppointment() {
<span class="fc" id="L380">        return returnToAppointment;</span>
    }

    public void setReturnToAppointment(boolean returnToAppointment) {
<span class="fc" id="L384">        this.returnToAppointment = returnToAppointment;</span>
<span class="fc" id="L385">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>