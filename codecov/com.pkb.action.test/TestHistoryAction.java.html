<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TestHistoryAction.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">E2E Tests Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.pkb.action.test</a> &gt; <span class="el_source">TestHistoryAction.java</span></div><h1>TestHistoryAction.java</h1><pre class="source lang-java linenums">package com.pkb.action.test;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.opensymphony.xwork2.Action;
import com.pkb.action.ConsentCategoryBaseAction;
import com.pkb.action.message.ComposeMessageAction;
import com.pkb.action.support.TestHistoryTransformer;
import com.pkb.action.support.TestResultTransformer;
import com.pkb.entities.enums.MenuDataType;
import com.pkb.notification.entity.Activity;
import com.pkb.service.test.TestManager;
import com.pkb.service.user.impl.UserManager;
import com.pkb.test.IncludeDeletedResults;
import com.pkb.test.entity.LoincCommonForm;
import com.pkb.test.entity.LoincTest;
import com.pkb.test.entity.TestHistoryDTO;
import com.pkb.test.entity.TestResultDTO;
import com.pkb.test.entity.TestResultType;
import com.pkb.util.LabResultFormattingService;
import com.pkb.util.TestHistoryUtil;
import org.apache.commons.collections4.ListUtils;
import org.apache.commons.lang3.StringUtils;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;

import java.io.ByteArrayInputStream;
import java.io.InputStream;
import java.time.ZoneId;
import java.util.ArrayList;
import java.util.Collections;
import java.util.List;
import java.util.Optional;
import java.util.Set;
import java.util.stream.Collectors;

import static com.pkb.test.IncludeDeletedResults.INCLUDE_DELETED;
import static com.pkb.user.entity.PKBPerson.Lazy.CONTACTS;
import static java.nio.charset.StandardCharsets.UTF_8;
import static java.util.Optional.empty;

/**
 * Shows detailed results this user has uploaded into their account for a selected LOINC test
 *
 * @author robwhelan
 */
<span class="fc" id="L47">public class TestHistoryAction extends ConsentCategoryBaseAction {</span>

<span class="fc" id="L49">    private static final Logger LOGGER = LoggerFactory.getLogger(java.lang.invoke.MethodHandles.lookup().lookupClass());</span>

    private static final long serialVersionUID = 1L;

    private static final String BACK_TO_MY_TESTS = &quot;backToMyTests&quot;;

    private InputStream jsonInputStream;

    private int jsonContentLength;

    private TestHistoryDTO testHistory;

    private String testResultTypeIdSource; // loinc or loincMapping
    private Long testResultTypeId; // loincId or loincMappingId

    private Long selectResultId;

    private TestResultDTO resultToBeDeleted;

    private TestManager testManager;

    @Autowired
    private TestHistoryTransformer testHistoryTransformer;

    @Autowired
    private TestResultTransformer testResultTransformer;

<span class="fc" id="L76">    private final String tab = &quot;tests&quot;;</span>

<span class="fc" id="L78">    private final String subTab = &quot;laboratory&quot;;</span>

    @Autowired
    private LabResultFormattingService labResultFormattingService;

<span class="fc" id="L83">    private List&lt;TestHistoryDTO&gt; relatedTests = new ArrayList&lt;&gt;();</span>

    // For editPrivacyFlags
    private TestResultDTO testResultDTO;

    private TestHistoryUtil testHistoryUtil;

    private ObjectMapper objectMapper;

    private String discussMessage;

    private String discussTopic;

    private String setHistoryAndRelatedTests() {
<span class="fc" id="L97">        Optional&lt;TestHistoryDTO&gt; maybeHistory = findTestHistoryDTO(patientId());</span>

<span class="fc bfc" id="L99" title="All 2 branches covered.">        if (maybeHistory.map(history -&gt; history.getTestResultList().isEmpty()).orElse(true)) {</span>
<span class="fc" id="L100">            return BACK_TO_MY_TESTS;</span>
        }

<span class="fc" id="L103">        TestHistoryDTO history = maybeHistory.get();</span>

        //note - for now, we can't do anything to display form tests for tests that don't map to loinc
<span class="fc" id="L106">        LoincTest loinc = history.getLoincTest();</span>
<span class="fc bfc" id="L107" title="All 2 branches covered.">        if (loinc != null) {</span>
<span class="fc" id="L108">            loinc.setNameLocal(getText(loinc.getNameKey()));</span>
        }

<span class="fc" id="L111">        setTestHistory(history);</span>
<span class="fc" id="L112">        setRelatedTests(history);</span>
<span class="fc" id="L113">        return SUCCESS;</span>
    }

    /**
     * get full list of test results from Tolven for the given LOINC
     */
    @Override
    public String execute() {
<span class="fc" id="L121">        return setHistoryAndRelatedTests();</span>
    }

    public String fetchTestHistoryJson() {
<span class="fc" id="L125">        setHistoryAndRelatedTests();</span>

        try {
<span class="fc" id="L128">            List&lt;TestHistoryDTO&gt; historyList = ListUtils.union(Collections.singletonList(testHistory), relatedTests);</span>
<span class="fc" id="L129">            byte[] bytes = objectMapper.writeValueAsBytes(</span>
<span class="fc" id="L130">                    testHistoryUtil.getTestsDTO(getLoggedInEHRRequestContext(), loggedInUserUtil.getLoggedInUser(), historyList, getLocale(), loggedInUserUtil.getLoggedInUserPrimaryTeam(), getLocalizedDecimalFormat()));</span>
<span class="fc" id="L131">            jsonInputStream = new ByteArrayInputStream(bytes);</span>
<span class="fc" id="L132">            jsonContentLength = bytes.length;</span>
<span class="nc" id="L133">        } catch (Exception e) {</span>
<span class="nc" id="L134">            LOGGER.error(&quot;problem with JSON output for test history list&quot;, e);</span>
<span class="nc" id="L135">            jsonInputStream = new ByteArrayInputStream(Action.ERROR.getBytes(UTF_8));</span>
<span class="fc" id="L136">        }</span>

<span class="fc" id="L138">        return Action.SUCCESS;</span>
    }

    private Optional&lt;TestHistoryDTO&gt; findTestHistoryDTO(long pid) {
<span class="fc" id="L142">        Optional&lt;TestHistoryDTO&gt; maybeHistory = empty();</span>
<span class="fc bfc" id="L143" title="All 2 branches covered.">        if (TestResultType.ID_SOURCE_LOINC.equals(testResultTypeIdSource)) {</span>
<span class="fc" id="L144">            maybeHistory = retrieveTestHistory(pid, this.testResultTypeId, null, INCLUDE_DELETED);</span>
<span class="pc bpc" id="L145" title="1 of 2 branches missed.">        } else if (TestResultType.ID_SOURCE_MAPPING.equals(testResultTypeIdSource)) {</span>
<span class="fc" id="L146">            maybeHistory = retrieveTestHistory(pid, null, testResultTypeId, INCLUDE_DELETED);</span>
        } else {
<span class="nc" id="L148">            throw new IllegalStateException(&quot;testTypeIdSource required; found &quot; + testResultTypeIdSource);</span>
        }

<span class="fc" id="L151">        maybeHistory.ifPresent(historyDTO -&gt; testManager.applyLabDisciplineReferenceDataMappingsToTestHistories(List.of(historyDTO)));</span>

<span class="fc" id="L153">        return maybeHistory;</span>
    }

    private Optional&lt;TestHistoryDTO&gt; retrieveTestHistory(long pid, Long testResultTypeId, Long loincMappingId, IncludeDeletedResults includeDeleted) {
<span class="fc" id="L157">        Optional&lt;TestHistoryDTO&gt; testHistory = testManager.getTestHistory(getLoggedInEHRRequestContext(), testResultTypeId, loincMappingId, pid, includeDeleted);</span>
<span class="fc" id="L158">        return testHistory.map(testHistoryTransformer::transformTestHistory);</span>
    }

    private TestHistoryDTO getTestHistoryDTO(long pid) {
<span class="pc" id="L162">        TestHistoryDTO history = findTestHistoryDTO(pid).orElseThrow(() -&gt; new RuntimeException(&quot;Test history cannot be found!&quot;));</span>
<span class="fc bfc" id="L163" title="All 2 branches covered.">        if (history.getLoincTest() != null) {</span>
<span class="fc" id="L164">            history.getLoincTest().setNameLocal(getText(history.getLoincTest().getNameKey()));</span>
        }
<span class="fc" id="L166">        return history;</span>
    }

    private Optional&lt;TestResultDTO&gt; findTestResultDTO(long id) {
<span class="fc" id="L170">        return testManager.findExistingTestResultById(id, getLoggedInEHRRequestContext());</span>
    }

    private Optional&lt;LoincCommonForm&gt; getCommonFormForHistory(TestHistoryDTO history) {
<span class="fc" id="L174">        Optional&lt;LoincCommonForm&gt; maybeForm = Optional.empty();</span>

<span class="fc bfc" id="L176" title="All 2 branches covered.">        if (history.getLoincTest() != null) {</span>
<span class="fc" id="L177">            List&lt;LoincCommonForm&gt; forms = testManager.getLoincCommonFormsByTestId(history.getLoincTest().getId());</span>
<span class="pc bpc" id="L178" title="1 of 2 branches missed.">            if (!forms.isEmpty()) {</span>
<span class="fc" id="L179">                maybeForm = Optional.of(forms.get(0));</span>
            }
        }

<span class="fc" id="L183">        return maybeForm;</span>
    }

    /**
     * Note: Seem to be used in the post-refresh version of the lab results display only.
     */
    private void setRelatedTests(TestHistoryDTO history) {
<span class="fc" id="L190">        List&lt;TestHistoryDTO&gt; testHistories = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L191">        List&lt;Long&gt; loincTestIds = getCommonFormForHistory(history).map(this::getCommonFormTestIds).orElse(Collections.emptyList());</span>

        // PHR-7886
        // We'll maintain the current behavior for related tests i.e. service name is null if there are multiple service names for this test history
<span class="fc" id="L195">        Set&lt;String&gt; serviceNames = history.getServiceNameIfConsistent();</span>
<span class="pc bpc" id="L196" title="1 of 2 branches missed.">        String serviceName = serviceNames.size() &gt; 1 ? null : serviceNames.iterator().next();</span>

<span class="fc bfc" id="L198" title="All 2 branches covered.">        if (!loincTestIds.isEmpty()) {</span>
<span class="fc" id="L199">            testHistories = retrieveTestHistoryList(patientId(), loincTestIds, null, INCLUDE_DELETED);</span>
<span class="pc bpc" id="L200" title="1 of 2 branches missed.">        } else if (StringUtils.isNotBlank(serviceName)) {</span>
<span class="fc" id="L201">            testHistories = retrieveTestHistoryList(serviceName, patientId(), INCLUDE_DELETED);</span>
        }

<span class="fc" id="L204">        testHistories.forEach(otherHistory -&gt; {</span>
<span class="fc" id="L205">            TestResultType testType = otherHistory.getTestResultType();</span>
            // Don't include *this* LOINC test in the list of &quot;others&quot;
<span class="pc bpc" id="L207" title="1 of 4 branches missed.">            if (!(testType.getId().equals(history.getTestResultType().getId()) &amp;&amp; testType.getIdSource().equals(history.getTestResultType().getIdSource()))) {</span>
                // Only LOINC tests have i18n keys to be resolved, mappings already have literal names
<span class="fc bfc" id="L209" title="All 2 branches covered.">                if (testType.getIdSource().equals(TestResultType.ID_SOURCE_LOINC)) {</span>
<span class="fc" id="L210">                    String nameLocal = getText(otherHistory.getLoincTest().getNameKey());</span>
                    // Unlike the name, the unit is literal text, not an i18n key
<span class="fc" id="L212">                    String unit = otherHistory.getLoincTest().getUnit();</span>
<span class="pc bpc" id="L213" title="1 of 2 branches missed.">                    if (StringUtils.isNotBlank(unit)) {</span>
<span class="fc" id="L214">                        nameLocal = nameLocal + &quot; (&quot; + unit + &quot;)&quot;;</span>
                    }
<span class="fc" id="L216">                    otherHistory.getLoincTest().setNameLocal(nameLocal);</span>
                }
<span class="fc" id="L218">                relatedTests.add(otherHistory);</span>
            }
<span class="fc" id="L220">        });</span>
<span class="fc" id="L221">    }</span>

    private List&lt;TestHistoryDTO&gt; retrieveTestHistoryList(String serviceName, Long patientId, IncludeDeletedResults includeDeleted) {
<span class="fc" id="L224">        return testHistoryTransformer.transformTestHistory(testManager.getTestHistoryListByServiceName(getLoggedInEHRRequestContext(), patientId, serviceName, includeDeleted));</span>
    }

    private List&lt;TestHistoryDTO&gt; retrieveTestHistoryList(Long patientId, List&lt;Long&gt; loincTestIds, Integer lastXMonthsOfDataPerTest, IncludeDeletedResults includeDeleted) {
<span class="fc" id="L228">        return testHistoryTransformer.transformTestHistory(testManager.getTestHistoryList(getLoggedInEHRRequestContext(), patientId, loincTestIds, lastXMonthsOfDataPerTest, includeDeleted));</span>
    }

    private List&lt;Long&gt; getCommonFormTestIds(LoincCommonForm form) {
<span class="fc" id="L232">        return form.getLoincTestList().stream().map(LoincTest::getId).collect(Collectors.toList());</span>
    }

    public String discussResults() {
<span class="pc bpc" id="L236" title="1 of 2 branches missed.">        if (selectResultId == null) {</span>
<span class="nc" id="L237">            addActionError(getText(&quot;testHistoryAction.err.select_test&quot;));</span>
<span class="nc" id="L238">            return RELOAD;</span>
        }

<span class="fc" id="L241">        TestHistoryDTO history = getTestHistoryDTO(patientId());</span>

<span class="fc" id="L243">        StringBuilder msgBodyBuilder = new StringBuilder(&quot;\n\n\n&quot; + getText(&quot;testHistoryAction.txt.selected_results&quot;, new String[]{history.getTestResultType().getNameForDisplay()}));</span>
<span class="fc" id="L244">        history.findTestResult(selectResultId).ifPresent(dto -&gt; msgBodyBuilder.append(&quot;\n&quot;).append(resultToString(dto, history.getTestResultType())));</span>

<span class="fc" id="L246">        discussMessage = msgBodyBuilder.toString();</span>
<span class="fc" id="L247">        discussTopic = ComposeMessageAction.TOPIC_TEST_RESULTS;</span>

<span class="fc" id="L249">        sessionUtil.setContextRecipientId(getLoggedInEHRRequestContext());</span>
<span class="fc" id="L250">        return DISCUSS;</span>
    }

    /**
     * replicate the display logic from testHistory.jsp
     */
    public String resultToString(TestResultDTO result, TestResultType testType) {
<span class="fc" id="L257">        String s = null;</span>

<span class="fc" id="L259">        ZoneId loggedInUserTimeZone = loggedInUserUtil.getLoggedInUserZoneId();</span>
<span class="pc bpc" id="L260" title="1 of 2 branches missed.">        if (result.getBaseFields().isDeleted()) {</span>
            //testHistory.txt.withdrawn=This result was withdrawn by {0} on {1}
<span class="nc" id="L262">            s = getText(&quot;testHistory.txt.withdrawn&quot;, new String[]{result.getSource().getDisplayText(),</span>
<span class="nc bnc" id="L263" title="All 2 branches missed.">                    dateUtil.getPKBFormattedDate(result.getBaseFields().getEnteredDate() == null ? null : result.getBaseFields().getEnteredDate().toInstant(), getLocale(), loggedInUserTimeZone)});</span>
        } else {
<span class="fc" id="L265">            s = labResultFormattingService.formattedLabResultWithoutName(loggedInUserUtil.getLoggedInUserType(), result, testType);</span>
<span class="fc" id="L266">            s += &quot; - &quot; + getDateWithHHmmFormatter(loggedInUserTimeZone).format(result.getTestDate());</span>

<span class="fc bfc" id="L268" title="All 2 branches covered.">            if (result.getReplacementTimestamp() != null) {</span>
<span class="fc" id="L269">                s += getText(&quot;testHistoryAction.txt.corrected&quot;,</span>
<span class="fc" id="L270">                        new String[]{dateUtil.getPKBFormattedDate(result.getReplacementTimestamp(), getLocale(),</span>
                                loggedInUserTimeZone)});
            }
        }
<span class="fc" id="L274">        return s;</span>
    }

    public String deleteResultsForm() {
<span class="pc bpc" id="L278" title="1 of 2 branches missed.">        if (selectResultId == null) {</span>
<span class="nc" id="L279">            addActionError(getText(&quot;testHistoryAction.err.select_for_deletion&quot;));</span>
<span class="nc" id="L280">            return RELOAD;</span>
        }

        // We still need to load the full test history because deleteResultsConfirm needs the test type information,
        // which is not available from the result itself.
<span class="fc" id="L285">        setTestHistory(getTestHistoryDTO(patientId()));</span>

<span class="fc" id="L287">        Optional&lt;TestResultDTO&gt; maybeResult = findTestResultDTO(selectResultId);</span>
<span class="pc bpc" id="L288" title="1 of 2 branches missed.">        if (maybeResult.isPresent()) {</span>
<span class="fc" id="L289">            resultToBeDeleted = maybeResult.get();</span>
<span class="pc bpc" id="L290" title="1 of 2 branches missed.">            if (hasNotPermissionsToDeleteDatapoint(resultToBeDeleted, getLoggedInEHRRequestContext())) {</span>
<span class="nc" id="L291">                return RELOAD;</span>
            }
        } else {
<span class="nc" id="L294">            return RELOAD;</span>
        }

<span class="fc" id="L297">        return &quot;deleteResultsConfirm&quot;;</span>
    }

    public String deleteResults() {
<span class="pc bpc" id="L301" title="1 of 2 branches missed.">        if (selectResultId == null) {</span>
<span class="nc" id="L302">            addActionError(getText(&quot;testHistoryAction.err.select_for_deletion&quot;));</span>
<span class="nc" id="L303">            return RELOAD;</span>
        }

<span class="fc" id="L306">        Optional&lt;TestResultDTO&gt; maybeResult = findTestResultDTO(selectResultId);</span>
<span class="pc bpc" id="L307" title="1 of 2 branches missed.">        if (maybeResult.isPresent()) {</span>
<span class="fc" id="L308">            resultToBeDeleted = maybeResult.get();</span>
<span class="pc bpc" id="L309" title="1 of 2 branches missed.">            if (hasNotPermissionsToDeleteDatapoint(resultToBeDeleted, getLoggedInEHRRequestContext())) {</span>
<span class="nc" id="L310">                return RELOAD;</span>
            }
        } else {
<span class="nc" id="L313">            return RELOAD;</span>
        }

<span class="fc" id="L316">        testManager.transactional(() -&gt; {</span>
<span class="fc" id="L317">                    testManager.deleteTestResult(getLoggedInEHRRequestContext(), resultToBeDeleted.getId(), null);</span>
<span class="fc" id="L318">                }</span>
        );
<span class="fc" id="L320">        logActivityByOthers(Activity.Action.DELETED_LAB_RESULTS, dateTimeService.now(), true, resultToBeDeleted, getLoggedInEHRRequestContext());</span>

<span class="fc" id="L322">        addActionMessage(getText(&quot;testHistoryAction.txt.deletion_complete&quot;));</span>
<span class="fc" id="L323">        return RELOAD;</span>
    }

    public String cancelDelete() {
<span class="fc" id="L327">        return RELOAD;</span>
    }

    public String editPrivacyCancel() {
<span class="nc" id="L331">        return RELOAD;</span>
    }

    public String editResultsForm() {
<span class="pc bpc" id="L335" title="1 of 2 branches missed.">        if (selectResultId == null) {</span>
<span class="nc" id="L336">            addActionError(getText(&quot;testHistoryAction.err.select_for_edit&quot;));</span>
<span class="nc" id="L337">            return RELOAD;</span>
        }

<span class="fc" id="L340">        testResultDTO = getTestHistoryDTO(patientId()).findTestResult(selectResultId).orElse(null);</span>
<span class="pc bpc" id="L341" title="1 of 2 branches missed.">        if (hasNotPermissionsToEditPrivacyLabels(testResultDTO, getLoggedInEHRRequestContext())) {</span>
<span class="nc" id="L342">            return CANCEL;</span>
        }
<span class="fc" id="L344">        fillPrivacyFlagsFrom(testResultDTO);</span>
<span class="fc" id="L345">        return &quot;editTestPrivacy&quot;;</span>
    }

    public String editPrivacySave() {
<span class="pc bpc" id="L349" title="1 of 2 branches missed.">        if (selectResultId == null) {</span>
<span class="nc" id="L350">            addActionError(getText(&quot;testHistoryAction.err.select_for_edit&quot;));</span>
<span class="nc" id="L351">            return RELOAD;</span>
        }

<span class="fc" id="L354">        var users = getContextAndLoggedInUsers(CONTACTS);</span>

<span class="fc" id="L356">        testResultDTO = getTestHistoryDTO(patientId())</span>
<span class="fc" id="L357">                .findTestResult(selectResultId)</span>
<span class="pc" id="L358">                .orElseThrow(() -&gt; new IllegalStateException(&quot;No test result dto for id: &quot; + selectResultId));</span>
<span class="pc bpc" id="L359" title="1 of 2 branches missed.">        if (hasNotPermissionsToEditPrivacyLabels(testResultDTO, getLoggedInEHRRequestContext())) {</span>
<span class="nc" id="L360">            return CANCEL;</span>
        }
<span class="fc" id="L362">        privacyService.handlePrivacyChange(testResultTransformer.transformTestResultView(testResultDTO),</span>
<span class="fc" id="L363">                MenuDataType.loincTestResult, getNewFlag(), getEHRRequestContext(),</span>
<span class="fc" id="L364">                userManager.getDefaultAccountId(patientId()), users.contextUser(), users.loggedInUser());</span>
<span class="fc" id="L365">        return RELOAD;</span>
    }

    @Override
    public String getCustomStyle() {
<span class="fc" id="L370">        return MOBILE_OPTIMIZED_STYLE;</span>
    }

    private long patientId() {
<span class="fc" id="L374">        return contextUserUtil.getContextOrLoggedInUserId();</span>
    }

    public TestManager getTestManager() {
<span class="nc" id="L378">        return testManager;</span>
    }

    public void setTestManager(TestManager testManager) {
<span class="fc" id="L382">        this.testManager = testManager;</span>
<span class="fc" id="L383">    }</span>

    public String getTab() {
<span class="fc" id="L386">        return tab;</span>
    }

    public Long getSelectResultId() {
<span class="fc" id="L390">        return selectResultId;</span>
    }

    public void setSelectResultId(Long selectResultId) {
<span class="fc" id="L394">        this.selectResultId = selectResultId;</span>
<span class="fc" id="L395">    }</span>

    public UserManager getUserManager() {
<span class="nc" id="L398">        return userManager;</span>
    }

    public void setUserManager(UserManager userManager) {
<span class="fc" id="L402">        this.userManager = userManager;</span>
<span class="fc" id="L403">    }</span>

    public InputStream getJsonInputStream() {
<span class="fc" id="L406">        return jsonInputStream;</span>
    }

    public int getJsonContentLength() {
<span class="fc" id="L410">        return jsonContentLength;</span>
    }

    public TestHistoryDTO getTestHistory() {
<span class="fc" id="L414">        return testHistory;</span>
    }

    public void setTestHistory(TestHistoryDTO testHistory) {
<span class="fc" id="L418">        this.testHistory = testHistory;</span>
<span class="fc" id="L419">    }</span>

    public TestResultDTO getResultToBeDeleted() {
<span class="fc" id="L422">        return resultToBeDeleted;</span>
    }

    public String getSubTab() {
<span class="fc" id="L426">        return subTab;</span>
    }

    public String getTestResultTypeIdSource() {
<span class="fc" id="L430">        return testResultTypeIdSource;</span>
    }

    public void setTestResultTypeIdSource(String testResultTypeIdSource) {
<span class="fc" id="L434">        this.testResultTypeIdSource = testResultTypeIdSource;</span>
<span class="fc" id="L435">    }</span>

    public Long getTestResultTypeId() {
<span class="fc" id="L438">        return testResultTypeId;</span>
    }

    public void setTestResultTypeId(Long testResultTypeId) {
<span class="fc" id="L442">        this.testResultTypeId = testResultTypeId;</span>
<span class="fc" id="L443">    }</span>

    public List&lt;TestHistoryDTO&gt; getRelatedTests() {
<span class="nc" id="L446">        return relatedTests;</span>
    }

    public void setRelatedTests(List&lt;TestHistoryDTO&gt; relatedTests) {
<span class="nc" id="L450">        this.relatedTests = relatedTests;</span>
<span class="nc" id="L451">    }</span>

    public boolean isGeneralHealth() {
<span class="nc" id="L454">        return testResultDTO.getBaseFields().isGeneralHealthConsentRequired();</span>
    }

    public boolean isMentalHealth() {
<span class="nc" id="L458">        return testResultDTO.getBaseFields().isMentalHealthConsentRequired();</span>
    }

    public boolean isSexualHealth() {
<span class="nc" id="L462">        return testResultDTO.getBaseFields().isSexualHealthConsentRequired();</span>
    }

    public boolean isSocialCare() {
<span class="nc" id="L466">        return testResultDTO.getBaseFields().isSocialCareConsentRequired();</span>
    }

    public final TestHistoryUtil getTestHistoryUtil() {
<span class="nc" id="L470">        return testHistoryUtil;</span>
    }

    public final void setTestHistoryUtil(TestHistoryUtil testHistoryUtil) {
<span class="fc" id="L474">        this.testHistoryUtil = testHistoryUtil;</span>
<span class="fc" id="L475">    }</span>

    public final ObjectMapper getObjectMapper() {
<span class="nc" id="L478">        return objectMapper;</span>
    }

    public final void setObjectMapper(ObjectMapper objectMapper) {
<span class="fc" id="L482">        this.objectMapper = objectMapper;</span>
<span class="fc" id="L483">    }</span>

    public String getDiscussMessage() {
<span class="fc" id="L486">        return discussMessage;</span>
    }

    public void setDiscussMessage(String discussMessage) {
<span class="nc" id="L490">        this.discussMessage = discussMessage;</span>
<span class="nc" id="L491">    }</span>

    public String getDiscussTopic() {
<span class="fc" id="L494">        return discussTopic;</span>
    }

    public void setDiscussTopic(String discussTopic) {
<span class="nc" id="L498">        this.discussTopic = discussTopic;</span>
<span class="nc" id="L499">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>