<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MyMeasurementsAction.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">E2E Tests Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.pkb.action.test</a> &gt; <span class="el_source">MyMeasurementsAction.java</span></div><h1>MyMeasurementsAction.java</h1><pre class="source lang-java linenums">//------------------------------------------------------------------------------
//
// Copyright (c) 2011 PatientsKnowBest, Inc. All Rights Reserved.
//
// $Id: $
//
//------------------------------------------------------------------------------

package com.pkb.action.test;

import com.opensymphony.xwork2.Action;
import com.pkb.action.BaseAction;
import com.pkb.app.entity.LoggedInEHRRequestContext;
import com.pkb.bean.IMessageWebBean;
import com.pkb.dto.MeasurementOverviewDto;
import com.pkb.mappers.MeasurementMapper;
import com.pkb.service.test.MeasurementManager;
import com.pkb.service.user.impl.UserManager;
import com.pkb.test.entity.MeasurementDisplayCategory;
import com.pkb.test.entity.MeasurementHistoryDTO;
import org.springframework.beans.factory.annotation.Autowired;

import java.util.Iterator;
import java.util.List;

/**
 * Shows overview of measurements this user has uploaded into their account;
 * for each test we show a sparkline and the most recent value.
 *
 * @author robwhelan
 */
<span class="fc" id="L32">public class MyMeasurementsAction extends BaseAction {</span>

    private static final long serialVersionUID = 1L;
<span class="fc" id="L35">    private final String tab = &quot;health&quot;;</span>
<span class="fc" id="L36">    private final String subTab = &quot;measurements&quot;;</span>
    // For prompting
    boolean weightPresent;
    boolean heightPresent;
    private List&lt;Long&gt; selectId;
    private MeasurementManager measurementManager;
    private IMessageWebBean messageWebBean;
    private Long patientId;
    private String discussMessage;

    private String discussTopic;

    private MeasurementUtil measurementUtil;

    private String originalContextUser;

    private List&lt;MeasurementOverviewDto&gt; measurementOverviewDtos;

    private LoggedInEHRRequestContext loggedInContext;

    @Autowired
    private MeasurementMapper measurementMapper;

    @Override
    public void prepare() throws Exception {
<span class="fc" id="L61">        loggedInContext = getLoggedInEHRRequestContext();</span>
<span class="fc" id="L62">    }</span>

    /**
     * grab list of recent measurements, limited to a configurable number per type
     */
    @Override
    public String execute() {
<span class="fc" id="L69">        patientId = contextUserUtil.getContextOrLoggedInUserId();</span>

<span class="fc" id="L71">        List&lt;MeasurementHistoryDTO&gt; latestMeasurements = measurementManager.getLatestMeasurements(</span>
                loggedInContext,
<span class="fc" id="L73">                patientId,</span>
<span class="fc" id="L74">                config.getMyMeasurementsDefaultFetchSize(), loggedInUserUtil.getLoggedInPerson());</span>

<span class="fc" id="L76">        weightPresent = false;</span>
<span class="fc" id="L77">        heightPresent = false;</span>

<span class="fc" id="L79">        Iterator&lt;MeasurementHistoryDTO&gt; it = latestMeasurements.iterator();</span>
<span class="fc bfc" id="L80" title="All 2 branches covered.">        while (it.hasNext()) {</span>
<span class="fc" id="L81">            it.next().getMeasurementType().getAsPredefinedMeasurementType().peek(type -&gt; {</span>
<span class="fc bfc" id="L82" title="All 4 branches covered.">                switch (type) {</span>
                    case WEIGHT:
<span class="fc" id="L84">                        weightPresent = true;</span>
<span class="fc" id="L85">                        break;</span>
                    case HEIGHT:
<span class="fc" id="L87">                        heightPresent = true;</span>
<span class="fc" id="L88">                        break;</span>
                    case MOTION_SENSED:
                    case MEAL:
                    case ACTIVITY_TYPE:
                    case INTENSITY:
                    case START_TIME:
<span class="fc" id="L94">                        it.remove();</span>
<span class="fc" id="L95">                        break;</span>
                    default:
                        break;
                }
<span class="fc" id="L99">            });</span>
        }

<span class="fc" id="L102">        measurementOverviewDtos = measurementMapper.historyToOverviewDtos(latestMeasurements,</span>
<span class="fc" id="L103">                contextUserUtil.getContextUserId(),</span>
<span class="fc" id="L104">                getLocale());</span>

<span class="fc" id="L106">        return Action.SUCCESS;</span>
    }

    public String getTab() {
<span class="fc" id="L110">        return tab;</span>
    }

    public List&lt;Long&gt; getSelectId() {
<span class="nc" id="L114">        return selectId;</span>
    }

    public void setSelectId(List&lt;Long&gt; selectId) {
<span class="nc" id="L118">        this.selectId = selectId;</span>
<span class="nc" id="L119">    }</span>

    public IMessageWebBean getMessageWebBean() {
<span class="nc" id="L122">        return messageWebBean;</span>
    }

    public void setMessageWebBean(IMessageWebBean messageWebBean) {
<span class="fc" id="L126">        this.messageWebBean = messageWebBean;</span>
<span class="fc" id="L127">    }</span>

    public UserManager getUserManager() {
<span class="nc" id="L130">        return userManager;</span>
    }

    public void setUserManager(UserManager userManager) {
<span class="fc" id="L134">        this.userManager = userManager;</span>
<span class="fc" id="L135">    }</span>

    public Long getPatientId() {
<span class="nc" id="L138">        return patientId;</span>
    }

    public void setPatientId(Long patientId) {
<span class="nc" id="L142">        this.patientId = patientId;</span>
<span class="nc" id="L143">    }</span>

    public String getSubTab() {
<span class="fc" id="L146">        return subTab;</span>
    }

    public void setMeasurementManager(MeasurementManager measurementManager) {
<span class="fc" id="L150">        this.measurementManager = measurementManager;</span>
<span class="fc" id="L151">    }</span>

    public boolean isWeightPresent() {
<span class="fc" id="L154">        return weightPresent;</span>
    }

    public void setWeightPresent(boolean weightPresent) {
<span class="nc" id="L158">        this.weightPresent = weightPresent;</span>
<span class="nc" id="L159">    }</span>

    public boolean isHeightPresent() {
<span class="fc" id="L162">        return heightPresent;</span>
    }

    public void setHeightPresent(boolean heightPresent) {
<span class="nc" id="L166">        this.heightPresent = heightPresent;</span>
<span class="nc" id="L167">    }</span>

    public MeasurementDisplayCategory[] getDisplayCategories() {
<span class="fc" id="L170">        return MeasurementDisplayCategory.values();</span>
    }

    public boolean isDisplayCategoryPresent(MeasurementDisplayCategory displayCategory) {
<span class="fc bfc" id="L174" title="All 2 branches covered.">        for (MeasurementOverviewDto measurement : measurementOverviewDtos) {</span>
<span class="fc bfc" id="L175" title="All 2 branches covered.">            if (measurement.isCategory(displayCategory)) {</span>
<span class="fc" id="L176">                return true;</span>
            }
<span class="fc" id="L178">        }</span>
<span class="fc" id="L179">        return false;</span>
    }

    public boolean isDisplayCategoryGeneral(MeasurementDisplayCategory displayCategory) {
<span class="fc bfc" id="L183" title="All 2 branches covered.">        return displayCategory == MeasurementDisplayCategory.GENERAL;</span>
    }

    public String getDiscussMessage() {
<span class="nc" id="L187">        return discussMessage;</span>
    }

    public void setDiscussMessage(String discussMessage) {
<span class="nc" id="L191">        this.discussMessage = discussMessage;</span>
<span class="nc" id="L192">    }</span>

    public String getDiscussTopic() {
<span class="nc" id="L195">        return discussTopic;</span>
    }

    public void setDiscussTopic(String discussTopic) {
<span class="nc" id="L199">        this.discussTopic = discussTopic;</span>
<span class="nc" id="L200">    }</span>

    public void setMeasurementUtil(MeasurementUtil measurementUtil) {
<span class="fc" id="L203">        this.measurementUtil = measurementUtil;</span>
<span class="fc" id="L204">    }</span>

    public String getOriginalContextUser() {
<span class="nc" id="L207">        return originalContextUser;</span>
    }

    public void setOriginalContextUser(String originalContextUser) {
<span class="nc" id="L211">        this.originalContextUser = originalContextUser;</span>
<span class="nc" id="L212">    }</span>

    @Override
    public String getCustomStyle() {
<span class="fc" id="L216">        return MOBILE_OPTIMIZED_STYLE;</span>
    }

    public List&lt;MeasurementOverviewDto&gt; getMeasurementOverviewDtos() {
<span class="fc" id="L220">        return measurementOverviewDtos;</span>
    }

    public LoggedInEHRRequestContext getLoggedInContext() {
<span class="fc" id="L224">        return loggedInContext;</span>
    }

    public void setLoggedInContext(LoggedInEHRRequestContext loggedInContext) {
<span class="nc" id="L228">        this.loggedInContext = loggedInContext;</span>
<span class="nc" id="L229">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>