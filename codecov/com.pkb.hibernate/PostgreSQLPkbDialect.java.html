<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PostgreSQLPkbDialect.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">E2E Tests Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.pkb.hibernate</a> &gt; <span class="el_source">PostgreSQLPkbDialect.java</span></div><h1>PostgreSQLPkbDialect.java</h1><pre class="source lang-java linenums">package com.pkb.hibernate;

import org.hibernate.dialect.PostgreSQL95Dialect;
import org.hibernate.dialect.function.SQLFunctionTemplate;
import org.hibernate.dialect.function.StandardSQLFunction;
import org.hibernate.type.StandardBasicTypes;

/**
 * PostgreSQL full text search (FTS) is an advanced search option where results cannot
 * be retrieved through “=”, “LIKE” or “~” operators.
 * &lt;p&gt;&lt;/p&gt;
 * A document needs to be formatted into lexemes which are understood by PostgreSQL
 * for full text search support. “A lexeme is a sequence of characters in the source
 * program that matches the pattern for a token and is identified by the lexical
 * analyzer as an instance of that token”.
 * &lt;p&gt;&lt;/p&gt;
 * PostgreSQL provides two data types to support full-text search,
 * one is tsvector and another is tsquery type.
 * &lt;p&gt;&lt;/p&gt;
 * PostgreSQL provides tsvector data type for storing preprocessed documents.
 * For text search purpose, each document needs to be reduced to preprocessed tsvector format.
 * PostgreSQL performs searching and ranking of results entirely on tsvector representation
 * of a document.
 * &lt;p&gt;&lt;/p&gt;
 * A tsvector value is a sorted list of distinct lexemes, which are words that have been
 * normalized to merge different variants of the same word look alike.
 * For example converting uppercase letters to lowercase, removing suffixes which allows
 * searches to find variant forms of a word.
 * &lt;p&gt;&lt;/p&gt;
 * For example:
 * &lt;p&gt;&lt;/p&gt;
 * SELECT 'A fat dog jumped over the lazy cat'::tsvector;
 * &lt;p&gt;&lt;/p&gt;
 *      tsvector
 * &lt;p&gt;&lt;/p&gt;
 * ----------------------------------------------------
 * &lt;p&gt;&lt;/p&gt;
 *  'A' 'cat' 'dog' 'fat' 'jumped' 'lazy' 'over' 'the'
 * &lt;p&gt;&lt;/p&gt;
 *  Type tsquery represents a text query. A tsquery value stores search terms,
 *  which must be already-normalized lexemes and may combine multiple Boolean operators.
 * &lt;p&gt;&lt;/p&gt;
 * For example:
 * &lt;p&gt;&lt;/p&gt;
 * tsquery
 * &lt;p&gt;&lt;/p&gt;
 * SELECT 'dog &amp; cat'::tsquery;
 * &lt;p&gt;&lt;/p&gt;
 *     tsquery
 * &lt;p&gt;&lt;/p&gt;
 * ---------------------------
 * &lt;p&gt;&lt;/p&gt;
 * 'dog' &amp; 'cat'
 * &lt;p&gt;&lt;/p&gt;
 * SELECT 'dog &amp; (cat | rat)'::tsquery;
 * &lt;p&gt;&lt;/p&gt;
 *     tsquery
 * &lt;p&gt;&lt;/p&gt;
 * ---------------------------
 * &lt;p&gt;&lt;/p&gt;
 * 'dog' &amp; ( 'cat' | 'rat' )
 * &lt;p&gt;&lt;/p&gt;
 * To implement full text search there must be a function to create a tsvector
 * from a document and a tsquery from a user query.
 * &lt;p&gt;&lt;/p&gt;
 * PostgreSQL provides the function to_tsvector for converting a document
 * to the tsvector data type. The to_tsvector parses and normalizes a document
 * string into tokens, reduces the tokens to lexemes, and returns a tsvector which
 * lists the lexemes together with their positions in the document.
 * &lt;p&gt;&lt;/p&gt;
 * For example:
 * &lt;p&gt;&lt;/p&gt;
 * SELECT to_tsvector('A fat dog jumped over the lazy cat');
 * &lt;p&gt;&lt;/p&gt;
 * would result in
 * &lt;p&gt;&lt;/p&gt;
 * to_tsvector
 * &lt;p&gt;&lt;/p&gt;
 * ----------------------
 * &lt;p&gt;&lt;/p&gt;
 * 'cat':8 'dog':3 'fat':2 'jump':4 'lazi':7
 * &lt;p&gt;&lt;/p&gt;
 * Function to_tsquery is used to convert user-written text into a proper tsquery format.
 * The function to_tsquery takes one argument, a string containing the tokens to search for.
 * We can provide an optional argument to this function.
 * &lt;p&gt;&lt;/p&gt;
 * The to_tsquery function does not accept a string of text, it requires a string of tokens
 * separated by operators. It then goes and creates a true tsquery to retrieve the results.
 * &lt;p&gt;&lt;/p&gt;
 * For example:
 * &lt;p&gt;&lt;/p&gt;
 * SELECT to_tsvector('A fat dog jumped over the lazy cat') @@ to_tsquery( 'jumping')
 * would result in t, meaning that a match is found.
 * &lt;p&gt;&lt;/p&gt;
 * PostgreSQL full text search is based on the match operator @@, which returns true if
 * a tsvector matches a tsquery. By default, PostgreSQL uses ‘english’ as text search
 * configuration for the function to_tsvector and it will also ignore English stop words.
 * &lt;p&gt;&lt;/p&gt;
 * As mentioned earlier, PostgreSQL makes use of @@ operator for full text search,
 * If we want to support this in hibernate or HQL queries then we need to modify our
 * current PostgreSQLDialect to support special character ‘@@’ for full text search.
 * &lt;p&gt;&lt;/p&gt;
 * This class extends the dialect to make the to_tsvector and to_tsquery functions
 * available to use in HQL and also defines a tsmatch function, which combines the
 * vector and query using the special character '@@'
 * &lt;p&gt;&lt;/p&gt;
 * https://www.zymr.com/postgresql-full-text-searchfts-hibernate/
 */
public class PostgreSQLPkbDialect extends PostgreSQL95Dialect {
<span class="fc" id="L110">    public PostgreSQLPkbDialect() {</span>
<span class="fc" id="L111">        registerFunction(&quot;to_tsquery&quot;, new StandardSQLFunction(&quot;to_tsquery&quot;));</span>
<span class="fc" id="L112">        registerFunction(&quot;to_tsvector&quot;, new StandardSQLFunction(&quot;to_tsvector&quot;));</span>
<span class="fc" id="L113">        registerFunction(&quot;tsmatch&quot;,</span>
                new SQLFunctionTemplate(StandardBasicTypes.BOOLEAN,
                        &quot;?1 @@ ?2&quot;));
<span class="fc" id="L116">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>