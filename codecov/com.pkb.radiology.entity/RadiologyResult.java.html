<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RadiologyResult.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">E2E Tests Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.pkb.radiology.entity</a> &gt; <span class="el_source">RadiologyResult.java</span></div><h1>RadiologyResult.java</h1><pre class="source lang-java linenums">//---------------------------------------------------------------------------
//
// Copyright (c) 2012 PatientsKnowBest, Inc. All Rights Reserved.
//
// $Id: $
//
//---------------------------------------------------------------------------

package com.pkb.radiology.entity;

import com.google.common.primitives.Longs;
import com.pkb.annotation.EHRField;
import com.pkb.annotation.EHRField.QueryField;
import com.pkb.annotation.EHRMigration;
import com.pkb.app.dto.DTOBaseFields;
import com.pkb.app.entity.SourceDetails;
import com.pkb.app.interfaces.IBaseDTO;
import com.pkb.document.entity.Attachment;
import com.pkb.encounter.entity.GeographicLocation;
import com.pkb.entities.enums.MenuDataType;
import com.pkb.institute.entity.Team;
import org.apache.commons.lang3.StringUtils;
import org.jetbrains.annotations.Nullable;

import java.io.Serializable;
import java.time.Instant;
import java.util.ArrayList;
import java.util.LinkedList;
import java.util.List;
import java.util.Objects;
import java.util.Optional;

import static org.apache.commons.lang3.StringUtils.isNotBlank;

//TODO : Create another DS called DiagnosticReport which includes List&lt;RadiologyResult&gt;; List&lt;Observation&gt;
@EHRMigration(migratorClass = RadiologyResultMigrator.class)
public class RadiologyResult implements IBaseDTO, Serializable {

<span class="fc" id="L39">    public static final MenuDataType MS_RADIOLOGY_RESULT = MenuDataType.radiologyResult;</span>

    private static final long serialVersionUID = 1L;

    // Placeholder field names
    public static final String CATEGORY = &quot;category&quot;;

    public static final String TITLE = &quot;title&quot;;

    public static final String DESCRIPTION = &quot;description&quot;;

    public static final String PATIENTID = &quot;patientId&quot;;

    public static final String AUTHORID = &quot;authorId&quot;;

    public static final String CREATIONTIMESTAMP = &quot;creationTimestamp&quot;;

    public static final String DATAENTERERID = &quot;dataEntererId&quot;;

    public static final String UPLOADTIMESTAMP = &quot;uploadTimestamp&quot;;

    public static final String UPLOADED_DATA_ID = &quot;uploadedDataId&quot;;
    public static final String LAB_ORDER_ID = &quot;labOrderId&quot;;

    public static final String DELETED_BY_PERSON_ID = &quot;deletedByPersonId&quot;;

<span class="fc" id="L65">    public enum MediaActCategory {</span>
<span class="fc" id="L66">        IMAGING, AUDIO;</span>

        @Nullable
        public static MediaActCategory getByNameIgnoreCase(String findMe) {
<span class="fc bfc" id="L70" title="All 2 branches covered.">            for (MediaActCategory m : values()) {</span>
<span class="fc bfc" id="L71" title="All 2 branches covered.">                if (m.toString().equalsIgnoreCase(findMe)) {</span>
<span class="fc" id="L72">                    return m;</span>
                }
            }
<span class="fc" id="L75">            return null; // no match</span>
        }

    }

    @EHRField(queryField = QueryField.id)
    private Long id;

    // HL7 fields
    @EHRField(queryField = QueryField.string01)
    private MediaActCategory category;

    @EHRField
    private String title;
    @EHRField
    private String description;

    // TODO earlier this was long01 ; migrate it with script 0 = false , 1 = true
<span class="fc" id="L93">    @EHRField(queryField = QueryField.boolean01)</span>
    private Boolean htmlAllowed = Boolean.TRUE;

    @EHRField
    private String patientId;
    @EHRField
    private String authorId;

    private String dataEntererId;

    @EHRField(queryField = QueryField.date02)
    private Instant creationTimestamp;

    @EHRField(queryField = QueryField.date01)
    private Instant uploadTimestamp;

    @EHRField(queryField = QueryField.string02)
    private String labOrderId;

    @EHRField
    private Long delayDisplayDays;

    @EHRField
    private GeographicLocation entererLocation;

    // Summaries of images (without images themselves)
    private List&lt;RadiologyImage&gt; imageSummaries;

    // Other attachments
    private List&lt;Attachment&gt; attachments;

    // LATER - add previousVersionId and nextVersionId to support editing
    // Derived fields for display
    private String authorString;

    private String dataEntererString;
    private String creationTimestampString;

    private String uploadTimestampString;

    /**
     * stored only in delete-flagged menudata records. NOT YET USED
     */
    private Long deletedByPersonId;

    private SourceDetails source;

<span class="fc" id="L140">    private DTOBaseFields baseFields = new DTOBaseFields();</span>

    // For privacy labels
<span class="fc" id="L143">    private String obrServiceCode = &quot;&quot;;</span>

    /**
     * DELIBERATELY PROTECTED DO NOT CHANGE! Use the available constructors!
     * &lt;p&gt;
     * Would have even less visibility but JPA spec &amp; Hibernate requires a no arg const. which is public or protected.
     * Other than those, nothing should be able to construct without parameters, as changelog wouldn't be filled correctly etc.
     */
<span class="fc" id="L151">    protected RadiologyResult() {</span>
<span class="fc" id="L152">        this.source = new SourceDetails();</span>
<span class="fc" id="L153">    }</span>

<span class="fc" id="L155">    public RadiologyResult(SourceDetails source) {</span>
<span class="fc" id="L156">        this.source = source;</span>
<span class="fc" id="L157">    }</span>

    // util for HL7 API
    public void addDescriptionLine(String line) {
<span class="fc bfc" id="L161" title="All 2 branches covered.">        if (StringUtils.isBlank(description)) {</span>
<span class="fc" id="L162">            description = line;</span>
<span class="pc bpc" id="L163" title="1 of 2 branches missed.">        } else if (isHtmlAllowed()) {</span>
<span class="fc" id="L164">            description += &quot;&lt;br /&gt;\n&quot; + line;</span>
        } else {
<span class="nc" id="L166">            description += &quot;\n&quot; + line;</span>
        }
<span class="fc" id="L168">    }</span>

    public void addRadiologyImage(RadiologyImage radiologyImage) {
<span class="nc bnc" id="L171" title="All 2 branches missed.">        if (imageSummaries == null) {</span>
<span class="nc" id="L172">            imageSummaries = new LinkedList&lt;&gt;();</span>
        }
<span class="nc" id="L174">        imageSummaries.add(radiologyImage);</span>
<span class="nc" id="L175">    }</span>

    // simple getters/setters

    @Override
    public Long getId() {
<span class="fc" id="L181">        return id;</span>
    }

    @Override
    public void setId(Long id) {
<span class="fc" id="L186">        this.id = id;</span>
<span class="fc" id="L187">    }</span>

    public String getDescription() {
<span class="fc bfc" id="L190" title="All 2 branches covered.">        if (description == null) {</span>
<span class="fc" id="L191">            return &quot;&quot;;</span>
        }
<span class="fc" id="L193">        return description;</span>
    }

    public void setDescription(String description) {
<span class="fc" id="L197">        this.description = description;</span>
<span class="fc" id="L198">    }</span>

    public Long getPatientId() {
<span class="fc" id="L201">        return Optional.ofNullable(patientId).map(Longs::tryParse).orElse(null);</span>
    }

    public void setPatientId(Long patientId) {
<span class="fc" id="L205">        this.patientId = Objects.toString(patientId, null);</span>
<span class="fc" id="L206">    }</span>

    public Instant getUploadTimestamp() {
<span class="fc" id="L209">        return uploadTimestamp;</span>
    }

    public void setUploadTimestamp(Instant uploadTimestamp) {
<span class="fc" id="L213">        this.uploadTimestamp = uploadTimestamp;</span>
<span class="fc" id="L214">    }</span>

    public String getDataEntererString() {
<span class="nc" id="L217">        return dataEntererString;</span>
    }

    public String getTitle() {
<span class="fc" id="L221">        return title;</span>
    }

    public void setTitle(String title) {
<span class="fc" id="L225">        this.title = title;</span>
<span class="fc" id="L226">    }</span>

    public void setDataEntererString(String dataEntererString) {
<span class="nc" id="L229">        this.dataEntererString = dataEntererString;</span>
<span class="nc" id="L230">    }</span>

    public String getUploadTimestampString() {
<span class="nc" id="L233">        return uploadTimestampString;</span>
    }

    public void setUploadTimestampString(String uploadTimestampString) {
<span class="nc" id="L237">        this.uploadTimestampString = uploadTimestampString;</span>
<span class="nc" id="L238">    }</span>

    /**
     * never null
     */
    public List&lt;RadiologyImage&gt; getImageSummaries() {
<span class="pc bpc" id="L244" title="1 of 2 branches missed.">        if (imageSummaries == null) {</span>
<span class="fc" id="L245">            imageSummaries = new ArrayList&lt;&gt;();</span>
        }
<span class="fc" id="L247">        return imageSummaries;</span>
    }

    public void setImageSummaries(
            List&lt;RadiologyImage&gt; imageSummaries) {
<span class="nc" id="L252">        this.imageSummaries = imageSummaries;</span>
<span class="nc" id="L253">    }</span>

    public Long getAuthorId() {
<span class="fc" id="L256">        return Optional.ofNullable(authorId).map(Longs::tryParse).orElse(null);</span>
    }

    public void setAuthorId(Long authorId) {
<span class="fc" id="L260">        this.authorId = Objects.toString(authorId, null);</span>
<span class="fc" id="L261">    }</span>

    public Instant getCreationTimestamp() {
<span class="fc" id="L264">        return creationTimestamp;</span>
    }

    public String getCreationTimestampString() {
<span class="nc" id="L268">        return creationTimestampString;</span>
    }

    public void setCreationTimestampString(String creationTimestampString) {
<span class="nc" id="L272">        this.creationTimestampString = creationTimestampString;</span>
<span class="nc" id="L273">    }</span>

    public void setCreationTimestamp(Instant creationTimestamp) {
<span class="fc" id="L276">        this.creationTimestamp = creationTimestamp;</span>
<span class="fc" id="L277">    }</span>

    public String getAuthorString() {
<span class="nc" id="L280">        return authorString;</span>
    }

    public void setAuthorString(String authorString) {
<span class="nc" id="L284">        this.authorString = authorString;</span>
<span class="nc" id="L285">    }</span>

    /**
     * never null
     */
    public List&lt;Attachment&gt; getAttachments() {
<span class="fc bfc" id="L291" title="All 2 branches covered.">        if (attachments == null) {</span>
<span class="fc" id="L292">            attachments = new ArrayList&lt;&gt;();</span>
        }
<span class="fc" id="L294">        return attachments;</span>
    }

    public void setAttachments(List&lt;Attachment&gt; attachments) {
<span class="fc" id="L298">        this.attachments = attachments;</span>
<span class="fc" id="L299">    }</span>

    public void addAttachment(Attachment attachment) {
<span class="fc bfc" id="L302" title="All 2 branches covered.">        if (attachments == null) {</span>
<span class="fc" id="L303">            attachments = new ArrayList&lt;&gt;();</span>
        }
<span class="fc" id="L305">        attachments.add(attachment);</span>
<span class="fc" id="L306">    }</span>

    public MediaActCategory getCategory() {
<span class="fc" id="L309">        return category;</span>
    }

    public void setCategory(MediaActCategory category) {
<span class="fc" id="L313">        this.category = category;</span>
<span class="fc" id="L314">    }</span>
    
    public String getLabOrderId() {
<span class="fc" id="L317">        return labOrderId;</span>
    }

    public void setLabOrderId(String labOrderId) {
<span class="fc" id="L321">        this.labOrderId = labOrderId;</span>
<span class="fc" id="L322">    }</span>

    public Long getDelayDisplayDays() {
<span class="fc" id="L325">        return delayDisplayDays;</span>
    }

    public void setDelayDisplayDays(Long delayDisplayDays) {
<span class="fc" id="L329">        this.delayDisplayDays = delayDisplayDays;</span>
<span class="fc" id="L330">    }</span>

    public Long getDeletedByPersonId() {
<span class="nc" id="L333">        return deletedByPersonId;</span>
    }

    public void setDeletedByPersonId(Long deletedByPersonId) {
<span class="nc" id="L337">        this.deletedByPersonId = deletedByPersonId;</span>
<span class="nc" id="L338">    }</span>

    public boolean isHtmlAllowed() {
<span class="pc bpc" id="L341" title="2 of 4 branches missed.">        return htmlAllowed != null &amp;&amp; htmlAllowed;</span>
    }

    public void setHtmlAllowed(Boolean htmlAllowed) {
<span class="fc" id="L345">        this.htmlAllowed = htmlAllowed;</span>
<span class="fc" id="L346">    }</span>

    @Override
    public DTOBaseFields getBaseFields() {
<span class="fc" id="L350">        return baseFields;</span>
    }

    @Override
    public SourceDetails getSource() {
<span class="fc" id="L355">        return source;</span>
    }

    public String getDataEntererId() {
<span class="nc" id="L359">        return dataEntererId;</span>
    }

    public void setDataEntererId(String dataEntererId) {
<span class="nc" id="L363">        this.dataEntererId = dataEntererId;</span>
<span class="nc" id="L364">    }</span>

    public String getObrServiceCode() {
<span class="fc" id="L367">        return obrServiceCode;</span>
    }

    public void setObrServiceCode(String obrServiceCode) {
<span class="fc" id="L371">        this.obrServiceCode = obrServiceCode;</span>
<span class="fc" id="L372">    }</span>

    public GeographicLocation getEntererLocation() {
<span class="fc" id="L375">        return entererLocation;</span>
    }

    public void setEntererLocation(GeographicLocation entererLocation) {
<span class="fc" id="L379">        this.entererLocation = entererLocation;</span>
<span class="fc" id="L380">    }</span>

    public boolean isSourceVisible() {
<span class="fc" id="L383">        return isNotBlank(source.getDisplayText());</span>
    }

    public boolean isEditableByUser(Long loggedInUserId) {
<span class="fc" id="L387">        return loggedInUserId.equals(source.getPersonId());</span>
    }

    public boolean isEditableByTeam(Team team) {
<span class="fc" id="L391">        return team.getId().equals(source.getTeamId());</span>
    }

    public boolean hasAttachments() {
<span class="fc bfc" id="L395" title="All 2 branches covered.">        return !attachments.isEmpty();</span>
    }

    public boolean isReportAvailable() {
<span class="fc" id="L399">        return isNotBlank(description);</span>
    }

    public void setSource(SourceDetails source) {
<span class="fc" id="L403">        this.source = source;</span>
<span class="fc" id="L404">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>