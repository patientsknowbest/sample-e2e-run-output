<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PkbServiceConfig.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">E2E Tests Coverage Report</a> &gt; <a href="index.source.html" class="el_package">config</a> &gt; <span class="el_source">PkbServiceConfig.java</span></div><h1>PkbServiceConfig.java</h1><pre class="source lang-java linenums">package config;

import com.pkb.api.internal.messaging.PKBPersonToMessagingPKBPersonDTOConverter;
import com.pkb.common.config.ConfigStorage;
import com.pkb.common.config.ConfigStorageFactory;
import com.pkb.common.config.PhrConfig;
import com.pkb.common.config.PhrConfigImpl;
import com.pkb.common.config.SensitiveInformationSupport.EmailSensitivityLevel;
import com.pkb.common.datetime.DateTimeService;
import com.pkb.common.testlogging.DefaultDetailLoggingProvider;
import com.pkb.common.testlogging.DetailLoggingProvider;
import com.pkb.diagnosis.DiagnosisHelper;
import com.pkb.domain.AccountUserService;
import com.pkb.domain.CryptoModelSynchronisationService;
import com.pkb.domain.PrivacyFlagsService;
import com.pkb.domain.appointment.AppointmentMessagingSettingsService;
import com.pkb.domain.duplicate.person.PersonService;
import com.pkb.integration.medmij.MedmijService;
import com.pkb.integration.sciStore.ISciStoreClient;
import com.pkb.integration.sciStore.SciStoreClient;
import com.pkb.kms.client.core.Kms;
import com.pkb.mappers.AccountPrivateKeyMapper;
import com.pkb.mappers.AppointmentActionsMapper;
import com.pkb.mappers.AppointmentEntryMapper;
import com.pkb.mappers.AppointmentViewMapper;
import com.pkb.mappers.ConsentIndividualMapper;
import com.pkb.mappers.ConsentTeamMapper;
import com.pkb.mappers.DiaryEntryMapper;
import com.pkb.mappers.MeasurementEntryMapper;
import com.pkb.mappers.MeasurementMapper;
import com.pkb.mappers.NationalIdMapper;
import com.pkb.mappers.OrgLevelIdMapper;
import com.pkb.mappers.OrgLevelIdTypeMapper;
import com.pkb.mappers.OrgMapper;
import com.pkb.mappers.PKBPersonToPersonDtoMapper;
import com.pkb.mappers.ProgressItemMapper;
import com.pkb.mappers.RadiologyAudioEntryMapper;
import com.pkb.mappers.SparkLineGraphMapper;
import com.pkb.mappers.TeamMapper;
import com.pkb.patient.LetterInvitationMetrics;
import com.pkb.repository.CodingMatchImportNewRecordsTempTableRepository;
import com.pkb.repository.CodingMatchImportRepository;
import com.pkb.repository.CodingMatchImportTransformTempTableRepository;
import com.pkb.repository.CodingMatchRepository;
import com.pkb.service.code.CodingTranslationService;
import com.pkb.service.coding.CodingMatchExportService;
import com.pkb.service.coding.CodingMatchImportService;
import com.pkb.service.config.BulkInviteConfig;
import com.pkb.service.dataupload.emis.esv2.EmisJobArtifactService;
import com.pkb.service.dataupload.processor.parser.json.ValidicErrorHelper;
import com.pkb.service.emailmessage.ITemplateParamsFactory;
import com.pkb.service.emailmessage.impl.EmailManager;
import com.pkb.service.emailmessage.impl.PKBEmailMessageManager;
import com.pkb.service.encounter.impl.tolven.EncounterManager;
import com.pkb.service.encounter.workflow.ConversationWorkflowConverter;
import com.pkb.service.invitation.impl.LetterInvitationManager;
import com.pkb.service.invitation.impl.LetterInvitationService;
import com.pkb.service.passwordreset.PasswordResetEmailSender;
import com.pkb.service.patientconsent.PatientConsentManager;
import com.pkb.service.privacy.MigrationService;
import com.pkb.service.privacy.PrivacyFlagsConverter;
import com.pkb.service.privacy.PrivacyService;
import com.pkb.service.state.InternalStateManager;
import com.pkb.service.team.TeamService;
import com.pkb.service.team.TeamUserManager;
import com.pkb.service.test.MeasurementUtil;
import com.pkb.service.uuid.UUIDProvider;
import com.pkb.user.entity.PKBPersonHelper;
import com.pkb.user.entity.PKBPersonHelperImpl;
import com.pkb.util.AttachmentUtil;
import com.pkb.util.CsvStreamService;
import com.pkb.util.ExceptionService;
import com.pkb.util.InternalStateClearerService;
import com.pkb.util.PKBApplicationContext;
import com.pkb.util.PKBEmailValidator;
import com.pkb.util.PKBServiceUtil;
import com.pkb.util.SupportCodeGenerator;
import com.pkb.util.UncheckedCsvPrinter;
import com.pkb.util.security.CustomStyledHtmlFilter;
import com.pkb.util.security.HtmlMessageFilter;
import com.pkb.util.security.MinimalHtmlFilter;
import com.pkb.util.security.RelaxedHtmlMessageFilter;
import com.pkb.util.security.UrlToLinkFilter;
import com.pkb.util.tolven.ConvertUtil;
import com.pkb.util.tolven.TolvenBeanFactory;
import org.springframework.context.MessageSource;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Import;

import javax.enterprise.inject.spi.CDI;

@Configuration
@Import({
        ThreadingConfig.class,
        ScheduleConfig.class,
        PkbBeansConfig.class,
        PkbManagerConfig.class,
        EmailConfig.class,
        S3StorageConfig.class,
        BulkInviteConfig.class,
        EmisEsConfig.class,
        HL7Config.class
})
@ComponentScan(basePackages = {
        &quot;com.pkb.service&quot;,
        &quot;com.pkb.api&quot;,
        &quot;com.pkb.bean&quot;,
        &quot;com.pkb.emis&quot;,
        &quot;com.pkb.migration&quot;,
        &quot;com.pkb.security&quot;,
        &quot;com.pkb.util&quot;,
        &quot;com.pkb.api.internal&quot;,
        &quot;com.pkb.mappers&quot;,
        &quot;com.pkb.integration.ods&quot;
})

<span class="fc" id="L119">public class PkbServiceConfig {</span>

    @Bean(name = &quot;PKBServiceUtil&quot;)
    public PKBServiceUtil pkbServiceUtil(MessageSource messageSource) {
<span class="fc" id="L123">        return new PKBServiceUtil(messageSource);</span>
    }

    @Bean(name = &quot;MeasurementUtil&quot;)
    public MeasurementUtil measurementUtil(PKBServiceUtil pkbServiceUtil) {
<span class="fc" id="L128">        return new MeasurementUtil(pkbServiceUtil);</span>
    }

    @Bean
    public AttachmentUtil attachmentUtil() {
<span class="fc" id="L133">        return new AttachmentUtil();</span>
    }

    @Bean
    public ConfigStorage configStorage() {
<span class="fc" id="L138">        return ConfigStorageFactory.getConfigStorage();</span>
    }

    @Bean
    public PhrConfig config(ConfigStorage configStorage) {
<span class="fc" id="L143">        return new PhrConfigImpl(configStorage);</span>
    }

    @Bean
    public PKBApplicationContext pkbApplicationContext() {
<span class="fc" id="L148">        return new PKBApplicationContext();</span>
    }

    @Bean(name = &quot;sciStoreClient&quot;)
    public ISciStoreClient sciStoreClient(PhrConfig config) {
<span class="fc" id="L153">        return new SciStoreClient(config);</span>
    }

    @Bean
    public HtmlMessageFilter htmlMessageFilter(PhrConfig config) {
<span class="fc" id="L158">        return new HtmlMessageFilter(config.getBaseURL());</span>
    }

    @Bean
    public RelaxedHtmlMessageFilter relaxedHtmlMessageFilter(PhrConfig config) {
<span class="fc" id="L163">        return new RelaxedHtmlMessageFilter(config.getBaseURL());</span>
    }

    @Bean
    public MinimalHtmlFilter minimalHtmlFilter(PhrConfig config) {
<span class="fc" id="L168">        return new MinimalHtmlFilter(config.getBaseURL());</span>
    }

    @Bean
    public CustomStyledHtmlFilter customStyledHtmlFilter(PhrConfig config) {
<span class="fc" id="L173">        return new CustomStyledHtmlFilter(config.getBaseURL());</span>
    }

    @Bean
    public UrlToLinkFilter url(PhrConfig config) {
<span class="fc" id="L178">        return new UrlToLinkFilter(config.getBaseURL());</span>
    }

    @Bean
    public ConvertUtil convertUtil(DateTimeService dateTimeService, PKBPersonHelper pkbPersonHelper) {
<span class="fc" id="L183">        return new ConvertUtil(dateTimeService, pkbPersonHelper);</span>
    }

    @Bean
    public DateTimeService dateTimeService() {
<span class="fc" id="L188">        return CDI.current().select(DateTimeService.class).get();</span>
    }

    @Bean
    public PrivacyService privacyService(PKBEmailMessageManager emailMessageManager,
                                         PhrConfig config, TolvenBeanFactory beanFactory, DateTimeService dateTimeService, UUIDProvider uuidProvider,
                                         PrivacyFlagsService privacyFlagsService, PrivacyFlagsConverter privacyFlagsConverter) {
<span class="fc" id="L195">        return new PrivacyService(config, beanFactory, dateTimeService, uuidProvider,</span>
                emailMessageManager, privacyFlagsService, privacyFlagsConverter);
    }

    @Bean
    public MigrationService ehrMigrationService(TolvenBeanFactory beanFactory, EncounterManager encounterManager) {
<span class="fc" id="L201">        return new MigrationService(beanFactory.getEhrRemote(), encounterManager);</span>
    }

    @Bean
    public DetailLoggingProvider testLoggingService() {
<span class="fc" id="L206">        return DefaultDetailLoggingProvider.INSTANCE;</span>
    }

    @Bean
    public PasswordResetEmailSender passwordResetEmailSender(EmailManager emailManager, ITemplateParamsFactory templateParametersFactory) {
<span class="fc" id="L211">        return new PasswordResetEmailSender(emailManager, templateParametersFactory);</span>
    }

    @Bean
    public PKBPersonHelper personHelper(DateTimeService dateTimeService) {
<span class="fc" id="L216">        return new PKBPersonHelperImpl(dateTimeService);</span>
    }

    @Bean
    public PKBPersonToPersonDtoMapper pkbPersonToPersonDtoMapper(PKBPersonHelper pkbPersonHelper,
                                                                 OrgLevelIdMapper orgLevelIdMapper,
                                                                 NationalIdMapper nationalIdMapper) {
<span class="fc" id="L223">        return new PKBPersonToPersonDtoMapper(pkbPersonHelper, orgLevelIdMapper, nationalIdMapper);</span>
    }

    @Bean
    public DiagnosisHelper diagnosisHelper(DateTimeService dateTimeService) {
<span class="fc" id="L228">        return new DiagnosisHelper(dateTimeService);</span>
    }

    @Bean
    public Kms kmsClient() {
<span class="nc" id="L233">        return CDI.current().select(Kms.class).get();</span>
    }

    @Bean
    public PKBPersonToMessagingPKBPersonDTOConverter pkbPersonToMessagingPKBPersonDTOConverter(PKBPersonHelper personHelper) {
<span class="fc" id="L238">        return new PKBPersonToMessagingPKBPersonDTOConverter(personHelper);</span>
    }

    @Bean
    public ConversationWorkflowConverter conversationWorkflowConverter(PKBPersonToMessagingPKBPersonDTOConverter pkbPersonDTOConverter) {
<span class="fc" id="L243">        return new ConversationWorkflowConverter(pkbPersonDTOConverter);</span>
    }

    @Bean
    public PKBEmailValidator emailValidator(PhrConfig config) {
<span class="pc bpc" id="L248" title="1 of 2 branches missed.">        return new PKBEmailValidator(() -&gt; config.isEmailLoggingEnabled() ? EmailSensitivityLevel.DISCLOSE : EmailSensitivityLevel.DISCLOSE);</span>
    }

    @Bean
    public DiaryEntryMapper diaryEntryMapper(PKBServiceUtil pkbServiceUtil, AttachmentUtil attachmentUtil) {
<span class="fc" id="L253">        return new DiaryEntryMapper(pkbServiceUtil, attachmentUtil);</span>
    }

    @Bean
    public MeasurementMapper measurementMapper(PKBServiceUtil pkbServiceUtil, SparkLineGraphMapper sparkLineGraphMapper) {
<span class="fc" id="L258">        return new MeasurementMapper(pkbServiceUtil, sparkLineGraphMapper);</span>
    }

    @Bean
    public SparkLineGraphMapper measurementGraphMapper(DateTimeService dateTimeService) {
<span class="fc" id="L263">        return new SparkLineGraphMapper(dateTimeService);</span>
    }

    @Bean
    public AppointmentEntryMapper appointmentEntryMapper(PKBServiceUtil pkbServiceUtil, PhrConfig config, DateTimeService dateTimeService, AppointmentMessagingSettingsService appointmentMessagingSettingsService) {
<span class="fc" id="L268">        return new AppointmentEntryMapper(pkbServiceUtil, config, dateTimeService, appointmentMessagingSettingsService);</span>
    }

    @Bean
    public MeasurementEntryMapper measurementEntryMapper(PKBServiceUtil pkbServiceUtil) {
<span class="fc" id="L273">        return new MeasurementEntryMapper(pkbServiceUtil);</span>
    }

    @Bean
    public ConsentTeamMapper consentTeamMapper(PKBServiceUtil pkbServiceUtil, TeamUserManager teamUserManager) {
<span class="fc" id="L278">        return new ConsentTeamMapper(pkbServiceUtil, teamUserManager);</span>
    }

    @Bean
    public ConsentIndividualMapper consentIndividualMapper(PKBServiceUtil pkbServiceUtil) {
<span class="fc" id="L283">        return new ConsentIndividualMapper(pkbServiceUtil);</span>
    }

    @Bean
    public SupportCodeGenerator supportCodeGenerator(DateTimeService dateTimeService) {
<span class="fc" id="L288">        return new SupportCodeGenerator(dateTimeService);</span>
    }

    @Bean
    public ExceptionService exceptionService() {
<span class="fc" id="L293">        return new ExceptionService();</span>
    }

    @Bean
    public RadiologyAudioEntryMapper radiologyAudioEntryMapper(PKBServiceUtil pkbServiceUtil) {
<span class="fc" id="L298">        return new RadiologyAudioEntryMapper(pkbServiceUtil);</span>
    }

    @Bean
    public TeamService teamService(PatientConsentManager patientConsentManager, PKBEmailMessageManager emailMessageManager, CryptoModelSynchronisationService cryptoModelSynchronisationService) {
<span class="fc" id="L303">        return new TeamService(patientConsentManager, emailMessageManager, cryptoModelSynchronisationService);</span>
    }

    @Bean
    public LetterInvitationService defaultInvitationService(LetterInvitationManager letterInvitationManager,
                                                            AccountUserService accountUserService, PersonService personService) {
<span class="fc" id="L309">        return new LetterInvitationService(letterInvitationManager, accountUserService, personService);</span>
    }

    @Bean
    public AccountPrivateKeyMapper accountPrivateKeyMapper() {
<span class="fc" id="L314">        return new AccountPrivateKeyMapper();</span>
    }


    @Bean
    public InternalStateClearerService internalStateClearerService(InternalStateManager internalStateManager) {
<span class="fc" id="L320">        return new InternalStateClearerService(internalStateManager);</span>
    }

    @Bean
    public LetterInvitationMetrics invitationMetrics() {
<span class="fc" id="L325">        return new LetterInvitationMetrics();</span>
    }

    @Bean
    public ProgressItemMapper progressItemMapper(PKBServiceUtil pkbServiceUtil) {
<span class="fc" id="L330">        return new ProgressItemMapper(pkbServiceUtil);</span>
    }

    @Bean
    public OrgMapper orgMapper() {
<span class="fc" id="L335">        return new OrgMapper();</span>
    }

    @Bean
    public TeamMapper teamMapper(OrgMapper orgMapper) {
<span class="fc" id="L340">        return new TeamMapper(orgMapper);</span>
    }

    @Bean
    public OrgLevelIdTypeMapper orgLevelIdTypeMapper(OrgMapper orgMapper) {
<span class="fc" id="L345">        return new OrgLevelIdTypeMapper(orgMapper);</span>
    }

    @Bean
    public OrgLevelIdMapper orgLevelIdMapper(OrgMapper orgMapper, OrgLevelIdTypeMapper orgLevelIdTypeMapper) {
<span class="fc" id="L350">        return new OrgLevelIdMapper(orgMapper, orgLevelIdTypeMapper);</span>
    }

    @Bean
    public NationalIdMapper nationalIdMapper() {
<span class="fc" id="L355">        return new NationalIdMapper();</span>
    }

    @Bean
    public MedmijService medmijService(TeamUserManager teamUserManager, PhrConfig config) {
<span class="fc" id="L360">        return new MedmijService(teamUserManager, config);</span>
    }

    @Bean
    public AppointmentViewMapper appointmentViewMapper(PKBServiceUtil pkbServiceUtil, PhrConfig config, DateTimeService dateTimeService, AppointmentMessagingSettingsService appointmentMessagingSettingsService) {
<span class="fc" id="L365">        return new AppointmentViewMapper(pkbServiceUtil, config, dateTimeService, appointmentMessagingSettingsService);</span>
    }

    @Bean
    public AppointmentActionsMapper appointmentMoreOptionsMapper(PKBServiceUtil pkbServiceUtil, PhrConfig config, DateTimeService dateTimeService, AppointmentMessagingSettingsService appointmentMessagingSettingsService) {
<span class="fc" id="L370">        return new AppointmentActionsMapper(pkbServiceUtil, config, dateTimeService, appointmentMessagingSettingsService);</span>
    }

    @Bean
    public ValidicErrorHelper validicErrorHelper() {
<span class="fc" id="L375">        return new ValidicErrorHelper();</span>
    }

    @Bean
    public CsvStreamService csvStreamService() {
<span class="fc" id="L380">        return new CsvStreamService(new UncheckedCsvPrinter.Factory());</span>
    }

    @Bean
    public CodingMatchImportService codingMatchImportService(CodingMatchImportRepository codingMatchImportRepository, CodingMatchImportTransformTempTableRepository cmiTransformRepository, CodingMatchImportNewRecordsTempTableRepository cmiNewRecordsTempTableRepository, CodingTranslationService codingTranslationService, DateTimeService dateTimeService) {
<span class="fc" id="L385">        int hibernateJdbcBatchSize = Integer.parseInt(System.getProperty(&quot;HIBERNATE_JDBC_BATCH_SIZE&quot;, &quot;10&quot;));</span>
<span class="fc" id="L386">        return new CodingMatchImportService(codingMatchImportRepository, cmiTransformRepository, cmiNewRecordsTempTableRepository, codingTranslationService, dateTimeService, hibernateJdbcBatchSize);</span>
    }

    @Bean
    public CodingMatchExportService codingMatchExportService(CodingMatchRepository codingMatchRepository, EmisJobArtifactService emisJobArtifactService, CsvStreamService csvStreamService, DateTimeService dateTimeService) {
<span class="fc" id="L391">        return new CodingMatchExportService(codingMatchRepository, emisJobArtifactService, csvStreamService, dateTimeService);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>