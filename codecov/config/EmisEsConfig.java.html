<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>EmisEsConfig.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">E2E Tests Coverage Report</a> &gt; <a href="index.source.html" class="el_package">config</a> &gt; <span class="el_source">EmisEsConfig.java</span></div><h1>EmisEsConfig.java</h1><pre class="source lang-java linenums">package config;

import com.pkb.common.config.PhrConfig;
import com.pkb.common.datetime.DateTimeService;
import com.pkb.domain.AccountService;
import com.pkb.externalid.service.ExternalIdService;
import com.pkb.kms.client.core.Kms;
import com.pkb.mappers.EmisEsJobStateToEmisInformationDtoMapper;
import com.pkb.model.PKBPersonDTO;
import com.pkb.service.code.CodingTranslationService;
import com.pkb.service.coding.CodingManager;
import com.pkb.service.dataupload.emis.esv2.EmisBatchProcessor;
import com.pkb.service.dataupload.emis.esv2.EmisBatchVerifier;
import com.pkb.service.dataupload.emis.esv2.EmisConfigurationUtils;
import com.pkb.service.dataupload.emis.esv2.EmisCsvProcessorProvider;
import com.pkb.service.dataupload.emis.esv2.EmisDiagnosticService;
import com.pkb.service.dataupload.emis.esv2.EmisDownloadBatchBuilder;
import com.pkb.service.dataupload.emis.esv2.EmisDownloader;
import com.pkb.service.dataupload.emis.esv2.EmisEsBatchStateService;
import com.pkb.service.dataupload.emis.esv2.EmisEsCareRecordProcessingStateService;
import com.pkb.service.dataupload.emis.esv2.EmisEsDatestampSkipService;
import com.pkb.service.dataupload.emis.esv2.EmisEsDummyPatientService;
import com.pkb.service.dataupload.emis.esv2.EmisEsImmutableWhitelist;
import com.pkb.service.dataupload.emis.esv2.EmisEsJobStateService;
import com.pkb.service.dataupload.emis.esv2.EmisEsManager;
import com.pkb.service.dataupload.emis.esv2.EmisEsMissingCodeHelper;
import com.pkb.service.dataupload.emis.esv2.EmisEsMutableWhiteList;
import com.pkb.service.dataupload.emis.esv2.EmisEsProcessedRowService;
import com.pkb.service.dataupload.emis.esv2.EmisEsService;
import com.pkb.service.dataupload.emis.esv2.EmisEsStatusService;
import com.pkb.service.dataupload.emis.esv2.EmisEsTableService;
import com.pkb.service.dataupload.emis.esv2.EmisEsWhitelistService;
import com.pkb.service.dataupload.emis.esv2.EmisFileSetUtils;
import com.pkb.service.dataupload.emis.esv2.EmisIntegrationService;
import com.pkb.service.dataupload.emis.esv2.EmisJobArtifactService;
import com.pkb.service.dataupload.emis.esv2.EmisOrgHelper;
import com.pkb.service.dataupload.emis.esv2.EmisPersonStatHelper;
import com.pkb.service.dataupload.emis.esv2.EmisProcessor;
import com.pkb.service.dataupload.emis.esv2.EmisVerifyBatchBuilder;
import com.pkb.service.dataupload.emis.esv2.batch.BatchDataProcessor;
import com.pkb.service.dataupload.emis.esv2.batch.BatchItemProcessor;
import com.pkb.service.dataupload.emis.esv2.batch.EmisProcessorAborter;
import com.pkb.service.dataupload.emis.esv2.batch.NoopEmisProcessorAborter;
import com.pkb.service.dataupload.emis.esv2.batch.TestEmisProcessorAborter;
import com.pkb.service.dataupload.emis.esv2.batch.impl.AccountIdErrorHelper;
import com.pkb.service.dataupload.emis.esv2.batch.impl.AdminOrganisationProcessor;
import com.pkb.service.dataupload.emis.esv2.batch.impl.AdminPatientProcessor;
import com.pkb.service.dataupload.emis.esv2.batch.impl.AdminUserInRoleProcessor;
import com.pkb.service.dataupload.emis.esv2.batch.impl.BatchProcessingCache;
import com.pkb.service.dataupload.emis.esv2.batch.impl.CareRecordObservationBatchCodeValidator;
import com.pkb.service.dataupload.emis.esv2.batch.impl.CareRecordObservationBatchProcessor;
import com.pkb.service.dataupload.emis.esv2.batch.impl.CareRecordProblemCache;
import com.pkb.service.dataupload.emis.esv2.batch.impl.CareRecordProblemProcessor;
import com.pkb.service.dataupload.emis.esv2.batch.impl.CodingClinicalCodeProcessor;
import com.pkb.service.dataupload.emis.esv2.batch.impl.CodingDrugCodeProcessor;
import com.pkb.service.dataupload.emis.esv2.batch.impl.EmisTestResultObservationHelper;
import com.pkb.service.dataupload.emis.esv2.batch.impl.PrescribingDrugRecordBatchCodeValidator;
import com.pkb.service.dataupload.emis.esv2.batch.impl.PrescribingDrugRecordProcessor;
import com.pkb.service.dataupload.emis.esv2.batch.impl.StatelessAdminOrganisationProcessor;
import com.pkb.service.dataupload.emis.esv2.batch.impl.StatelessAdminPatientProcessor;
import com.pkb.service.dataupload.emis.esv2.batch.impl.StatelessCodingClinicalCodeProcessor;
import com.pkb.service.dataupload.emis.esv2.batch.impl.StatelessCodingDrugCodeProcessor;
import com.pkb.service.dataupload.emis.esv2.batch.impl.observation.ObservationDeltaHandler;
import com.pkb.service.dataupload.emis.esv2.batch.impl.observation.ObservationHandler;
import com.pkb.service.dataupload.emis.esv2.converters.EmisLsEntryToEmisFileConverter;
import com.pkb.service.dataupload.emis.esv2.converters.EmisReadCodeConverter;
import com.pkb.service.dataupload.emis.esv2.converters.StringToEmisFileTypeConverter;
import com.pkb.service.dataupload.emis.esv2.mapping.AdminOrganisationMapper;
import com.pkb.service.dataupload.emis.esv2.mapping.AdminPatientMapper;
import com.pkb.service.dataupload.emis.esv2.mapping.AdminUserInRoleMapper;
import com.pkb.service.dataupload.emis.esv2.mapping.CodingClinicalCodeMapper;
import com.pkb.service.dataupload.emis.esv2.mapping.CodingDrugCodeMapper;
import com.pkb.service.dataupload.emis.esv2.model.AdminPatient;
import com.pkb.service.dataupload.emis.esv2.pgp.EmisPGPInputStreamProvider;
import com.pkb.service.dataupload.emis.esv2.repository.EmisEsBatchStateRepository;
import com.pkb.service.dataupload.emis.esv2.repository.EmisEsCareRecordProcessingStateRepository;
import com.pkb.service.dataupload.emis.esv2.repository.EmisEsDatestampSkipRepository;
import com.pkb.service.dataupload.emis.esv2.repository.EmisEsDummyPatientRepository;
import com.pkb.service.dataupload.emis.esv2.repository.EmisEsJobStateRepository;
import com.pkb.service.dataupload.emis.esv2.repository.EmisEsProcessedRowRepository;
import com.pkb.service.dataupload.emis.esv2.repository.EmisJobArtifactRepository;
import com.pkb.service.dataupload.emis.esv2.repository.csv.EmisEsAdminOrganizationRepository;
import com.pkb.service.dataupload.emis.esv2.repository.csv.EmisEsAdminPatientRepository;
import com.pkb.service.dataupload.emis.esv2.repository.csv.EmisEsAdminUserInRoleRepository;
import com.pkb.service.dataupload.emis.esv2.repository.csv.EmisEsCodingClinicalCodeRepository;
import com.pkb.service.dataupload.emis.esv2.repository.csv.EmisEsCodingDrugCodeRepository;
import com.pkb.service.dataupload.emis.esv2.sorting.EmisCsvReader;
import com.pkb.service.emis.EmisEsObservationDeltaManager;
import com.pkb.service.institute.OrgSurvivingStateService;
import com.pkb.service.medication.EHRMedicationManager;
import com.pkb.service.notification.impl.tolven.INotificationManager;
import com.pkb.service.patientconsent.PatientConsentManager;
import com.pkb.service.team.TeamManager;
import com.pkb.service.team.TeamService;
import com.pkb.service.team.TeamUserManager;
import com.pkb.service.test.LoincManager;
import com.pkb.service.user.impl.UserAccessManager;
import com.pkb.service.user.impl.UserManager;
import com.pkb.service.uuid.UUIDProvider;
import com.pkb.user.entity.PKBPersonHelper;
import com.pkb.util.CsvStreamService;
import com.pkb.util.tolven.TolvenBeanFactory;
import org.quartz.Scheduler;
import org.springframework.beans.factory.BeanFactory;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Scope;

import java.io.IOException;
import java.util.Set;

import static org.springframework.beans.factory.config.ConfigurableBeanFactory.SCOPE_PROTOTYPE;

@Configuration
<span class="fc" id="L115">public class EmisEsConfig {</span>

    @Bean
    public EmisFileSetUtils emisFileSetUtils() {
<span class="fc" id="L119">        return new EmisFileSetUtils();</span>
    }

    @Bean
    public EmisPGPInputStreamProvider emisPGPInputStreamProvider() {
<span class="fc" id="L124">        return new EmisPGPInputStreamProvider();</span>
    }

    @Bean
    public StringToEmisFileTypeConverter stringToEmisFileTypeConverter() {
<span class="fc" id="L129">        return new StringToEmisFileTypeConverter();</span>
    }

    @Bean
    public EmisLsEntryToEmisFileConverter fileNameToEmisFileConverter(StringToEmisFileTypeConverter stringToEmisFileTypeConverter) {
<span class="fc" id="L134">        return new EmisLsEntryToEmisFileConverter(stringToEmisFileTypeConverter);</span>
    }

    @Bean
    public EmisCsvProcessorProvider emisCsvProcessorProvider(Set&lt;BatchDataProcessor&gt; dataTypeProcessors) {
        //noinspection unchecked
<span class="fc" id="L140">        return new EmisCsvProcessorProvider((Set) dataTypeProcessors);</span>
    }

    @Bean
    @Scope(value = SCOPE_PROTOTYPE)
    public EmisDownloadBatchBuilder emisDownloadBatchBuilder(EmisLsEntryToEmisFileConverter emisLsEntryToEmisFileConverter, PhrConfig config, EmisEsDatestampSkipService emisEsDatestampSkipService) {
<span class="fc" id="L146">        return new EmisDownloadBatchBuilder(emisLsEntryToEmisFileConverter, config, emisEsDatestampSkipService);</span>
    }

    @Bean
    @Scope(value = SCOPE_PROTOTYPE)
    public EmisVerifyBatchBuilder emisVerifyBatchBuilder(EmisLsEntryToEmisFileConverter emisLsEntryToEmisFileConverter, PhrConfig config, EmisEsDatestampSkipService emisEsDatestampSkipService) {
<span class="fc" id="L152">        return new EmisVerifyBatchBuilder(emisLsEntryToEmisFileConverter, config, emisEsDatestampSkipService);</span>
    }

    @Bean
    public EmisBatchVerifier emisBatchVerifier(EmisCsvProcessorProvider emisCsvProcessorProvider, EmisFileSetUtils emisFileSetUtils, EmisPGPInputStreamProvider emisPGPInputStreamProvider, BeanFactory beanFactory, PhrConfig config, EmisEsDatestampSkipService emisEsDatestampSkipService) {
        //noinspection unchecked
<span class="fc" id="L158">        return new EmisBatchVerifier(emisCsvProcessorProvider, emisFileSetUtils, emisPGPInputStreamProvider, beanFactory, config, emisEsDatestampSkipService);</span>
    }

    @Bean
    public EmisDownloader emisSftpDownloader(EmisFileSetUtils emisFileSetUtils, BeanFactory beanFactory) {
<span class="fc" id="L163">        return new EmisDownloader(emisFileSetUtils, beanFactory);</span>
    }

    @Bean
    public EmisEsStatusService emisEsStatusService(DateTimeService dateTimeService, EmisEsBatchStateService emisEsBatchStateService, EmisEsMissingCodeHelper emisEsMissingCodeHelper) {
<span class="fc" id="L168">        return new EmisEsStatusService(dateTimeService, emisEsBatchStateService, emisEsMissingCodeHelper, new EmisEsJobStateToEmisInformationDtoMapper());</span>
    }

    @Bean
    public EmisOrgHelper emisOrgHelper(EmisJobArtifactRepository emisJobArtifactRepository) {
<span class="fc" id="L173">        return new EmisOrgHelper(emisJobArtifactRepository);</span>
    }

    @Bean
    public EmisPersonStatHelper emisPersonStatHelper() {
<span class="fc" id="L178">        return new EmisPersonStatHelper();</span>
    }

    @Bean
    public EmisIntegrationService emisIntegrationService(EmisDownloader emisDownloaderService,
                                                         EmisBatchVerifier emisBatchVerifier,
                                                         EmisProcessor emisProcessor,
                                                         EmisConfigurationUtils emisConfigurationUtils,
                                                         EmisEsBatchStateService emisEsBatchStateService,
                                                         EmisEsMissingCodeHelper missingCodeHelper,
                                                         EmisEsManager emisEsManager,
                                                         EmisEsStatusService emisEsStatusService,
                                                         EmisOrgHelper emisOrgHelper,
                                                         EmisPersonStatHelper emisPersonStatHelper) {
<span class="fc" id="L192">        return new EmisIntegrationService(emisDownloaderService, emisBatchVerifier, emisProcessor, emisConfigurationUtils, emisEsBatchStateService, missingCodeHelper, emisEsManager, emisEsStatusService, emisOrgHelper, emisPersonStatHelper);</span>
    }

    @Bean
    public EmisBatchProcessor emisBatchProcessor(EmisCsvProcessorProvider emisCsvProcessorProvider, Set&lt;BatchProcessingCache&gt; batchProcessingCaches,
                                                 CareRecordObservationBatchCodeValidator careRecordObservationBatchCodeValidator,
                                                 PrescribingDrugRecordBatchCodeValidator prescribingDrugRecordBatchCodeValidator,
                                                 StatelessCodingClinicalCodeProcessor statelessCodingClinicalCodeProcessor,
                                                 StatelessCodingDrugCodeProcessor statelessCodingDrugCodeProcessor,
                                                 StatelessAdminOrganisationProcessor statelessAdminOrganisationProcessor,
                                                 StatelessAdminPatientProcessor statelessAdminPatientProcessor,
                                                 EmisCsvReader csvSorter,
                                                 EmisEsProcessedRowService emisEsProcessedRowService,
                                                 PhrConfig configuration,
                                                 EmisEsStatusService emisEsStatusService,
                                                 EmisEsDatestampSkipService emisEsDatestampSkipService) {
        // TODO: PHR-5617 revisit if can use Set&lt;BatchDataProcessor&lt;BaseEmisEsDomainModel&gt;&gt; as in spring 3
<span class="fc" id="L209">        return new EmisBatchProcessor(emisCsvProcessorProvider, batchProcessingCaches, careRecordObservationBatchCodeValidator, prescribingDrugRecordBatchCodeValidator, statelessCodingClinicalCodeProcessor, statelessCodingDrugCodeProcessor, statelessAdminOrganisationProcessor, statelessAdminPatientProcessor, csvSorter, emisEsProcessedRowService, configuration, emisEsStatusService, emisEsDatestampSkipService);</span>
    }

    @Bean
    public StatelessCodingClinicalCodeProcessor statelessCodingClinicalCodeProcessor(EmisEsProcessedRowService emisEsProcessedRowService, EmisEsManager emisEsManager, EmisProcessorAborter emisProcessAborter, Kms kmsClient, PhrConfig config, DateTimeService dateTimeService, ExternalIdService externalIdService, INotificationManager notificationManager, EmisEsStatusService emisEsStatusService, EmisOrgHelper emisOrgHelper) {
<span class="fc" id="L214">        return new StatelessCodingClinicalCodeProcessor(emisEsProcessedRowService, emisEsManager, emisProcessAborter, kmsClient, config, dateTimeService, externalIdService, notificationManager, emisEsStatusService, emisOrgHelper);</span>
    }

    @Bean
    public StatelessCodingDrugCodeProcessor statelessCodingDrugCodeProcessor(EmisEsProcessedRowService emisEsProcessedRowService, EmisEsManager emisEsManager, EmisProcessorAborter emisProcessAborter, Kms kmsClient, PhrConfig config, DateTimeService dateTimeService, ExternalIdService externalIdService, INotificationManager notificationManager, EmisEsStatusService emisEsStatusService, EmisOrgHelper emisOrgHelper) {
<span class="fc" id="L219">        return new StatelessCodingDrugCodeProcessor(emisEsProcessedRowService, emisEsManager, emisProcessAborter, kmsClient, config, dateTimeService, externalIdService, notificationManager, emisEsStatusService, emisOrgHelper);</span>
    }

    @Bean
    public StatelessAdminOrganisationProcessor statelessAdminOrganisationProcessor(EmisEsProcessedRowService emisEsProcessedRowService, EmisEsManager emisEsManager, EmisProcessorAborter emisProcessAborter, Kms kmsClient, PhrConfig config, DateTimeService dateTimeService, ExternalIdService externalIdService, INotificationManager notificationManager, EmisEsStatusService emisEsStatusService, EmisOrgHelper emisOrgHelper) {
<span class="fc" id="L224">        return new StatelessAdminOrganisationProcessor(emisEsProcessedRowService, emisEsManager, emisProcessAborter, kmsClient, config, dateTimeService, externalIdService, notificationManager, emisEsStatusService, emisOrgHelper);</span>
    }

    @Bean
    public StatelessAdminPatientProcessor statelessAdminPatientProcessor(EmisEsProcessedRowService emisEsProcessedRowService, EmisEsManager emisEsManager,
                                                                         EmisProcessorAborter emisProcessAborter, Kms kmsClient, PhrConfig config,
                                                                         DateTimeService dateTimeService, ExternalIdService externalIdService,
                                                                         INotificationManager notificationManager, TeamService teamService,
                                                                         TeamUserManager teamUserManager, UserManager userManager,
                                                                         UserAccessManager userAccessManager,
                                                                         BatchItemProcessor&lt;AdminPatient, PKBPersonDTO&gt; adminPatientItemProcessor,
                                                                         PatientConsentManager patientConsentManager,
                                                                         PKBPersonHelper pkbPersonHelper, EmisEsStatusService emisEsStatusService,
                                                                         EmisOrgHelper emisOrgHelper, EmisEsAdminPatientRepository emisEsAdminPatientRepository,
                                                                         EmisEsDummyPatientService emisEsDummyPatientService) {
<span class="fc" id="L239">        return new StatelessAdminPatientProcessor(emisEsProcessedRowService, emisEsManager, emisProcessAborter, kmsClient, config, dateTimeService,</span>
                externalIdService, notificationManager, teamService, teamUserManager, userManager, adminPatientItemProcessor,
                patientConsentManager, pkbPersonHelper, emisEsStatusService, emisOrgHelper, emisEsAdminPatientRepository,
                emisEsDummyPatientService);
    }


    @Bean
    public CareRecordObservationBatchCodeValidator careRecordObservationBatchCodeValidator(PhrConfig configuration, EmisEsManager emisEsManager, EmisPersonStatHelper emisPersonStatHelper) {
<span class="fc" id="L248">        return new CareRecordObservationBatchCodeValidator(configuration, emisEsManager, emisPersonStatHelper);</span>
    }

    @Bean
    public PrescribingDrugRecordBatchCodeValidator prescribingDrugRecordBatchCodeValidator(PhrConfig configuration, EmisEsManager emisEsManager, EmisPersonStatHelper emisPersonStatHelper) {
<span class="fc" id="L253">        return new PrescribingDrugRecordBatchCodeValidator(configuration, emisEsManager, emisPersonStatHelper);</span>
    }

    @Bean
    public EmisProcessor emisProcessor(EmisBatchProcessor emisBatchProcessor, EmisFileSetUtils emisFileSetUtils, EmisEsBatchStateService emisEsBatchStateService, EmisEsStatusService emisEsStatusService, PhrConfig configuration, EmisPersonStatHelper emisPersonStatHelper) {
<span class="fc" id="L258">        return new EmisProcessor(emisBatchProcessor, emisFileSetUtils, emisEsBatchStateService, emisEsStatusService, configuration, emisPersonStatHelper);</span>
    }

    @Bean
    public EmisConfigurationUtils emisConfigurationUtils(PhrConfig configuration) {
<span class="fc" id="L263">        return new EmisConfigurationUtils(configuration);</span>
    }

    @Bean
    public EmisDiagnosticService emisDiagnosticService(EmisConfigurationUtils emisConfigurationUtils, PhrConfig configuration) {
<span class="fc" id="L268">        return new EmisDiagnosticService(emisConfigurationUtils, configuration);</span>
    }

    @Bean
    public EmisEsService emisEsService(EmisEsJobStateService emisEsJobStateService, Scheduler scheduler, EmisEsBatchStateService emisEsBatchStateService, EmisConfigurationUtils emisConfigurationUtils) {
<span class="fc" id="L273">        return new EmisEsService(emisEsJobStateService, scheduler, emisEsBatchStateService, new EmisEsJobStateToEmisInformationDtoMapper(), emisConfigurationUtils);</span>
    }

    @Bean
    public EmisReadCodeConverter emisReadCodeConverter() {
<span class="fc" id="L278">        return new EmisReadCodeConverter();</span>
    }

    @Bean
    public EmisEsBatchStateService emisBatchStateService(EmisEsBatchStateRepository emisEsBatchStateRepository, DateTimeService dateTimeService) {
<span class="fc" id="L283">        return new EmisEsBatchStateService(emisEsBatchStateRepository, dateTimeService);</span>
    }

    @Bean
    public EmisEsProcessedRowService emisEsProcessedRowService(EmisEsProcessedRowRepository emisEsProcessedRowRepository) {
<span class="fc" id="L288">        return new EmisEsProcessedRowService(emisEsProcessedRowRepository);</span>
    }

    @Bean
    public EmisEsCareRecordProcessingStateService emisEsCareRecordProcessingStateService(EmisEsCareRecordProcessingStateRepository emisEsCareRecordProcessingStateRepository) {
<span class="fc" id="L293">        return new EmisEsCareRecordProcessingStateService(emisEsCareRecordProcessingStateRepository);</span>
    }

    @Bean
    public EmisEsJobStateService emisEsJobStateService(EmisEsJobStateRepository emisEsJobStateRepository, DateTimeService dateTimeService) {
<span class="fc" id="L298">        return new EmisEsJobStateService(emisEsJobStateRepository, dateTimeService);</span>
    }

    @Bean
    public CareRecordObservationBatchProcessor careRecordObservationBatchProcessor(EmisEsProcessedRowService emisEsProcessedRowService, EmisEsManager emisEsManager, EmisProcessorAborter emisProcessAborter, Kms kmsClient, PhrConfig config, DateTimeService dateTimeService, ExternalIdService externalIdService, INotificationManager notificationManager, java.util.Set&lt;ObservationHandler&gt; handlers, TolvenBeanFactory beanFactory, UserManager userManager, EmisEsStatusService emisEsStatusService, EmisOrgHelper emisOrgHelper, EmisPersonStatHelper emisPersonStatHelper, EmisTestResultObservationHelper emisTestResultObservationHelper) {
<span class="fc" id="L303">        return new CareRecordObservationBatchProcessor(emisEsProcessedRowService, emisEsManager, emisProcessAborter, kmsClient, config, dateTimeService, externalIdService, notificationManager, handlers, beanFactory, userManager, emisEsStatusService, emisOrgHelper, emisPersonStatHelper, emisTestResultObservationHelper);</span>
    }

    @Bean
    public AdminPatientProcessor adminPatientProcessor(EmisEsProcessedRowService emisEsProcessedRowService, EmisEsManager emisEsManager,
                                                       EmisProcessorAborter emisProcessAborter, Kms kmsClient, PhrConfig config,
                                                       DateTimeService dateTimeService, ExternalIdService externalIdService,
                                                       INotificationManager notificationManager, TeamService teamService,
                                                       TeamUserManager teamUserManager, UserManager userManager,
                                                       BatchItemProcessor&lt;AdminPatient, PKBPersonDTO&gt; adminPatientItemProcessor,
                                                       PatientConsentManager deprecatedPatientConsentManager, PKBPersonHelper pkbPersonHelper,
                                                       EmisEsStatusService emisEsStatusService, EmisOrgHelper emisOrgHelper,
                                                       EmisEsDummyPatientService emisEsDummyPatientService) {
<span class="fc" id="L316">        return new AdminPatientProcessor(emisEsProcessedRowService, emisEsManager, emisProcessAborter, kmsClient, config, dateTimeService,</span>
                externalIdService, notificationManager, teamService, teamUserManager, userManager, adminPatientItemProcessor,
                deprecatedPatientConsentManager, pkbPersonHelper, emisEsStatusService, emisOrgHelper, emisEsDummyPatientService);
    }

    @Bean
    public AdminUserInRoleProcessor adminUserInRoleProcessor(EmisEsProcessedRowService emisEsProcessedRowService, EmisEsManager emisEsManager, EmisProcessorAborter emisProcessAborter, Kms kmsClient, PhrConfig config, DateTimeService dateTimeService, ExternalIdService externalIdService, INotificationManager notificationManager, EmisEsStatusService emisEsStatusService, EmisOrgHelper emisOrgHelper) {
<span class="fc" id="L323">        return new AdminUserInRoleProcessor(emisEsProcessedRowService, emisEsManager, emisProcessAborter, kmsClient, config, dateTimeService, externalIdService, notificationManager, emisEsStatusService, emisOrgHelper);</span>
    }

    @Bean
    public AdminOrganisationProcessor adminOrganisationProcessor(EmisEsProcessedRowService emisEsProcessedRowService, EmisEsManager emisEsManager, EmisProcessorAborter emisProcessAborter, Kms kmsClient, PhrConfig config, DateTimeService dateTimeService, ExternalIdService externalIdService, INotificationManager notificationManager, EmisEsStatusService emisEsStatusService, EmisOrgHelper emisOrgHelper) {
<span class="fc" id="L328">        return new AdminOrganisationProcessor(emisEsProcessedRowService, emisEsManager, emisProcessAborter, kmsClient, config, dateTimeService, externalIdService, notificationManager, emisEsStatusService, emisOrgHelper);</span>
    }

    @Bean
    public CodingDrugCodeProcessor codingDrugCodeProcessor(EmisEsProcessedRowService emisEsProcessedRowService, EmisEsManager emisEsManager, EmisProcessorAborter emisProcessAborter, Kms kmsClient, PhrConfig config, DateTimeService dateTimeService, ExternalIdService externalIdService, INotificationManager notificationManager, EmisEsStatusService emisEsStatusService, EmisOrgHelper emisOrgHelper) {
<span class="fc" id="L333">        return new CodingDrugCodeProcessor(emisEsProcessedRowService, emisEsManager, emisProcessAborter, kmsClient, config, dateTimeService, externalIdService, notificationManager, emisEsStatusService, emisOrgHelper);</span>
    }

    @Bean
    public CodingClinicalCodeProcessor codingClinicalCodeProcessor(EmisEsProcessedRowService emisEsProcessedRowService, EmisEsManager emisEsManager, EmisProcessorAborter emisProcessAborter, Kms kmsClient, PhrConfig config, DateTimeService dateTimeService, ExternalIdService externalIdService, INotificationManager notificationManager, EmisEsStatusService emisEsStatusService, EmisOrgHelper emisOrgHelper) {
<span class="fc" id="L338">        return new CodingClinicalCodeProcessor(emisEsProcessedRowService, emisEsManager, emisProcessAborter, kmsClient, config, dateTimeService, externalIdService, notificationManager, emisEsStatusService, emisOrgHelper);</span>
    }

    @Bean
    public CareRecordProblemProcessor careRecordProblemProcessor(EmisEsProcessedRowService emisEsProcessedRowService, EmisEsManager emisEsManager, EmisProcessorAborter emisProcessAborter, Kms kmsClient, PhrConfig config, DateTimeService dateTimeService, ExternalIdService externalIdService, INotificationManager notificationManager, CareRecordProblemCache problemCache, ObservationDeltaHandler observationDeltaHandler, UserManager userManager, EmisEsStatusService emisEsStatusService, EmisOrgHelper emisOrgHelper, EmisPersonStatHelper emisPersonStatHelper, AccountIdErrorHelper accountIdErrorHelper) {
<span class="fc" id="L343">        return new CareRecordProblemProcessor(emisEsProcessedRowService, emisEsManager, emisProcessAborter, kmsClient, config, dateTimeService, externalIdService, notificationManager, problemCache, observationDeltaHandler, userManager, emisEsStatusService, emisOrgHelper, emisPersonStatHelper, accountIdErrorHelper);</span>
    }

    @Bean
    public PrescribingDrugRecordProcessor prescribingDrugRecordProcessor(EmisEsProcessedRowService emisEsProcessedRowService, EmisEsManager emisEsManager, EmisProcessorAborter emisProcessAborter, Kms kmsClient, PhrConfig config, DateTimeService dateTimeService, ExternalIdService externalIdService, INotificationManager notificationManager, UserManager userManager, TolvenBeanFactory beanFactory, EmisEsStatusService emisEsStatusService, EmisOrgHelper emisOrgHelper, EmisPersonStatHelper emisPersonStatHelper, EHRMedicationManager ehrMedicationManager) {
<span class="fc" id="L348">        return new PrescribingDrugRecordProcessor(emisEsProcessedRowService, emisEsManager, emisProcessAborter, kmsClient, config, dateTimeService, externalIdService, notificationManager, userManager, beanFactory, emisEsStatusService, emisOrgHelper, emisPersonStatHelper, ehrMedicationManager);</span>
    }


    @Bean
    public EmisEsWhitelistService emisEsWhitelistService(PhrConfig config) {
<span class="pc bpc" id="L354" title="1 of 2 branches missed.">        if (config.getConfigStorage().isMutableConfigEnabled()) {</span>
<span class="fc" id="L355">            return new EmisEsMutableWhiteList(new EmisEsImmutableWhitelist(config), config);</span>
        }
<span class="nc" id="L357">        return new EmisEsImmutableWhitelist(config);</span>
    }

    @Bean
    public EmisEsMissingCodeHelper emisMissingCodeHelper(EmisJobArtifactRepository emisJobArtifactRepository) {
<span class="fc" id="L362">        return new EmisEsMissingCodeHelper(emisJobArtifactRepository);</span>
    }

    @Bean
    public EmisEsDatestampSkipService emisEsDatestampSkipService(EmisEsDatestampSkipRepository repository) {
<span class="fc" id="L367">        return new EmisEsDatestampSkipService(repository);</span>
    }

    @Bean
    public EmisEsDummyPatientService emisEsDummyPatientService(EmisEsDummyPatientRepository repository) {
<span class="fc" id="L372">        return new EmisEsDummyPatientService(repository);</span>
    }

    @Bean
    public EmisEsTableService emisEsTableService(EmisEsAdminOrganizationRepository emisEsAdminOrganizationRepository, EmisEsAdminPatientRepository emisEsAdminPatientRepository, EmisEsAdminUserInRoleRepository emisEsAdminUserInRoleRepository, EmisEsCodingDrugCodeRepository emisEsCodingDrugCodeRepository, EmisEsCodingClinicalCodeRepository emisEsCodingClinicalCodeRepository) {
<span class="fc" id="L377">        return new EmisEsTableService(emisEsAdminOrganizationRepository, emisEsAdminPatientRepository, emisEsAdminUserInRoleRepository, emisEsCodingDrugCodeRepository, emisEsCodingClinicalCodeRepository);</span>
    }

    @Bean
    public EmisEsManager emisEsManager(
            TolvenBeanFactory beanFactory,
            UserManager userManager,
            TeamManager teamManager,
            EmisEsWhitelistService emisEsWhitelistService,
            PhrConfig config,
            DateTimeService dateTimeService,
            UUIDProvider uuidProvider,
            EmisEsMissingCodeHelper missingCodeCache,
            EmisOrgHelper emisOrgHelper,
            EmisEsTableService emisEsTableService,
            AccountService accountService,
            EmisEsDummyPatientService emisEsDummyPatientService,
            OrgSurvivingStateService orgSurvivingStateService,
            CodingManager codingManager,
            EmisEsObservationDeltaManager emisEsObservationDeltaManager,
            CodingTranslationService codingTranslationService,
            LoincManager loincManager) throws IOException {

<span class="fc" id="L400">        var readCodeConverter = new EmisReadCodeConverter();</span>
<span class="fc" id="L401">        var adminOrganisationMapper = new AdminOrganisationMapper();</span>
<span class="fc" id="L402">        var adminPatientMapper = new AdminPatientMapper();</span>
<span class="fc" id="L403">        var codingClinicalCodeMapper = new CodingClinicalCodeMapper();</span>
<span class="fc" id="L404">        var codingDrugCodeMapper = new CodingDrugCodeMapper();</span>
<span class="fc" id="L405">        var adminUserInRoleMapper = new AdminUserInRoleMapper();</span>

<span class="fc" id="L407">        return new EmisEsManager(config, beanFactory, dateTimeService, uuidProvider, readCodeConverter, userManager, teamManager, emisEsWhitelistService, adminOrganisationMapper,</span>
                adminPatientMapper, codingClinicalCodeMapper, codingDrugCodeMapper, adminUserInRoleMapper, missingCodeCache, emisOrgHelper, emisEsTableService, accountService, emisEsDummyPatientService,
                orgSurvivingStateService, codingManager, emisEsObservationDeltaManager, codingTranslationService, loincManager);
    }

    @Bean
    public EmisProcessorAborter emisProcessAborter(PhrConfig config) {
<span class="pc bpc" id="L414" title="1 of 2 branches missed.">        if (config.isFakeDateTimeServiceEnabled()) {</span>
<span class="fc" id="L415">            return new TestEmisProcessorAborter();</span>
        }
<span class="nc" id="L417">        return new NoopEmisProcessorAborter();</span>
    }

    @Bean
    public EmisJobArtifactService emisJobArtifactService(EmisJobArtifactRepository emisJobArtifactRepository, CsvStreamService csvStreamService) {
<span class="fc" id="L422">        return new EmisJobArtifactService(emisJobArtifactRepository, csvStreamService);</span>
    }

    @Bean
    public AccountIdErrorHelper accountIdErrorHelper() {
<span class="fc" id="L427">        return new AccountIdErrorHelper();</span>
    }

    @Bean
    public EmisTestResultObservationHelper emisTestResultObservationHelper(EmisEsManager emisEsManager, DateTimeService dateTimeService) {
<span class="fc" id="L432">        return new EmisTestResultObservationHelper(emisEsManager, dateTimeService);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>