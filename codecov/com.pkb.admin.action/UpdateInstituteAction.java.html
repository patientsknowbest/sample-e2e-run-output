<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UpdateInstituteAction.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">E2E Tests Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.pkb.admin.action</a> &gt; <span class="el_source">UpdateInstituteAction.java</span></div><h1>UpdateInstituteAction.java</h1><pre class="source lang-java linenums">//------------------------------------------------------------------------------
//
// Copyright (c) 2009-2013 PatientsKnowBest, Inc. All Rights Reserved.
// $Id: UpdateInstituteAction.java Jun 18, 2010 11:57:57 AM anamikac$
//
//------------------------------------------------------------------------------
package com.pkb.admin.action;

import com.google.common.collect.Lists;
import com.opensymphony.xwork2.Action;
import com.pkb.datamodel.AppointmentMessagingSettings;
import com.pkb.datamodel.ImmutableAppointmentMessagingSettings;
import com.pkb.domain.appointment.AppointmentMessagingSettingsService;
import com.pkb.entities.enums.UserType;
import com.pkb.exception.PKBException;
import com.pkb.institute.entity.InstituteLibraryEntry;
import com.pkb.institute.entity.InstituteUser;
import com.pkb.institute.entity.Org;
import com.pkb.institute.entity.Team;
import com.pkb.institute.entity.Team.PatientIdSupport;
import com.pkb.institute.entity.TeamSymptom;
import com.pkb.service.team.TeamUserManager;
import com.pkb.service.user.impl.UserManager;
import com.pkb.user.entity.PKBPerson;
import com.pkb.util.IpFilterUtil;
import org.apache.commons.lang3.StringUtils;
import org.apache.struts2.interceptor.validation.SkipValidation;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.security.crypto.bcrypt.BCrypt;

import javax.naming.NamingException;
import javax.persistence.Column;
import java.io.File;
import java.io.IOException;
import java.util.Collections;
import java.util.Optional;
import java.util.Set;
import java.util.SortedSet;
import java.util.function.Consumer;
import java.util.function.Supplier;

import static com.pkb.service.dataupload.hl7.HL7ConnContextFactory.splitCsv;
import static com.pkb.service.dataupload.hl7.HL7Util.cleanHL7ValidatePidList;

<span class="fc" id="L46">public class UpdateInstituteAction extends InstituteBaseAction {</span>

    /*
    Custom actions
    */
    static final String ASSIGN_PRIVACY_OFFICER_FORM = &quot;assignPrivacyOfficerForm&quot;;
    private static final long serialVersionUID = 1L;
<span class="fc" id="L53">    private static final Logger LOGGER = LoggerFactory.getLogger(java.lang.invoke.MethodHandles.lookup().lookupClass());</span>
    private String code;
    private InstituteUser instituteUser;
    private TeamUserManager teamUserManager;
    private File logo;
    private String logoContentType;
    private String logoFileName;
    private File headerImg;
    private String headerImgContentType;
    private String headerImgFileName;
    private File footerImg;
    private String footerImgContentType;
    private String footerImgFileName;
    private long specialtyId;
    private boolean isCancerTeam;
    private String patientIdSupport;
    private long instituteUserId;
    private Org org;
<span class="fc" id="L71">    private String tab = &quot;customers&quot;;</span>
<span class="fc" id="L72">    private String subTab = &quot;customerList&quot;;</span>
    private String timeZoneId;
    private boolean hl7AutoCreateRecords;
    private boolean hl7CheckNhsNumberStatus;
    private String hl7IdList;
    private int maxEmailFooterLength;
    private boolean mandatoryNationalId;
    private File orgEmailFooterImage;
    private String orgEmailFooterImageFileName;
    private String orgEmailFooterImageContentType;
    /*
    These additional consent fields represent the default consent that will be requested
    from any new patient joining the team
    */
    private boolean defaultRequestGeneralConsent;
    private boolean defaultRequestSexualHealthConsent;
    private boolean defaultRequestMentalHealthConsent;
    private boolean defaultRequestSocialCareConsent;
<span class="fc" id="L90">    private boolean deleteOrgEmailFooterImage = false;</span>

    private boolean defaultNewProsContactable;
    private boolean teamBasedMessagingEnabled;

    private String hl7User;
    private String hl7Password;
    private boolean passwordAlreadySet;

    private boolean appointmentMessagingEnabled;
    private Long appointmentMessagingTeamId;

    private AppointmentMessagingSettingsService appointmentMessagingSettingsService;


    @Override
    public void prepare() throws Exception {
<span class="fc" id="L107">        maxEmailFooterLength = Org.class.getDeclaredField(&quot;emailFooterText&quot;).getAnnotation(Column.class).length();</span>
<span class="fc" id="L108">    }</span>

    /**
     * Update team details if the newly uploaded images are valid.
     */
    @Override
    public String execute() {
        try {
<span class="pc bpc" id="L116" title="1 of 2 branches missed.">            if (!validateImages()) {</span>
<span class="nc" id="L117">                return Action.INPUT;</span>
            }

<span class="fc" id="L120">            Set&lt;String&gt; ipWhitelist = splitCsv(instituteUser.getInstitute().getDataUploadIpWhitelist());</span>
<span class="fc bfc" id="L121" title="All 2 branches covered.">            if (!IpFilterUtil.looksLikeIpFilters(ipWhitelist)) {</span>
<span class="fc" id="L122">                addActionError(getText(&quot;err.admin.invalid.datauploadip&quot;));</span>
<span class="fc" id="L123">                return Action.INPUT;</span>
            }
<span class="fc" id="L125">            updateTeam();</span>
<span class="nc" id="L126">        } catch (Exception e) {</span>
<span class="nc" id="L127">            LOGGER.error(&quot;Error while creating institute&quot;, e);</span>
<span class="nc" id="L128">            addActionError(getText(&quot;err.update.institute&quot;) + &quot;:&quot; + e.getMessage());</span>
<span class="nc" id="L129">            return input();</span>
<span class="fc" id="L130">        }</span>
<span class="fc" id="L131">        return SUCCESS;</span>
    }

    /**
     * Update org details.
     *
     * @throws NamingException
     */
    @SkipValidation
    public String updateOrg() {
        try {
<span class="fc bfc" id="L142" title="All 4 branches covered.">            if (StringUtils.isNotEmpty(org.getEmailFooterText()) &amp;&amp; org.getEmailFooterText().length() &gt; maxEmailFooterLength) {</span>
<span class="fc" id="L143">                addActionError(getText(&quot;err.footer.size&quot;, Lists.newArrayList(maxEmailFooterLength)));</span>
<span class="fc" id="L144">                return input();</span>
            }

<span class="fc" id="L147">            Set&lt;String&gt; ipWhitelist = splitCsv(org.getDataUploadIpWhitelist());</span>
<span class="fc bfc" id="L148" title="All 2 branches covered.">            if (!IpFilterUtil.looksLikeIpFilters(ipWhitelist)) {</span>
<span class="fc" id="L149">                addActionError(getText(&quot;err.admin.invalid.datauploadip&quot;));</span>
<span class="fc" id="L150">                return input();</span>
            }

<span class="fc" id="L153">            Org existingOrgWithSameCode = teamManager.getOrgByCode(org.getCode()).orElse(null);</span>
<span class="pc bpc" id="L154" title="2 of 4 branches missed.">            if ((existingOrgWithSameCode != null) &amp;&amp; !existingOrgWithSameCode.getId().equals(org.getId())) {</span>
<span class="nc" id="L155">                throw new IllegalArgumentException(</span>
<span class="nc" id="L156">                        &quot;Organization code '&quot; + org.getCode() + &quot;' is already in use for '&quot; + existingOrgWithSameCode.getName() + &quot;'&quot;);</span>
            }

            // must be null or a valid team code
<span class="fc" id="L160">            org.setHl7NewPatientTeamCode(StringUtils.trimToNull(org.getHl7NewPatientTeamCode()));</span>

            // Things that cannot be edited!  Not supporting editing of external ids for now
            // TODO: this needs to be reviewed to ensure non editable attributes are unaffected
            // TODO: Might be better to update oldOrd with edited attributes for update
<span class="fc" id="L165">            Org oldOrg = teamManager.getOrg(org.getId(), Org.Lazy.EXTERNAL_IDS, Org.Lazy.TEAMS).orElse(null);</span>
<span class="fc" id="L166">            org.setTeams(oldOrg.getTeams());</span>
<span class="fc" id="L167">            org.setOrgLevelIdTypes(oldOrg.getOrgLevelIdTypes());</span>
<span class="fc" id="L168">            org.setOrgAccountId(oldOrg.getOrgAccountId());</span>
<span class="fc" id="L169">            org.setExternalIds(oldOrg.getExternalIds());</span>
<span class="fc" id="L170">            org.setTimeZoneId(oldOrg.getTimeZoneId());</span>
            // org code: only allow save if the current value is blank
<span class="pc bpc" id="L172" title="1 of 2 branches missed.">            if (StringUtils.isNotBlank(oldOrg.getCode())) {</span>
<span class="fc" id="L173">                org.setCode(oldOrg.getCode());</span>
            }

<span class="fc" id="L176">            org.setHl7UploadSourceWhitelist(getHl7UploadSourceMap(org));</span>
<span class="fc" id="L177">            org.setHl7UploadValidatePidList(cleanHL7ValidatePidList(org.getHl7UploadValidatePidList()));</span>

            // Only set this once
<span class="pc bpc" id="L180" title="1 of 4 branches missed.">            if (StringUtils.isBlank(oldOrg.getHl7PasswordHash()) &amp;&amp; StringUtils.isNotBlank(hl7Password)) {</span>
<span class="fc" id="L181">                org.setHl7PasswordHash(makePasswordHash(hl7Password));</span>
            } else {
<span class="fc" id="L183">                org.setHl7PasswordHash(oldOrg.getHl7PasswordHash());</span>
            }
<span class="fc" id="L185">            org.setPublicId(oldOrg.getPublicId());</span>

            try {
<span class="fc" id="L188">                if (setImageFileNameOrAction(logo, logoFileName, &quot;logo&quot;,</span>
<span class="pc bpc" id="L189" title="1 of 2 branches missed.">                        org::setLogoFileName, oldOrg::getLogoFileName).isPresent()) {</span>
<span class="nc" id="L190">                    return Action.INPUT;</span>
                }
<span class="fc bfc" id="L192" title="All 2 branches covered.">                if (!deleteOrgEmailFooterImage) {</span>
<span class="fc" id="L193">                    if (setImageFileNameOrAction(orgEmailFooterImage, orgEmailFooterImageFileName, &quot;orgEmailFooterImage&quot;,</span>
<span class="fc bfc" id="L194" title="All 2 branches covered.">                            org::setEmailFooterImageFilename, oldOrg::getEmailFooterImageFilename).isPresent()) {</span>
<span class="fc" id="L195">                        return Action.INPUT;</span>
                    }
                }
<span class="nc" id="L198">            } catch (PKBException | IOException e) {</span>
<span class="nc" id="L199">                LOGGER.error(&quot;Error while creating institute&quot;, e);</span>
<span class="nc" id="L200">                addActionError(getText(&quot;err.update.institute&quot;) + &quot;:&quot; + e.getMessage());</span>
<span class="nc" id="L201">                return input();</span>
<span class="fc" id="L202">            }</span>

<span class="fc bfc" id="L204" title="All 4 branches covered.">            if (appointmentMessagingEnabled &amp;&amp; appointmentMessagingTeamId&lt;1) {</span>
<span class="fc" id="L205">                    addFieldError(&quot;org.teamForAppointmentMessaging&quot;, getText(&quot;err.admin.must.select.team&quot;));</span>
<span class="fc" id="L206">                    return Action.INPUT;</span>
            }
<span class="fc" id="L208">            AppointmentMessagingSettings appointmentMessagingSettings = ImmutableAppointmentMessagingSettings.builder()</span>
<span class="fc" id="L209">                    .orgId(org.getId())</span>
<span class="fc" id="L210">                    .appointmentMessagingEnabled(appointmentMessagingEnabled)</span>
<span class="fc" id="L211">                    .appointmentMessagingTeamId(Optional.ofNullable(appointmentMessagingTeamId))</span>
<span class="fc" id="L212">                    .build();</span>
<span class="fc" id="L213">            appointmentMessagingSettingsService.save(appointmentMessagingSettings);</span>

<span class="fc" id="L215">            teamManager.updateOrg(org);</span>
<span class="fc" id="L216">            addActionMessage(getText(&quot;org.update.successful&quot;));</span>
<span class="fc" id="L217">        } catch (PKBException e) {</span>
<span class="fc" id="L218">            LOGGER.error(&quot;failed updating org {}&quot;, org, e);</span>
<span class="fc" id="L219">            addActionError(getText(&quot;err.org.update&quot;, new String[]{e.getMessage()}));</span>
<span class="fc" id="L220">        }</span>
<span class="fc" id="L221">        return SUCCESS;</span>
    }

    private Optional&lt;String&gt; setImageFileNameOrAction(File file, String fileName, String fieldName,
                                                      Consumer&lt;String&gt; fileNameSetter, Supplier&lt;String&gt; oldNameSupplier) throws IOException {
<span class="fc bfc" id="L226" title="All 2 branches covered.">        if (!validateImage(file, fileName, fieldName)) {</span>
<span class="fc" id="L227">            return Optional.of(Action.INPUT);</span>
<span class="fc bfc" id="L228" title="All 2 branches covered.">        } else if (StringUtils.isNotEmpty(fileName)) {</span>
<span class="fc" id="L229">            fileNameSetter.accept(fileName);</span>
        } else {
<span class="fc" id="L231">            fileNameSetter.accept(oldNameSupplier.get());</span>
        }
<span class="fc" id="L233">        return Optional.empty();</span>
    }

    public String cancel() {
<span class="fc" id="L237">        return &quot;cancel&quot;;</span>
    }

    public String assignOrgCoordForm() {
<span class="fc" id="L241">        return &quot;assignOrgCoordForm&quot;;</span>
    }

    public String assignPrivacyOfficerForm() {
<span class="fc" id="L245">        return ASSIGN_PRIVACY_OFFICER_FORM;</span>
    }

    @SkipValidation
    public String removeOrgEmailFooterImage() {
<span class="fc" id="L250">        return teamManager.transactional(() -&gt; {</span>
<span class="fc" id="L251">            Org oldOrg = teamManager.getOrg(org.getId(), Org.Lazy.EXTERNAL_IDS).orElse(null);</span>
<span class="fc" id="L252">            orgEmailFooterImageFileName = null;</span>
<span class="fc" id="L253">            deleteOrgEmailFooterImage = true;</span>
<span class="fc" id="L254">            String result = updateOrg();</span>

            try {
<span class="fc" id="L257">                deleteImage(oldOrg.getEmailFooterImageFilename());</span>
<span class="nc" id="L258">            } catch (IOException e) {</span>
<span class="nc" id="L259">                LOGGER.error(&quot;Error while removing org email footer image&quot;, e);</span>
<span class="nc" id="L260">                addActionError(getText(&quot;err.update.institute&quot;) + &quot;:&quot; + e.getMessage());</span>
<span class="nc" id="L261">                return input();</span>
<span class="fc" id="L262">            }</span>

<span class="pc bpc" id="L264" title="1 of 2 branches missed.">            if (!result.equals(SUCCESS)) {</span>
<span class="nc" id="L265">                return result;</span>
            }

<span class="fc" id="L268">            setActionMessages(Collections.singletonList(&quot;Org email footer image removed&quot;));</span>
<span class="fc" id="L269">            return SUCCESS;</span>
        });
    }

    /**
     * Update institute object details.
     *
     * @throws NamingException
     */
    private void updateTeam() {
<span class="fc" id="L279">        Team team = instituteUser.getInstitute();</span>

        // load from DB and restoring &quot;cannot change&quot; fields from there
        // symptoms and library entries are fetched; so refresh Team entries in those nested objects
<span class="fc" id="L283">        Team dbTeam = teamManager.getTeamByCode(team.getCode(), Team.Lazy.LIBRARY, Team.Lazy.SYMPTOMS);</span>
<span class="fc" id="L284">        team.setTeamAccountId(dbTeam.getTeamAccountId());</span>
<span class="fc" id="L285">        team.setHl7PasswordHash(dbTeam.getHl7PasswordHash());</span>
<span class="fc" id="L286">        team.setPublicId(dbTeam.getPublicId());</span>

<span class="fc" id="L288">        SortedSet&lt;InstituteLibraryEntry&gt; dbLibEntries = dbTeam.getLibraryEntries();</span>
<span class="pc bpc" id="L289" title="1 of 2 branches missed.">        if (dbLibEntries != null) {</span>
<span class="pc" id="L290">            dbLibEntries.forEach(entry -&gt; entry.setInstitute(team));</span>
<span class="fc" id="L291">            team.setLibraryEntries(dbLibEntries);</span>
        }

<span class="fc" id="L294">        team.setSendSymptomReminders(dbTeam.isSendSymptomReminders());</span>
<span class="fc" id="L295">        team.setSymptomAlarmDays(dbTeam.getSymptomAlarmDays());</span>
<span class="fc" id="L296">        team.setSymptomAlarmAmberThreshold(dbTeam.getSymptomAlarmAmberThreshold());</span>
<span class="fc" id="L297">        team.setSymptomAlarmRedThreshold(dbTeam.getSymptomAlarmRedThreshold());</span>
<span class="fc" id="L298">        team.setSymptomAlarmThreshold(dbTeam.getSymptomAlarmThreshold());</span>
<span class="fc" id="L299">        Set&lt;TeamSymptom&gt; dbTeamSymptoms = dbTeam.getSymptomsToMonitor();</span>
<span class="pc bpc" id="L300" title="1 of 2 branches missed.">        if (dbTeamSymptoms != null) {</span>
<span class="pc" id="L301">            dbTeamSymptoms.forEach(tsymp -&gt; tsymp.setTeam(team));</span>
<span class="fc" id="L302">            team.setSymptomsToMonitor(dbTeamSymptoms);</span>
        }

        // other data from form that needs a bit of translation:
<span class="fc" id="L306">        team.setOrg(teamManager.getOrg(team.getOrg().getId()).orElse(null));</span>
<span class="fc" id="L307">        team.setLogoFileName(logoFileName);</span>
<span class="fc" id="L308">        team.setHeaderFileName(headerImgFileName);</span>
<span class="fc" id="L309">        team.setFooterFileName(footerImgFileName);</span>
<span class="fc" id="L310">        team.setSpecialtyId(specialtyId);</span>
<span class="fc" id="L311">        team.setPatientIdSupport(PatientIdSupport.valueOf(patientIdSupport));</span>
<span class="fc" id="L312">        team.setHl7UploadValidatePidList(cleanHL7ValidatePidList(team.getHl7UploadValidatePidList()));</span>
<span class="fc" id="L313">        team.setTimeZoneId(timeZoneId);</span>
<span class="fc" id="L314">        team.setHl7AutoCreateRecords(hl7AutoCreateRecords);</span>
<span class="fc" id="L315">        team.setHl7CheckNhsNumberStatus(hl7CheckNhsNumberStatus);</span>

        // Consent required to see this team if you're not the account owner
<span class="fc" id="L318">        setConsentCategoriesOnEntity(team);</span>

        // Consent new patients will be asked for
<span class="fc" id="L321">        team.setDefaultRequestGeneral(this.isDefaultRequestGeneralConsent());</span>
<span class="fc" id="L322">        team.setDefaultRequestSexualHealth(this.isDefaultRequestSexualHealthConsent());</span>
<span class="fc" id="L323">        team.setDefaultRequestMentalHealth(this.isDefaultRequestMentalHealthConsent());</span>
<span class="fc" id="L324">        team.setDefaultRequestSocialCare(this.isDefaultRequestSocialCareConsent());</span>

<span class="fc" id="L326">        team.setDefaultNewProsContactable(this.isDefaultNewProsContactable());</span>
<span class="fc" id="L327">        team.setTeamBasedMessagingEnabled(this.isTeamBasedMessagingEnabled());</span>
<span class="fc bfc" id="L328" title="All 4 branches covered.">        if (StringUtils.isBlank(dbTeam.getHl7PasswordHash()) &amp;&amp; StringUtils.isNotBlank(hl7Password)) {</span>
<span class="fc" id="L329">            team.setHl7PasswordHash(makePasswordHash(hl7Password));</span>
        }
<span class="fc" id="L331">        team.setPublicId(dbTeam.getPublicId());</span>

<span class="fc" id="L333">        teamManager.transactional(() -&gt; {</span>
<span class="fc" id="L334">            teamManager.deleteSymptomsToMonitor(team);</span>
<span class="fc" id="L335">            teamManager.updateTeam(team);</span>
<span class="fc" id="L336">        });</span>

<span class="fc" id="L338">        updateTeamUser(team, UserType.INSTITUTE_ADMIN);</span>
<span class="fc" id="L339">        updateTeamUser(team, UserType.REG_CLINICIAN);</span>
<span class="fc" id="L340">    }</span>

    private String makePasswordHash(String password) {
<span class="fc" id="L343">        return BCrypt.hashpw(password, BCrypt.gensalt());</span>
    }

    private void updateTeamUser(Team team, UserType userType) {
<span class="fc bfc" id="L347" title="All 2 branches covered.">        for (InstituteUser user : teamUserManager.getInstituteUsersByType(team.getId(), userType, 0,</span>
                0)) {
<span class="fc" id="L349">            PKBPerson person = user.getPerson();</span>
<span class="fc" id="L350">            person.setOrganizationName(team.getOrg().getName());</span>
<span class="fc" id="L351">            person.setOrganizationUnit(team.getName());</span>
<span class="fc" id="L352">            userManager.updateUser(getEHRRequestContext(), person);</span>
<span class="fc" id="L353">        }</span>
<span class="fc" id="L354">    }</span>

    /**
     * Validate new images.
     */
    private boolean validateImages() throws IOException {
<span class="fc" id="L360">        Team team = teamManager.getTeamByCode(instituteUser</span>
<span class="fc" id="L361">                .getInstitute().getCode());</span>
<span class="fc" id="L362">        boolean valid = true;</span>
<span class="pc bpc" id="L363" title="1 of 2 branches missed.">        if (logo != null) {</span>
<span class="nc bnc" id="L364" title="All 2 branches missed.">            if (!validateImage(logo, logoFileName, &quot;logo&quot;)) {</span>
<span class="nc" id="L365">                valid = false;</span>
            }
        } else {
<span class="fc" id="L368">            logoFileName = team.getLogoFileName();</span>
        }
<span class="pc bpc" id="L370" title="1 of 2 branches missed.">        if (headerImg != null) {</span>
<span class="nc bnc" id="L371" title="All 2 branches missed.">            if (!validateImage(headerImg, headerImgFileName, &quot;header&quot;)) {</span>
<span class="nc" id="L372">                valid = false;</span>
            }
        } else {
<span class="fc" id="L375">            headerImgFileName = team.getHeaderFileName();</span>
        }
<span class="pc bpc" id="L377" title="1 of 2 branches missed.">        if (footerImg != null) {</span>
<span class="nc bnc" id="L378" title="All 2 branches missed.">            if (!validateImage(footerImg, footerImgFileName, &quot;footer&quot;)) {</span>
<span class="nc" id="L379">                valid = false;</span>
            }
        } else {
<span class="fc" id="L382">            footerImgFileName = team.getFooterFileName();</span>
        }
<span class="fc" id="L384">        return valid;</span>
    }

    @Override
    public String input() {
        try {
<span class="pc bpc" id="L390" title="1 of 4 branches missed.">            if ((code != null) &amp;&amp; !code.isEmpty()) {</span>
<span class="fc" id="L391">                instituteUser = new InstituteUser();</span>
<span class="fc" id="L392">                Team team = teamManager.getTeamByCode(code);</span>
<span class="fc" id="L393">                specialtyId = team.getSpecialtyId();</span>
<span class="pc bpc" id="L394" title="1 of 2 branches missed.">                if (team.getPatientIdSupport() != null) {</span>
<span class="fc" id="L395">                    patientIdSupport = team.getPatientIdSupport().toString();</span>
                }
<span class="fc" id="L397">                instituteUser.setInstitute(team);</span>
<span class="fc" id="L398">                timeZoneId = team.getTimeZoneId();</span>
<span class="fc" id="L399">                hl7AutoCreateRecords = team.getHl7AutoCreateRecords();</span>
<span class="fc" id="L400">                hl7CheckNhsNumberStatus = team.getHl7CheckNhsNumberStatus();</span>
<span class="fc" id="L401">                displayConsentCategories(team);</span>

<span class="fc" id="L403">                defaultRequestGeneralConsent = team.isDefaultRequestGeneral();</span>
<span class="fc" id="L404">                defaultRequestSexualHealthConsent = team.isDefaultRequestSexualHealth();</span>
<span class="fc" id="L405">                defaultRequestMentalHealthConsent = team.isDefaultRequestMentalHealth();</span>
<span class="fc" id="L406">                defaultRequestSocialCareConsent = team.isDefaultRequestSocialCare();</span>
<span class="fc" id="L407">                mandatoryNationalId = team.isMandatoryNationalId();</span>
<span class="fc" id="L408">                defaultNewProsContactable = team.isDefaultNewProsContactable();</span>
<span class="fc" id="L409">                teamBasedMessagingEnabled = team.isTeamBasedMessagingEnabled();</span>
<span class="fc" id="L410">                hl7User = &quot;team_&quot; + team.getCode();</span>
<span class="fc" id="L411">                passwordAlreadySet = StringUtils.isNotBlank(team.getHl7PasswordHash());</span>
            }
<span class="nc" id="L413">        } catch (PKBException e) {</span>
<span class="nc" id="L414">            LOGGER.error(&quot;Error while loading the institute details&quot;, e);</span>
<span class="fc" id="L415">        }</span>
<span class="fc" id="L416">        return Action.SUCCESS;</span>
    }

    public InstituteUser getInstituteUser() {
<span class="fc" id="L420">        return instituteUser;</span>
    }

    public void setInstituteUser(InstituteUser instituteUser) {
<span class="fc" id="L424">        this.instituteUser = instituteUser;</span>
<span class="fc" id="L425">    }</span>

    public void setTeamUserManager(
            TeamUserManager teamUserManager) {
<span class="fc" id="L429">        this.teamUserManager = teamUserManager;</span>
<span class="fc" id="L430">    }</span>

    public void setUserManager(UserManager userManager) {
<span class="fc" id="L433">        this.userManager = userManager;</span>
<span class="fc" id="L434">    }</span>

    public File getLogo() {
<span class="fc" id="L437">        return logo;</span>
    }

    public void setLogo(File logo) {
<span class="nc" id="L441">        this.logo = logo;</span>
<span class="nc" id="L442">    }</span>

    public String getLogoContentType() {
<span class="nc" id="L445">        return logoContentType;</span>
    }

    public void setLogoContentType(String logoContentType) {
<span class="nc" id="L449">        this.logoContentType = logoContentType;</span>
<span class="nc" id="L450">    }</span>

    public String getLogoFileName() {
<span class="nc" id="L453">        return logoFileName;</span>
    }

    public void setLogoFileName(String logoFileName) {
<span class="nc" id="L457">        this.logoFileName = logoFileName;</span>
<span class="nc" id="L458">    }</span>

    public String getHeaderImgFileName() {
<span class="nc" id="L461">        return headerImgFileName;</span>
    }

    public void setHeaderImgFileName(String headerImgFileName) {
<span class="nc" id="L465">        this.headerImgFileName = headerImgFileName;</span>
<span class="nc" id="L466">    }</span>

    public String getFooterImgFileName() {
<span class="nc" id="L469">        return footerImgFileName;</span>
    }

    public void setFooterImgFileName(String footerImgFileName) {
<span class="nc" id="L473">        this.footerImgFileName = footerImgFileName;</span>
<span class="nc" id="L474">    }</span>

    public File getHeaderImg() {
<span class="fc" id="L477">        return headerImg;</span>
    }

    public void setHeaderImg(File headerImg) {
<span class="nc" id="L481">        this.headerImg = headerImg;</span>
<span class="nc" id="L482">    }</span>

    public String getHeaderImgContentType() {
<span class="nc" id="L485">        return headerImgContentType;</span>
    }

    public void setHeaderImgContentType(String headerImgContentType) {
<span class="nc" id="L489">        this.headerImgContentType = headerImgContentType;</span>
<span class="nc" id="L490">    }</span>

    public File getFooterImg() {
<span class="fc" id="L493">        return footerImg;</span>
    }

    public void setFooterImg(File footerImg) {
<span class="nc" id="L497">        this.footerImg = footerImg;</span>
<span class="nc" id="L498">    }</span>

    public String getFooterImgContentType() {
<span class="nc" id="L501">        return footerImgContentType;</span>
    }

    public void setFooterImgContentType(String footerImgContentType) {
<span class="nc" id="L505">        this.footerImgContentType = footerImgContentType;</span>
<span class="nc" id="L506">    }</span>

    public long getSpecialtyId() {
<span class="fc" id="L509">        return specialtyId;</span>
    }

    public void setSpecialtyId(long specialtyId) {
<span class="fc" id="L513">        this.specialtyId = specialtyId;</span>
<span class="fc" id="L514">    }</span>

    public long getInstituteUserId() {
<span class="nc" id="L517">        return instituteUserId;</span>
    }

    public void setInstituteUserId(long instituteUserId) {
<span class="nc" id="L521">        this.instituteUserId = instituteUserId;</span>
<span class="nc" id="L522">    }</span>

    public String getCode() {
<span class="nc" id="L525">        return code;</span>
    }

    public void setCode(String code) {
<span class="fc" id="L529">        this.code = code;</span>
<span class="fc" id="L530">    }</span>

    public Org getOrg() {
<span class="fc" id="L533">        return org;</span>
    }

    public void setOrg(Org org) {
<span class="fc" id="L537">        this.org = org;</span>
<span class="fc" id="L538">    }</span>

    public String getTab() {
<span class="fc" id="L541">        return tab;</span>
    }

    public void setTab(String tab) {
<span class="nc" id="L545">        this.tab = tab;</span>
<span class="nc" id="L546">    }</span>

    public String getSubTab() {
<span class="fc" id="L549">        return subTab;</span>
    }

    public void setSubTab(String subTab) {
<span class="nc" id="L553">        this.subTab = subTab;</span>
<span class="nc" id="L554">    }</span>

    public String getPatientIdSupport() {
<span class="fc" id="L557">        return patientIdSupport;</span>
    }

    public void setPatientIdSupport(String patientIdSupport) {
<span class="fc" id="L561">        this.patientIdSupport = patientIdSupport;</span>
<span class="fc" id="L562">    }</span>

    public String getTimeZoneId() {
<span class="fc" id="L565">        return timeZoneId;</span>
    }

    public void setTimeZoneId(String timeZoneId) {
<span class="fc" id="L569">        this.timeZoneId = timeZoneId;</span>
<span class="fc" id="L570">    }</span>

    public boolean getHl7AutoCreateRecords() {
<span class="fc" id="L573">        return hl7AutoCreateRecords;</span>
    }

    public void setHl7AutoCreateRecords(boolean hl7AutoCreateRecords) {
<span class="fc" id="L577">        this.hl7AutoCreateRecords = hl7AutoCreateRecords;</span>
<span class="fc" id="L578">    }</span>

    public boolean getHl7CheckNhsNumberStatus() {
<span class="fc" id="L581">        return hl7CheckNhsNumberStatus;</span>
    }

    public void setHl7CheckNhsNumberStatus(boolean hl7CheckNhsNumberStatus) {
<span class="fc" id="L585">        this.hl7CheckNhsNumberStatus = hl7CheckNhsNumberStatus;</span>
<span class="fc" id="L586">    }</span>

    public String getHl7IdList() {
<span class="nc" id="L589">        return hl7IdList;</span>
    }

    public void setHl7IdList(String hl7IdList) {
<span class="nc" id="L593">        this.hl7IdList = hl7IdList;</span>
<span class="nc" id="L594">    }</span>

    public boolean isMandatoryNationalId() {
<span class="nc" id="L597">        return mandatoryNationalId;</span>
    }

    public void setMandatoryNationalId(boolean mandatoryNationalId) {
<span class="nc" id="L601">        this.mandatoryNationalId = mandatoryNationalId;</span>
<span class="nc" id="L602">    }</span>

    public boolean isCancerTeam() {
<span class="nc" id="L605">        return isCancerTeam;</span>
    }

    public void setCancerTeam(boolean isCancerTeam) {
<span class="nc" id="L609">        this.isCancerTeam = isCancerTeam;</span>
<span class="nc" id="L610">    }</span>

    public boolean isDefaultRequestGeneralConsent() {
<span class="fc" id="L613">        return defaultRequestGeneralConsent;</span>
    }

    public void setDefaultRequestGeneralConsent(boolean defaultRequestGeneralConsent) {
<span class="fc" id="L617">        this.defaultRequestGeneralConsent = defaultRequestGeneralConsent;</span>
<span class="fc" id="L618">    }</span>

    public boolean isDefaultRequestSexualHealthConsent() {
<span class="fc" id="L621">        return defaultRequestSexualHealthConsent;</span>
    }

    public void setDefaultRequestSexualHealthConsent(boolean defaultRequestSexualHealthConsent) {
<span class="fc" id="L625">        this.defaultRequestSexualHealthConsent = defaultRequestSexualHealthConsent;</span>
<span class="fc" id="L626">    }</span>

    public boolean isDefaultRequestMentalHealthConsent() {
<span class="fc" id="L629">        return defaultRequestMentalHealthConsent;</span>
    }

    public void setDefaultRequestMentalHealthConsent(boolean defaultRequestMentalHealthConsent) {
<span class="fc" id="L633">        this.defaultRequestMentalHealthConsent = defaultRequestMentalHealthConsent;</span>
<span class="fc" id="L634">    }</span>

    public boolean isDefaultRequestSocialCareConsent() {
<span class="fc" id="L637">        return defaultRequestSocialCareConsent;</span>
    }

    public void setDefaultRequestSocialCareConsent(boolean defaultRequestSocialCareConsent) {
<span class="fc" id="L641">        this.defaultRequestSocialCareConsent = defaultRequestSocialCareConsent;</span>
<span class="fc" id="L642">    }</span>

    public File getOrgEmailFooterImage() {
<span class="nc" id="L645">        return orgEmailFooterImage;</span>
    }

    public void setOrgEmailFooterImage(File orgEmailFooterImage) {
<span class="fc" id="L649">        this.orgEmailFooterImage = orgEmailFooterImage;</span>
<span class="fc" id="L650">    }</span>

    public String getOrgEmailFooterImageFileName() {
<span class="nc" id="L653">        return orgEmailFooterImageFileName;</span>
    }

    public void setOrgEmailFooterImageFileName(String orgEmailFooterImageFileName) {
<span class="fc" id="L657">        this.orgEmailFooterImageFileName = orgEmailFooterImageFileName;</span>
<span class="fc" id="L658">    }</span>

    public boolean isDefaultNewProsContactable() {
<span class="fc" id="L661">        return defaultNewProsContactable;</span>
    }

    public void setDefaultNewProsContactable(boolean defaultNewProsContactable) {
<span class="fc" id="L665">        this.defaultNewProsContactable = defaultNewProsContactable;</span>
<span class="fc" id="L666">    }</span>

    public boolean isTeamBasedMessagingEnabled() {
<span class="fc" id="L669">        return teamBasedMessagingEnabled;</span>
    }

    public void setTeamBasedMessagingEnabled(boolean teamBasedMessagingEnabled) {
<span class="fc" id="L673">        this.teamBasedMessagingEnabled = teamBasedMessagingEnabled;</span>
<span class="fc" id="L674">    }</span>

    public String getHl7User() {
<span class="fc" id="L677">        return hl7User;</span>
    }

    public void setHl7User(String hl7User) {
<span class="fc" id="L681">        this.hl7User = hl7User;</span>
<span class="fc" id="L682">    }</span>

    public String getHl7Password() {
<span class="fc" id="L685">        return hl7Password;</span>
    }

    public void setHl7Password(String hl7Password) {
<span class="fc" id="L689">        this.hl7Password = hl7Password;</span>
<span class="fc" id="L690">    }</span>

    public boolean isPasswordAlreadySet() {
<span class="fc" id="L693">        return passwordAlreadySet;</span>
    }

    public void setPasswordAlreadySet(boolean passwordAlreadySet) {
<span class="nc" id="L697">        this.passwordAlreadySet = passwordAlreadySet;</span>
<span class="nc" id="L698">    }</span>

    public boolean isAppointmentMessagingEnabled() {
<span class="fc" id="L701">        return appointmentMessagingEnabled;</span>
    }

    public void setAppointmentMessagingEnabled(boolean appointmentMessagingEnabled) {
<span class="fc" id="L705">        this.appointmentMessagingEnabled = appointmentMessagingEnabled;</span>
<span class="fc" id="L706">    }</span>

    public long getAppointmentMessagingTeamId() {
<span class="nc" id="L709">        return appointmentMessagingTeamId;</span>
    }

    public void setAppointmentMessagingTeamId(Long appointmentMessagingTeamId) {
<span class="fc" id="L713">        this.appointmentMessagingTeamId = appointmentMessagingTeamId;</span>
<span class="fc" id="L714">    }</span>

    public void setAppointmentMessagingService(AppointmentMessagingSettingsService appointmentMessagingSettingsService) {
<span class="fc" id="L717">        this.appointmentMessagingSettingsService = appointmentMessagingSettingsService;</span>
<span class="fc" id="L718">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>