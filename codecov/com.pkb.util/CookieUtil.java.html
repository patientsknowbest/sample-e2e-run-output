<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CookieUtil.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">E2E Tests Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.pkb.util</a> &gt; <span class="el_source">CookieUtil.java</span></div><h1>CookieUtil.java</h1><pre class="source lang-java linenums">package com.pkb.util;

import org.apache.commons.lang3.StringUtils;
import org.jetbrains.annotations.Nullable;

import javax.servlet.http.Cookie;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.util.ArrayList;
import java.util.List;

/**
 * Set, update, delete cookies.
 * NOTE: this is a bit more complicated in Struts; you need to do this BEFORE the response has been committed.
 *
 * Extra stuff for adding cookies -- always use secureOnly (if we're https) and set domain (take from config)
 *
 * @author rob
 */
<span class="nc" id="L20">public class CookieUtil {</span>

    //private static Logger log = LoggerFactory.getLogger(java.lang.invoke.MethodHandles.lookup().lookupClass());
    public static final int DURATION_SESSION = -1;
    public static final int DURATION_30_DAYS = 30 * 24 * 60 * 60;

    @Nullable
    public static Cookie readCookie(HttpServletRequest request, String name) {
<span class="fc" id="L28">        assertRequestAndNameValid(request, name);</span>
        // get existing cookie, if available:
<span class="fc" id="L30">        Cookie[] cookies = request.getCookies();</span>
<span class="fc bfc" id="L31" title="All 2 branches covered.">        if (cookies != null) {</span>
<span class="fc bfc" id="L32" title="All 2 branches covered.">            for (Cookie checkCookie : cookies) {</span>
<span class="fc bfc" id="L33" title="All 2 branches covered.">                if (name.equals(checkCookie.getName())) {</span>
<span class="fc" id="L34">                    return checkCookie;</span>
                }
            }
        }
<span class="fc" id="L38">        return null; // not found</span>
    }

    private static void assertRequestAndNameValid(HttpServletRequest request, String name) {
<span class="pc bpc" id="L42" title="2 of 4 branches missed.">        if (request == null || name == null) {</span>
<span class="nc" id="L43">            throw new IllegalArgumentException(&quot;Request and name must be non-null&quot;);</span>
        }
<span class="pc bpc" id="L45" title="1 of 2 branches missed.">        if (StringUtils.isBlank(name)) {</span>
<span class="nc" id="L46">            throw new IllegalArgumentException(&quot;Name cannot be empty&quot;);</span>
        }
<span class="fc" id="L48">    }</span>

    public static List&lt;Cookie&gt; readCookies(HttpServletRequest request, String name) {
<span class="fc" id="L51">        assertRequestAndNameValid(request, name);</span>
<span class="fc" id="L52">        List&lt;Cookie&gt; found = new ArrayList&lt;&gt;();</span>
        // get existing cookie, if available:
<span class="fc" id="L54">        Cookie[] cookies = request.getCookies();</span>
<span class="fc bfc" id="L55" title="All 2 branches covered.">        if (cookies != null) {</span>
<span class="fc bfc" id="L56" title="All 2 branches covered.">            for (Cookie checkCookie : cookies) {</span>
<span class="pc bpc" id="L57" title="1 of 2 branches missed.">                if (name.equals(checkCookie.getName())) {</span>
<span class="nc" id="L58">                    found.add(checkCookie);</span>
                }
            }
        }
<span class="fc" id="L62">        return found;</span>
    }

    /**
     * removes all cookies with matching name; return value of last match
     */
    @Nullable
    public static String removeCookie(HttpServletRequest request, HttpServletResponse response, String name) {
<span class="fc" id="L70">        List&lt;Cookie&gt; foundList = readCookies(request, name);</span>
<span class="fc" id="L71">        String oldValue = null;</span>
<span class="pc bpc" id="L72" title="1 of 2 branches missed.">        for (Cookie found : foundList) {</span>
<span class="nc" id="L73">            found.setMaxAge(0);</span>
<span class="nc" id="L74">            found.setValue(null);</span>
<span class="nc" id="L75">            response.addCookie(found);</span>
<span class="nc" id="L76">            oldValue = found.getValue(); // successfully removed!</span>
<span class="nc" id="L77">        }</span>
<span class="fc" id="L78">        return oldValue;</span>
    }

    public static String setCookie(HttpServletRequest request, HttpServletResponse response,
            String name, String value, int duration) {
<span class="fc" id="L83">        return setCookie(request, response,</span>
                name, value, duration, false);
    }

    /**
     * Currently, we assume the path is /
     *
     * @param request
     * @param response
     * @param name
     * @param value
     * @param duration
     *            See the constants in this class (and add more if we need more options)
     * @return the old value for cookie (if any)
     */
    @Nullable
    public static String setCookie(HttpServletRequest request, HttpServletResponse response,
                                   String name, String value, int duration, boolean httpOnly) {

<span class="pc bpc" id="L102" title="1 of 2 branches missed.">        if (response == null) {</span>
<span class="nc" id="L103">            throw new IllegalArgumentException(&quot;Response cannot be null&quot;);</span>
        }
        // start with existing cookie, if available
<span class="fc" id="L106">        Cookie cookie = readCookie(request, name);</span>
<span class="fc" id="L107">        String oldValue = null;</span>
<span class="fc bfc" id="L108" title="All 2 branches covered.">        if (cookie == null) {</span>
<span class="fc" id="L109">            cookie = new Cookie(name, value);</span>
        } else {
<span class="fc" id="L111">            oldValue = cookie.getValue();</span>
        }

<span class="fc" id="L114">        cookie.setValue(value);</span>
<span class="fc" id="L115">        cookie.setPath(&quot;/&quot;);</span>
<span class="fc" id="L116">        cookie.setMaxAge(duration);</span>

<span class="fc bfc" id="L118" title="All 2 branches covered.">        if (httpOnly) {</span>
<span class="fc" id="L119">            cookie.setHttpOnly(true);</span>
        }

<span class="fc" id="L122">        response.addCookie(cookie);</span>
<span class="fc" id="L123">        return oldValue;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>