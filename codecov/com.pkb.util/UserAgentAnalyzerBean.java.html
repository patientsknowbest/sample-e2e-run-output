<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UserAgentAnalyzerBean.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">E2E Tests Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.pkb.util</a> &gt; <span class="el_source">UserAgentAnalyzerBean.java</span></div><h1>UserAgentAnalyzerBean.java</h1><pre class="source lang-java linenums">package com.pkb.util;

import nl.basjes.parse.useragent.UserAgent;
import nl.basjes.parse.useragent.UserAgentAnalyzer;
import org.apache.struts2.ServletActionContext;

import javax.servlet.http.HttpServletRequest;
import java.util.function.Supplier;

import static nl.basjes.parse.useragent.UserAgent.AGENT_NAME;
import static nl.basjes.parse.useragent.UserAgent.AGENT_VERSION_MAJOR;
import static nl.basjes.parse.useragent.UserAgent.OPERATING_SYSTEM_NAME;
import static nl.basjes.parse.useragent.UserAgent.OPERATING_SYSTEM_VERSION_MAJOR;

public class UserAgentAnalyzerBean {
    private static final String ANDROID = &quot;Android&quot;;
    private static final String IOS = &quot;iOS&quot;;
    private static final String IE = &quot;Internet Explorer&quot;;
    private static final String CHROME = &quot;Chrome&quot;;
    private static final String SAFARI = &quot;Safari&quot;;
    private static final int MINIMUM_SUPPORTED_IOS = 10;

    private final UserAgentAnalyzer userAgentAnalyzer;
    private final Supplier&lt;HttpServletRequest&gt; requestSupplier;

    public UserAgentAnalyzerBean(UserAgentAnalyzer userAgentAnalyzer) {
<span class="fc" id="L27">        this(userAgentAnalyzer, ServletActionContext::getRequest);</span>
<span class="fc" id="L28">    }</span>

<span class="fc" id="L30">    public UserAgentAnalyzerBean(UserAgentAnalyzer userAgentAnalyzer, Supplier&lt;HttpServletRequest&gt; requestSupplier) {</span>
<span class="fc" id="L31">        this.userAgentAnalyzer = userAgentAnalyzer;</span>
<span class="fc" id="L32">        this.requestSupplier = requestSupplier;</span>
<span class="fc" id="L33">    }</span>

    private UserAgent getUserAgent() {
<span class="fc" id="L36">        String userAgent = requestSupplier.get().getHeader(&quot;user-agent&quot;);</span>
<span class="fc" id="L37">        return userAgentAnalyzer.parse(userAgent);</span>
    }

    public UserAgent getUserAgent(HttpServletRequest request) {
<span class="fc" id="L41">        String userAgent = request.getHeader(&quot;user-agent&quot;);</span>
<span class="fc" id="L42">        return userAgentAnalyzer.parse(userAgent);</span>
    }

    public boolean isAnIOSDevice() {
<span class="fc" id="L46">        UserAgent userAgent = getUserAgent();</span>
<span class="fc" id="L47">        return IOS.equals(userAgent.get(OPERATING_SYSTEM_NAME).getValue());</span>
    }

    public boolean isAnAndroidDevice() {
<span class="fc" id="L51">        UserAgent userAgent = getUserAgent();</span>
<span class="fc" id="L52">        return ANDROID.equals(userAgent.get(OPERATING_SYSTEM_NAME).getValue());</span>
    }

    boolean isIE8OrOlder() {
<span class="fc" id="L56">        UserAgent userAgent = getUserAgent();</span>
<span class="fc" id="L57">        return isIEAndVersionEqualOrOlderThan(userAgent, 8);</span>
    }

    boolean isIE10OrOlder() {
<span class="fc" id="L61">        UserAgent userAgent = getUserAgent();</span>
<span class="fc" id="L62">        return isIEAndVersionEqualOrOlderThan(userAgent, 10);</span>
    }

    private boolean isIEAndVersionEqualOrOlderThan(UserAgent userAgent, int version) {
<span class="fc" id="L66">        int agentVersion = Integer.parseInt(userAgent.get(AGENT_VERSION_MAJOR).getValue());</span>
<span class="pc bpc" id="L67" title="1 of 4 branches missed.">        return IE.equals(userAgent.get(AGENT_NAME).getValue()) &amp;&amp; agentVersion &lt;= version;</span>
    }

    boolean isModernBrowser() {
<span class="pc bpc" id="L71" title="1 of 2 branches missed.">        return !isIE8OrOlder();</span>
    }

    public boolean isChromeAndVersionEqualOrNewerThan(UserAgent userAgent, int version){
<span class="fc" id="L75">        int agentVersion = Integer.parseInt(userAgent.get(AGENT_VERSION_MAJOR).getValue());</span>
<span class="pc bpc" id="L76" title="2 of 4 branches missed.">        return CHROME.equals(userAgent.get(AGENT_NAME).getValue()) &amp;&amp; agentVersion &gt;= version;</span>
    }

    public boolean isSafari(UserAgent userAgent){
<span class="fc" id="L80">        return SAFARI.equals(userAgent.get(AGENT_NAME).getValue());</span>
    }


    public boolean isBelowIos13() {
<span class="fc" id="L85">        return isIosVersionBelow(13);</span>
    }

    public boolean isBelowMinimumSupportedIOS() {
<span class="fc" id="L89">        return isIosVersionBelow(MINIMUM_SUPPORTED_IOS);</span>
    }

    private boolean isIosVersionBelow(int version) {
<span class="pc bpc" id="L93" title="1 of 4 branches missed.">        return isAnIOSDevice() &amp;&amp; Integer.parseInt(getUserAgent().get(OPERATING_SYSTEM_VERSION_MAJOR).getValue()) &lt; version;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>