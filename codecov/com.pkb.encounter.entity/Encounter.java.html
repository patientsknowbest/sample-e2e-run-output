<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Encounter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">E2E Tests Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.pkb.encounter.entity</a> &gt; <span class="el_source">Encounter.java</span></div><h1>Encounter.java</h1><pre class="source lang-java linenums">//------------------------------------------------------------------------------
//
// Copyright (c) 2009-2013 PatientsKnowBest, Inc. All Rights Reserved.
//
// $Id: Message.java May 25, 2009 12:02:20 PM pravinam$
//
//------------------------------------------------------------------------------
package com.pkb.encounter.entity;

import com.pkb.app.dto.DTOBaseFields;
import com.pkb.app.dto.ParticipantDTO;
import com.pkb.app.entity.SourceDetails;
import com.pkb.app.interfaces.IBaseDTO;
import com.pkb.code.entity.Code;
import com.pkb.entities.enums.EncounterClass;
import com.pkb.entities.enums.MenuDataType;
import com.pkb.user.entity.PKBPerson;
import org.jetbrains.annotations.Nullable;

import java.io.Serializable;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;
import java.util.UUID;

/**
 * This class represents a conversation between a patient and a clinician All
 * the messages under one subject are stringed together with a help of
 * conversation id
 * &lt;p&gt;
 * Refer to http://www.hl7.org/implement/standards/fhir/encounter.html
 *
 * &lt;p&gt;
 * Fields to set for a new Encounter instance before saving it for the first time:
 * &lt;/p&gt;
 *
 * @author pravinam
 */
public class Encounter implements Serializable, IBaseDTO {

    private static final long serialVersionUID = 1L;

    // https://www.hl7.org/fhir/valueset-encounter-state.html
<span class="fc" id="L44">    public enum EncounterStatus {</span>
<span class="fc" id="L45">        PLANNED, ARRIVED, IN_PROGRESS, ON_LEAVE, FINISHED, CANCELLED,</span>
    }

    private Long id;

    private Message encounterDetailsMessage;

    private Message latestMessage;

    private Message firstMessage;

    private UUID nextConversationId; // required for chaining conversations/encounters

    private UUID previousConversationId; // required for chaining conversations/encounters

    private Long messageCount;

    private EncounterClass encounterClass;

    private List&lt;String&gt; participantIds;

    private SourceDetails source;

<span class="pc" id="L68">    private DTOBaseFields baseFields = new DTOBaseFields();</span>

    private List&lt;PKBPerson&gt; participantsPKB;

    private List&lt;ParticipantDTO&gt; participantsNonPKB;

    private Hospitalization hospitalization;

    private EncounterStatus encounterStatus;

    private UUID encounterUniqueId;

    private String aboutPatientId;

    private Boolean privateConversation;

    private List&lt;GeographicLocation&gt; locations;

    private Date startDate;

    private Date endDate;

    private String externalMessageId;

    private String externalEncounterId;

    private String indication;

    private String reasonCode;// not saved in DB ; for use by internal layers

<span class="pc" id="L98">    private List&lt;Message&gt; messages = new ArrayList&lt;&gt;();</span>

    private String apiRef;// not saved in DB

    private Code codeDetails; //not saved in DB

    private MenuDataType menuDataType; //not saved in DB

    /**
     * DELIBERATELY PROTECTED DO NOT CHANGE! Use the available constructors!
     * &lt;p&gt;
     * Would have even less visibility but JPA spec &amp; Hibernate requires a no arg const. which is public or protected.
     * Other than those, nothing should be able to construct without parameters, as changelog wouldn't be filled correctly etc.
     */
<span class="nc" id="L112">    protected Encounter() {</span>
<span class="nc" id="L113">        this.source = new SourceDetails();</span>
<span class="nc" id="L114">    }</span>

<span class="fc" id="L116">    public Encounter(SourceDetails sourceDetails) {</span>
<span class="fc" id="L117">        this.source = sourceDetails;</span>
<span class="fc" id="L118">    }</span>

    @Override
    public Long getId() {
<span class="fc" id="L122">        return id;</span>
    }

    @Override
    public void setId(Long id) {
<span class="fc" id="L127">        this.id = id;</span>
<span class="fc" id="L128">    }</span>

    public UUID getNextConversationId() {
<span class="fc" id="L131">        return nextConversationId;</span>
    }

    public void setNextConversationId(UUID nextConversationId) {
<span class="fc" id="L135">        this.nextConversationId = nextConversationId;</span>
<span class="fc" id="L136">    }</span>

    public UUID getPreviousConversationId() {
<span class="fc" id="L139">        return previousConversationId;</span>
    }

    public void setPreviousConversationId(UUID previousConversationId) {
<span class="fc" id="L143">        this.previousConversationId = previousConversationId;</span>
<span class="fc" id="L144">    }</span>

    public Message getLatestMessage() {
<span class="fc" id="L147">        return latestMessage;</span>
    }

    public void setLatestMessage(Message latestMessage) {
<span class="fc" id="L151">        this.latestMessage = latestMessage;</span>
<span class="fc" id="L152">    }</span>

    public Long getMessageCount() {
<span class="fc" id="L155">        return messageCount;</span>
    }

    public void setMessageCount(Long messageCount) {
<span class="fc" id="L159">        this.messageCount = messageCount;</span>
<span class="fc" id="L160">    }</span>

    public UUID getEncounterUniqueId() {
<span class="fc" id="L163">        return encounterUniqueId;</span>
    }

    public void setEncounterUniqueId(UUID encounterUniqueId) {
<span class="fc" id="L167">        this.encounterUniqueId = encounterUniqueId;</span>
<span class="fc" id="L168">    }</span>

    @Override
    public String toString() {
<span class="nc" id="L172">        StringBuilder builder = new StringBuilder();</span>
<span class="nc" id="L173">        builder.append(&quot;Id &quot;)</span>
<span class="nc" id="L174">                .append(id)</span>
<span class="nc" id="L175">                .append(&quot; Conversation Id &quot;)</span>
<span class="nc" id="L176">                .append(encounterUniqueId)</span>
<span class="nc" id="L177">                .append(&quot; PKB Participants:&quot;);</span>
<span class="nc bnc" id="L178" title="All 2 branches missed.">        if (participantIds != null) {</span>
<span class="nc bnc" id="L179" title="All 2 branches missed.">            for (String personId : participantIds) {</span>
<span class="nc" id="L180">                builder.append(&quot; &quot;).append(personId);</span>
<span class="nc" id="L181">            }</span>
        }

<span class="nc bnc" id="L184" title="All 2 branches missed.">        if (participantsNonPKB != null) {</span>
<span class="nc" id="L185">            builder.append(&quot; Non PKB Participants:&quot;);</span>
<span class="nc bnc" id="L186" title="All 2 branches missed.">            for (ParticipantDTO dto : participantsNonPKB) {</span>
<span class="nc" id="L187">                builder.append(&quot; &quot;).append(dto.getNonpkbParticipant());</span>
<span class="nc" id="L188">            }</span>
        }
<span class="nc" id="L190">        builder.append(&quot; MessageCount &quot;)</span>
<span class="nc" id="L191">                .append(messageCount)</span>
<span class="nc" id="L192">                .append(&quot; next &quot;)</span>
<span class="nc" id="L193">                .append(nextConversationId)</span>
<span class="nc" id="L194">                .append(&quot; prev &quot;)</span>
<span class="nc" id="L195">                .append(previousConversationId)</span>
<span class="nc" id="L196">                .append(&quot; latest message [&quot;)</span>
<span class="nc" id="L197">                .append(latestMessage)</span>
<span class="nc" id="L198">                .append(&quot;]&quot;);</span>
<span class="nc" id="L199">        builder.append(&quot;\n&quot;);</span>
<span class="nc" id="L200">        return builder.toString();</span>
    }

    @Nullable
    public String getAboutPatientId() {
<span class="fc" id="L205">        return aboutPatientId;</span>
    }

    public void setAboutPatientId(String aboutPatientId) {
<span class="fc" id="L209">        this.aboutPatientId = aboutPatientId;</span>
<span class="fc" id="L210">    }</span>

    public boolean isPrivate() {
<span class="pc bpc" id="L213" title="3 of 4 branches missed.">        return (privateConversation != null) &amp;&amp; privateConversation;</span>
    }

    public void setPrivate(boolean privateConversation) {
<span class="nc" id="L217">        this.privateConversation = privateConversation;</span>
<span class="nc" id="L218">    }</span>

    public List&lt;String&gt; getParticipants() {
<span class="fc" id="L221">        return participantIds;</span>
    }

    public void setParticipants(List&lt;String&gt; participants) {
<span class="fc" id="L225">        this.participantIds = participants;</span>
<span class="fc" id="L226">    }</span>

    public List&lt;ParticipantDTO&gt; getParticipantsNonPKB() {
<span class="fc bfc" id="L229" title="All 2 branches covered.">        if (participantsNonPKB == null) {</span>
<span class="fc" id="L230">            participantsNonPKB = new ArrayList&lt;&gt;();</span>
        }
<span class="fc" id="L232">        return participantsNonPKB;</span>
    }

    public void setParticipantsNonPKB(List&lt;ParticipantDTO&gt; participantsNonPKB) {
<span class="fc" id="L236">        this.participantsNonPKB = participantsNonPKB;</span>
<span class="fc" id="L237">    }</span>

    @Nullable
    public Message getFirstMessage() {
<span class="fc" id="L241">        return firstMessage;</span>
    }

    public void setFirstMessage(Message firstMessage) {
<span class="fc" id="L245">        this.firstMessage = firstMessage;</span>
<span class="fc" id="L246">    }</span>

    public Hospitalization getHospitalization() {
<span class="fc" id="L249">        return hospitalization;</span>
    }

    public void setHospitalization(Hospitalization hospitalization) {
<span class="nc" id="L253">        this.hospitalization = hospitalization;</span>
<span class="nc" id="L254">    }</span>

    public EncounterStatus getEncounterStatus() {
<span class="fc" id="L257">        return encounterStatus;</span>
    }

    public void setEncounterStatus(EncounterStatus encounterStatus) {
<span class="fc" id="L261">        this.encounterStatus = encounterStatus;</span>
<span class="fc" id="L262">    }</span>

    public List&lt;GeographicLocation&gt; getLocations() {
<span class="fc" id="L265">        return locations;</span>
    }

    public void setLocations(List&lt;GeographicLocation&gt; locations) {
<span class="nc" id="L269">        this.locations = locations;</span>
<span class="nc" id="L270">    }</span>

    public Date getStartDate() {
<span class="fc" id="L273">        return startDate;</span>
    }

    public void setStartDate(Date startDate) {
<span class="fc" id="L277">        this.startDate = startDate;</span>
<span class="fc" id="L278">    }</span>

    public Date getEndDate() {
<span class="fc" id="L281">        return endDate;</span>
    }

    public void setEndDate(Date endDate) {
<span class="fc" id="L285">        this.endDate = endDate;</span>
<span class="fc" id="L286">    }</span>

    public EncounterClass getEncounterClass() {
<span class="fc" id="L289">        return encounterClass;</span>
    }

    public void setEncounterClass(EncounterClass encounterClass) {
<span class="fc" id="L293">        this.encounterClass = encounterClass;</span>
<span class="fc" id="L294">    }</span>

    @Override
    public SourceDetails getSource() {
<span class="fc" id="L298">        return this.source;</span>
    }

    @Override
    public DTOBaseFields getBaseFields() {
<span class="fc" id="L303">        return this.baseFields;</span>
    }

    public void setIndication(String indication) {
<span class="fc" id="L307">        this.indication = indication;</span>
<span class="fc" id="L308">    }</span>

    public String getIndication() {
<span class="fc" id="L311">        return this.indication;</span>
    }

    public List&lt;Message&gt; getMessages() {
<span class="fc" id="L315">        return this.messages;</span>
    }

    public List&lt;PKBPerson&gt; getParticipantsPKB() {
<span class="fc" id="L319">        return participantsPKB;</span>
    }

    public void setParticipantsPKB(List&lt;PKBPerson&gt; participantsPKB) {
<span class="fc" id="L323">        this.participantsPKB = participantsPKB;</span>
<span class="fc" id="L324">    }</span>

    public String getExternalMessageId() {
<span class="fc" id="L327">        return externalMessageId;</span>
    }

    public void setExternalMessageId(String externalMessageId) {
<span class="fc" id="L331">        this.externalMessageId = externalMessageId;</span>
<span class="fc" id="L332">    }</span>

    public String getExternalEncounterId() {
<span class="fc" id="L335">        return externalEncounterId;</span>
    }

    public void setExternalEncounterId(String externalEncounterId) {
<span class="fc" id="L339">        this.externalEncounterId = externalEncounterId;</span>
<span class="fc" id="L340">    }</span>

    public String getReasonCode() {
<span class="fc" id="L343">        return reasonCode;</span>
    }

    public void setReasonCode(String reasonCode) {
<span class="fc" id="L347">        this.reasonCode = reasonCode;</span>
<span class="fc" id="L348">    }</span>

    public String getApiRef() {
<span class="fc" id="L351">        return apiRef;</span>
    }

    public void setApiRef(String apiRef) {
<span class="nc" id="L355">        this.apiRef = apiRef;</span>
<span class="nc" id="L356">    }</span>

    public Code getCodeDetails() {
<span class="fc" id="L359">        return codeDetails;</span>
    }

    public void setCodeDetails(Code codeDetails) {
<span class="nc" id="L363">        this.codeDetails = codeDetails;</span>
<span class="nc" id="L364">    }</span>

    public Message getEncounterDetailsMessage() {
<span class="fc" id="L367">        return encounterDetailsMessage;</span>
    }

    public void setEncounterDetailsMessage(Message message) {
<span class="nc" id="L371">        encounterDetailsMessage = message;</span>
<span class="nc" id="L372">    }</span>

    public boolean containsEncounterEvents() {
<span class="pc bpc" id="L375" title="1 of 4 branches missed.">        return firstMessage != null &amp;&amp; firstMessage.getDataType() == MenuDataType.encounterEvent;</span>
    }

    public void setMenuDataType(MenuDataType menuDataType) {
<span class="fc" id="L379">        this.menuDataType = menuDataType;</span>
<span class="fc" id="L380">    }</span>

    public MenuDataType getMenuDataType() {
<span class="fc" id="L383">        return menuDataType;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>