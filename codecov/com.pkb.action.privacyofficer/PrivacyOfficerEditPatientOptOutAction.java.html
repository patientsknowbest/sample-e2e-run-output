<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PrivacyOfficerEditPatientOptOutAction.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">E2E Tests Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.pkb.action.privacyofficer</a> &gt; <span class="el_source">PrivacyOfficerEditPatientOptOutAction.java</span></div><h1>PrivacyOfficerEditPatientOptOutAction.java</h1><pre class="source lang-java linenums">package com.pkb.action.privacyofficer;

import com.pkb.action.file.ChunkedUploadAction;
import com.pkb.service.team.OrgManager;

import java.io.InputStream;

<span class="fc" id="L8">public class PrivacyOfficerEditPatientOptOutAction extends ChunkedUploadAction {</span>

    private static final long serialVersionUID = -5347275844319486825L;
    private static final String NAMESPACE_PRIVACYOFFICER = &quot;privacyofficer&quot;;

    @Override
    public String getNamespace() {
<span class="nc" id="L15">        return NAMESPACE_PRIVACYOFFICER;</span>
    }

<span class="fc" id="L18">    enum SharingChangeType {</span>
<span class="fc" id="L19">        OptIn,</span>
<span class="fc" id="L20">        OptOut,</span>
    }

    private Long patientId;
    private boolean confirmed;
    private SharingChangeType sharingChangeType;

    // Attachments
    private String attachmentFileName;
    private Long attachmentId;
    private String attachmentContentType;
    private int contentLength;
    private InputStream inputStream;
    private String attachmentName;
    private String unwantedAttachment;
<span class="fc" id="L35">    private String fileUploadErrorMessage = &quot;&quot;;</span>
    private String attachmentSubmit;
    private OrgManager orgManager;

    @Override
    public String execute() throws Exception {

        // This is done here rather than in a validate method because it interferes
        // with file uploads (i.e. if a file upload starts before the confirm checkbox
        // has been clicked, validation fails and the upload is aborted)
        // In future the various places we do file upload should be refactored to use
        // a common action
<span class="pc bpc" id="L47" title="1 of 2 branches missed.">        if (!confirmed) {</span>
<span class="nc" id="L48">            addActionError(getText(&quot;editPatientOptOut.err.not_confirmed&quot;));</span>
<span class="nc" id="L49">            return INPUT;</span>
        }

<span class="fc bfc" id="L52" title="All 2 branches covered.">        if (SharingChangeType.OptOut == sharingChangeType) {</span>
<span class="fc" id="L53">            orgManager.optOutPatient(</span>
<span class="fc" id="L54">                    getLoggedInEHRRequestContext(),</span>
<span class="fc" id="L55">                    loggedInUserUtil.getLoggedInUser(),</span>
<span class="fc" id="L56">                    loggedInUserUtil.getLoggedInUserOrg(),</span>
<span class="fc" id="L57">                    loggedInUserUtil.getLoggedInUserPrimaryTeam(),</span>
<span class="fc" id="L58">                    patientId,</span>
<span class="fc" id="L59">                    messageWebBean.getNullSafeAttachmentsFromSession(session));</span>
<span class="fc" id="L60">            addActionMessage(getText(&quot;editPatientOptOut.txt.disabled_sharing_confirmation&quot;));</span>
        } else {
<span class="fc" id="L62">            orgManager.optInPatient(</span>
<span class="fc" id="L63">                    getLoggedInEHRRequestContext(),</span>
<span class="fc" id="L64">                    loggedInUserUtil.getLoggedInUser(),</span>
<span class="fc" id="L65">                    loggedInUserUtil.getLoggedInUserOrg(),</span>
<span class="fc" id="L66">                    loggedInUserUtil.getLoggedInUserPrimaryTeam(),</span>
<span class="fc" id="L67">                    patientId,</span>
<span class="fc" id="L68">                    messageWebBean.getNullSafeAttachmentsFromSession(session));</span>
<span class="fc" id="L69">            addActionMessage(getText(&quot;editPatientOptOut.txt.enabled_sharing_confirmation&quot;));</span>
        }

<span class="fc" id="L72">        messageWebBean.removeAttachmentsFromSession(session);</span>

<span class="fc" id="L74">        return SUCCESS;</span>
    }

    public Long getPatientId() {
<span class="fc" id="L78">        return patientId;</span>
    }

    public void setPatientId(Long patientId) {
<span class="fc" id="L82">        this.patientId = patientId;</span>
<span class="fc" id="L83">    }</span>

    public boolean isConfirmed() {
<span class="nc" id="L86">        return confirmed;</span>
    }

    public void setConfirmed(boolean confirmed) {
<span class="fc" id="L90">        this.confirmed = confirmed;</span>
<span class="fc" id="L91">    }</span>

    public SharingChangeType getSharingChangeType() {
<span class="nc" id="L94">        return sharingChangeType;</span>
    }

    public void setSharingChangeType(SharingChangeType sharingChangeType) {
<span class="fc" id="L98">        this.sharingChangeType = sharingChangeType;</span>
<span class="fc" id="L99">    }</span>

    public String getAttachmentFileName() {
<span class="nc" id="L102">        return attachmentFileName;</span>
    }

    public void setAttachmentFileName(String attachmentFileName) {
<span class="nc" id="L106">        this.attachmentFileName = attachmentFileName;</span>
<span class="nc" id="L107">    }</span>

    public Long getAttachmentId() {
<span class="nc" id="L110">        return attachmentId;</span>
    }

    public void setAttachmentId(Long attachmentId) {
<span class="nc" id="L114">        this.attachmentId = attachmentId;</span>
<span class="nc" id="L115">    }</span>

    public String getAttachmentContentType() {
<span class="nc" id="L118">        return attachmentContentType;</span>
    }

    public void setAttachmentContentType(String attachmentContentType) {
<span class="nc" id="L122">        this.attachmentContentType = attachmentContentType;</span>
<span class="nc" id="L123">    }</span>

    public int getContentLength() {
<span class="nc" id="L126">        return contentLength;</span>
    }

    public void setContentLength(int contentLength) {
<span class="nc" id="L130">        this.contentLength = contentLength;</span>
<span class="nc" id="L131">    }</span>

    public InputStream getInputStream() {
<span class="nc" id="L134">        return inputStream;</span>
    }

    public void setInputStream(InputStream inputStream) {
<span class="nc" id="L138">        this.inputStream = inputStream;</span>
<span class="nc" id="L139">    }</span>

    public String getAttachmentName() {
<span class="nc" id="L142">        return attachmentName;</span>
    }

    public void setAttachmentName(String attachmentName) {
<span class="nc" id="L146">        this.attachmentName = attachmentName;</span>
<span class="nc" id="L147">    }</span>

    public String getUnwantedAttachment() {
<span class="nc" id="L150">        return unwantedAttachment;</span>
    }

    public void setUnwantedAttachment(String unwantedAttachment) {
<span class="nc" id="L154">        this.unwantedAttachment = unwantedAttachment;</span>
<span class="nc" id="L155">    }</span>

    public String getFileUploadErrorMessage() {
<span class="nc" id="L158">        return fileUploadErrorMessage;</span>
    }

    public void setFileUploadErrorMessage(String fileUploadErrorMessage) {
<span class="nc" id="L162">        this.fileUploadErrorMessage = fileUploadErrorMessage;</span>
<span class="nc" id="L163">    }</span>

    public String getAttachmentSubmit() {
<span class="nc" id="L166">        return attachmentSubmit;</span>
    }

    public void setAttachmentSubmit(String attachmentSubmit) {
<span class="nc" id="L170">        this.attachmentSubmit = attachmentSubmit;</span>
<span class="nc" id="L171">    }</span>

    public void setOrgManager(OrgManager orgManager) {
<span class="fc" id="L174">        this.orgManager = orgManager;</span>
<span class="fc" id="L175">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>