<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BulkInviteConfig.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">E2E Tests Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.pkb.service.config</a> &gt; <span class="el_source">BulkInviteConfig.java</span></div><h1>BulkInviteConfig.java</h1><pre class="source lang-java linenums">package com.pkb.service.config;

import com.google.common.collect.ImmutableList;
import com.google.common.collect.ImmutableSet;
import com.pkb.bean.IUserBean;
import com.pkb.bean.impl.UserBean;
import com.pkb.common.base.Error;
import com.pkb.common.config.PhrConfig;
import com.pkb.common.csv.ApacheCsvParserFactory;
import com.pkb.common.csv.CsvOpener;
import com.pkb.common.csv.CsvParserFactory;
import com.pkb.common.csv.CsvRecordConverter;
import com.pkb.common.csv.RowValidator;
import com.pkb.common.datetime.DateTimeService;
import com.pkb.domain.BulkInvitationOutcomeService;
import com.pkb.mappers.SourceDetailsMapper;
import com.pkb.patient.invite.RequestBoundCarerRegisterFactory;
import com.pkb.patient.invite.RequestBoundExistingPatientRegisterFactory;
import com.pkb.patient.invite.RequestBoundNewPatientRegisterFactory;
import com.pkb.patient.invite.RequestBoundPatientRegisterFactory;
import com.pkb.patient.invite.bulk.BulkInvitationTaskFactory;
import com.pkb.patient.invite.bulk.BulkPatientInvitationOutcomesService;
import com.pkb.patient.invite.bulk.csv.AddressMapper;
import com.pkb.patient.invite.bulk.csv.BirthdayMapper;
import com.pkb.patient.invite.bulk.csv.BulkInvitationCsvProcessorFactory;
import com.pkb.patient.invite.bulk.csv.BulkInvitationResultProcessor;
import com.pkb.patient.invite.bulk.csv.BulkInvitationRowMapperFactory;
import com.pkb.patient.invite.bulk.csv.BulkPatientInvitationHeaderValidator;
import com.pkb.patient.invite.bulk.csv.ColumnCountRowValidator;
import com.pkb.patient.invite.bulk.csv.CsvContentConverter;
import com.pkb.patient.invite.bulk.csv.EmailMapper;
import com.pkb.patient.invite.bulk.csv.InvitationResultConverter;
import com.pkb.patient.invite.bulk.csv.InvitedCarerMapper;
import com.pkb.patient.invite.bulk.csv.InviteeIdsColumnsMapperFactory;
import com.pkb.patient.invite.bulk.csv.InviteeMapperFactory;
import com.pkb.patient.invite.bulk.csv.NameDtoMapper;
import com.pkb.service.document.DocumentManager;
import com.pkb.service.emailmessage.impl.PKBEmailMessageManager;
import com.pkb.service.invitation.impl.InvitationManager;
import com.pkb.service.patientconsent.DeprecatedPatientConsentManager;
import com.pkb.service.patientconsent.PatientConsentManager;
import com.pkb.service.team.TeamUserManager;
import com.pkb.service.user.BulkInvitationOutcomesManager;
import com.pkb.service.user.impl.PersonContactManager;
import com.pkb.service.user.impl.RemoteAwareBulkInvitationOutcomesManager;
import com.pkb.service.user.impl.UserAccessManager;
import com.pkb.service.user.impl.UserManager;
import com.pkb.service.uuid.UUIDProvider;
import com.pkb.util.tolven.ConvertUtil;
import com.pkb.util.tolven.TolvenBeanFactory;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import java.util.List;

import static com.pkb.patient.invite.bulk.csv.BulkInvitationConstants.ACCOUNT_CREATION_OUTCOME;
import static com.pkb.patient.invite.bulk.csv.BulkInvitationConstants.CARER_ONE_EMAIL;
import static com.pkb.patient.invite.bulk.csv.BulkInvitationConstants.CARER_ONE_FIRST_NAME;
import static com.pkb.patient.invite.bulk.csv.BulkInvitationConstants.CARER_ONE_LAST_NAME;
import static com.pkb.patient.invite.bulk.csv.BulkInvitationConstants.CARER_ONE_OUTCOME;
import static com.pkb.patient.invite.bulk.csv.BulkInvitationConstants.CARER_TWO_EMAIL;
import static com.pkb.patient.invite.bulk.csv.BulkInvitationConstants.CARER_TWO_FIRST_NAME;
import static com.pkb.patient.invite.bulk.csv.BulkInvitationConstants.CARER_TWO_LAST_NAME;
import static com.pkb.patient.invite.bulk.csv.BulkInvitationConstants.CARER_TWO_OUTCOME;
import static com.pkb.patient.invite.bulk.csv.BulkInvitationConstants.INVITEE_ADDRESS_PART_ONE;
import static com.pkb.patient.invite.bulk.csv.BulkInvitationConstants.INVITEE_ADDRESS_PART_TWO;
import static com.pkb.patient.invite.bulk.csv.BulkInvitationConstants.INVITEE_CITY;
import static com.pkb.patient.invite.bulk.csv.BulkInvitationConstants.INVITEE_COUNTY;
import static com.pkb.patient.invite.bulk.csv.BulkInvitationConstants.INVITEE_DATE_OF_BIRTH_DAY;
import static com.pkb.patient.invite.bulk.csv.BulkInvitationConstants.INVITEE_DATE_OF_BIRTH_MONTH;
import static com.pkb.patient.invite.bulk.csv.BulkInvitationConstants.INVITEE_DATE_OF_BIRTH_YEAR;
import static com.pkb.patient.invite.bulk.csv.BulkInvitationConstants.INVITEE_EMAIL;
import static com.pkb.patient.invite.bulk.csv.BulkInvitationConstants.INVITEE_FIRST_NAME;
import static com.pkb.patient.invite.bulk.csv.BulkInvitationConstants.INVITEE_LAST_NAME;
import static com.pkb.patient.invite.bulk.csv.BulkInvitationConstants.INVITEE_NATIONAL_IDENTIFIER;
import static com.pkb.patient.invite.bulk.csv.BulkInvitationConstants.INVITEE_ORGANIZATION_LEVEL_IDENTIFIER;
import static com.pkb.patient.invite.bulk.csv.BulkInvitationConstants.INVITEE_POST_CODE;
import static com.pkb.patient.invite.bulk.csv.BulkInvitationConstants.INVITEE_TEAM_LEVEL_IDENTIFIER;
import static com.pkb.patient.invite.bulk.csv.BulkInvitationConstants.INVITEE_TITLE;

@Configuration
<span class="fc" id="L83">public class BulkInviteConfig {</span>
    private static final String BULK_INVITATION_CSV_HEADERS = &quot;BULK_INVITATION_CSV_HEADERS&quot;;

    @Bean(name = BULK_INVITATION_CSV_HEADERS)
    public ImmutableList&lt;String&gt; bulkInvitationCsvColumns() {
<span class="fc" id="L88">        return ImmutableList.of(</span>
                INVITEE_TITLE,
                INVITEE_FIRST_NAME,
                INVITEE_LAST_NAME,
                INVITEE_EMAIL,
                INVITEE_DATE_OF_BIRTH_YEAR,
                INVITEE_DATE_OF_BIRTH_MONTH,
                INVITEE_DATE_OF_BIRTH_DAY,
                INVITEE_ADDRESS_PART_ONE,
                INVITEE_ADDRESS_PART_TWO,
                INVITEE_CITY,
                INVITEE_COUNTY,
                INVITEE_POST_CODE,
                INVITEE_NATIONAL_IDENTIFIER,
                INVITEE_ORGANIZATION_LEVEL_IDENTIFIER,
                INVITEE_TEAM_LEVEL_IDENTIFIER,
                CARER_ONE_FIRST_NAME,
                CARER_ONE_LAST_NAME,
                CARER_ONE_EMAIL,
                CARER_TWO_FIRST_NAME,
                CARER_TWO_LAST_NAME,
                CARER_TWO_EMAIL);
    }

    @Bean
    public ApacheCsvParserFactory csvParserFactory() {
<span class="fc" id="L114">        return new ApacheCsvParserFactory();</span>
    }

    @Bean
    public BulkPatientInvitationHeaderValidator headerValidator(
            @Qualifier(BULK_INVITATION_CSV_HEADERS) ImmutableList&lt;String&gt; expectedColumnHeaders) {
<span class="fc" id="L120">        return new BulkPatientInvitationHeaderValidator(ImmutableSet.copyOf(expectedColumnHeaders));</span>
    }

    @Bean
    public RowValidator&lt;Error&gt; bulkInvitationRowValidator(
            @Qualifier(BULK_INVITATION_CSV_HEADERS) ImmutableList&lt;String&gt; expectedColumnHeaders) {
<span class="fc" id="L126">        return new ColumnCountRowValidator(expectedColumnHeaders.size());</span>
    }

    @Bean
    public IUserBean userBean(
            TeamUserManager teamUserManager,
            @SuppressWarnings(&quot;deprecation&quot;) DeprecatedPatientConsentManager deprecatedPatientConsentManager,
            UserManager userManager,
            InvitationManager invitationManager,
            UserAccessManager userAccessManager,
            PersonContactManager personContactManager,
            PKBEmailMessageManager pkbEmailMessageManager,
            DateTimeService dateTimeService,
            ConvertUtil convertUtil,
            UUIDProvider uuidProvider,
            TolvenBeanFactory beanFactory,
            PatientConsentManager patientConsentManager,
            SourceDetailsMapper sourceDetailsMapper,
            DocumentManager documentManager,
            PhrConfig config) {
<span class="fc" id="L146">        return new UserBean(</span>
                teamUserManager,
                deprecatedPatientConsentManager,
                userManager,
                invitationManager,
                beanFactory,
                userAccessManager,
                personContactManager,
                pkbEmailMessageManager,
                dateTimeService,
                convertUtil,
                uuidProvider,
                patientConsentManager,
                sourceDetailsMapper,
                documentManager, config);
    }

    @Bean
    public RequestBoundExistingPatientRegisterFactory existingPatientRegisterFactory(
            UserManager userManager,
            TeamUserManager teamUserManager,
            UserAccessManager userAccessManager,
            PKBEmailMessageManager pkbEmailMessageManager,
            DateTimeService dateTimeService,
            PatientConsentManager patientConsentManager,
            DeprecatedPatientConsentManager deprecatedPatientConsentManager) {
<span class="fc" id="L172">        return new RequestBoundExistingPatientRegisterFactory(</span>
                userManager,
                teamUserManager,
                userAccessManager,
                pkbEmailMessageManager,
                dateTimeService,
                deprecatedPatientConsentManager,
                patientConsentManager);
    }

    @Bean
    public RequestBoundNewPatientRegisterFactory newPatientRegisterFactory(
            TeamUserManager teamUserManager, PatientConsentManager patientConsentManager) {
<span class="fc" id="L185">        return new RequestBoundNewPatientRegisterFactory(teamUserManager, patientConsentManager);</span>
    }

    @Bean
    public RequestBoundCarerRegisterFactory carerRegisterFactory(
            UserManager userManager,
            InvitationManager invitationManager,
            IUserBean userWebBean,
            PatientConsentManager patientConsentManager) {
<span class="fc" id="L194">        return new RequestBoundCarerRegisterFactory(userManager, invitationManager, userWebBean, patientConsentManager);</span>
    }

    @Bean
    public RequestBoundPatientRegisterFactory registerFactory(
            UserManager userManager,
            RequestBoundExistingPatientRegisterFactory existingPatientRegisterFactory,
            RequestBoundNewPatientRegisterFactory newPatientRegisterFactory,
            RequestBoundCarerRegisterFactory carerRegisterFactory) {
<span class="fc" id="L203">        return new RequestBoundPatientRegisterFactory(</span>
                userManager,
                existingPatientRegisterFactory,
                newPatientRegisterFactory,
                carerRegisterFactory);
    }

    @Bean
    public BulkInvitationResultProcessor resultProcessor() {
<span class="fc" id="L212">        return new BulkInvitationResultProcessor();</span>
    }

    @Bean
    public CsvRecordConverter csvRecordConverter(@Qualifier(BULK_INVITATION_CSV_HEADERS) ImmutableList&lt;String&gt; expectedColumnHeaders) {
<span class="fc" id="L217">        List&lt;String&gt; orderedHeader = ImmutableList.&lt;String&gt; builder()</span>
<span class="fc" id="L218">                .add(ACCOUNT_CREATION_OUTCOME)</span>
<span class="fc" id="L219">                .add(CARER_ONE_OUTCOME)</span>
<span class="fc" id="L220">                .add(CARER_TWO_OUTCOME)</span>
<span class="fc" id="L221">                .addAll(expectedColumnHeaders)</span>
<span class="fc" id="L222">                .build();</span>

<span class="fc" id="L224">        return new CsvRecordConverter(orderedHeader);</span>
    }

    @Bean
    public InvitationResultConverter resultConverter() {
<span class="fc" id="L229">        return new InvitationResultConverter();</span>
    }

    @Bean
    public CsvContentConverter contentWriter(CsvRecordConverter converter) {
<span class="fc" id="L234">        return new CsvContentConverter(converter);</span>
    }

    @Bean
    public BulkInvitationCsvProcessorFactory csvProcessorFactory(
            BulkInvitationRowMapperFactory rowMapperFactory,
            RequestBoundPatientRegisterFactory patientRegisterFactory,
            InvitationResultConverter invitationResultConverter) {
<span class="fc" id="L242">        return new BulkInvitationCsvProcessorFactory(rowMapperFactory, patientRegisterFactory, invitationResultConverter);</span>
    }

    @Bean
    public RemoteAwareBulkInvitationOutcomesManager outcomesManager(PhrConfig config, TolvenBeanFactory beanFactory, DateTimeService dateTimeService, UUIDProvider uuidProvider, BulkInvitationOutcomeService bulkInvitationOutcomeService) {
<span class="fc" id="L247">        return new RemoteAwareBulkInvitationOutcomesManager(config, beanFactory, dateTimeService, uuidProvider, bulkInvitationOutcomeService);</span>
    }

    @Bean
    public BulkInvitationTaskFactory bulkInvitationTaskFactory(
            PKBEmailMessageManager pkbEmailMessageManager,
            BulkInvitationResultProcessor resultProcessor,
            CsvContentConverter csvContentConverter,
            BulkInvitationOutcomesManager outcomesManager,
            DateTimeService dateTimeService,
            BulkInvitationCsvProcessorFactory csvProcessorFactory) {
<span class="fc" id="L258">        return new BulkInvitationTaskFactory(</span>
                pkbEmailMessageManager,
                resultProcessor,
                csvContentConverter,
                outcomesManager,
                dateTimeService,
                csvProcessorFactory);
    }

    @Bean
    public BulkPatientInvitationOutcomesService outcomesService(BulkInvitationOutcomesManager invitationOutcomesManager, UserManager userManager) {
<span class="fc" id="L269">        return new BulkPatientInvitationOutcomesService(invitationOutcomesManager, userManager);</span>
    }

    @Bean
    public NameDtoMapper nameMapper() {
<span class="fc" id="L274">        return new NameDtoMapper();</span>
    }

    @Bean
    public EmailMapper emailColumnMapper() {
<span class="fc" id="L279">        return new EmailMapper();</span>
    }

    @Bean
    public BirthdayMapper birthdayMapper() {
<span class="fc" id="L284">        return new BirthdayMapper();</span>
    }

    @Bean
    public AddressMapper addressMapper() {
<span class="fc" id="L289">        return new AddressMapper();</span>
    }

    @Bean
    public InviteeIdsColumnsMapperFactory inviteeIdsColumnsMapperFactory() {
<span class="fc" id="L294">        return new InviteeIdsColumnsMapperFactory();</span>
    }

    @Bean
    public InviteeMapperFactory inviteeMapperFactory(
            NameDtoMapper nameMapper,
            InviteeIdsColumnsMapperFactory inviteeIdsMapperFactory,
            EmailMapper emailMapper,
            BirthdayMapper birthdayMapper,
            AddressMapper addressMapper) {
<span class="fc" id="L304">        return new InviteeMapperFactory(</span>
                nameMapper,
                inviteeIdsMapperFactory,
                emailMapper,
                birthdayMapper,
                addressMapper);
    }

    @Bean
    public BulkInvitationRowMapperFactory bulkInvitationRowMapperFactory(
            RowValidator&lt;Error&gt; rowValidator,
            InviteeMapperFactory inviteeMapperFactory) {
<span class="fc" id="L316">        return new BulkInvitationRowMapperFactory(</span>
                rowValidator,
                inviteeMapperFactory,
                new InvitedCarerMapper(
                        CARER_ONE_FIRST_NAME,
                        CARER_ONE_LAST_NAME,
                        CARER_ONE_EMAIL),
                new InvitedCarerMapper(
                        CARER_TWO_FIRST_NAME,
                        CARER_TWO_LAST_NAME,
                        CARER_TWO_EMAIL));
    }

    @Bean
    public CsvOpener csvOpener(CsvParserFactory parserFactory, BulkPatientInvitationHeaderValidator headerValidator) {
<span class="fc" id="L331">        return new CsvOpener(parserFactory, headerValidator);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>