<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>HL7ObservationMapper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">E2E Tests Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.pkb.service.dataupload.hl7.segment</a> &gt; <span class="el_source">HL7ObservationMapper.java</span></div><h1>HL7ObservationMapper.java</h1><pre class="source lang-java linenums">package com.pkb.service.dataupload.hl7.segment;

import com.pkb.service.dataupload.hl7.field.HL7Code;
import com.pkb.service.dataupload.hl7.field.HL7CodeComparisonDTO;
import com.pkb.service.dataupload.hl7.field.HL7CodeMapper;
import com.pkb.service.dataupload.hl7.value.HL7Date;
import com.pkb.service.dataupload.hl7.value.HL7DateComparisonDTO;
import com.pkb.service.dataupload.hl7.value.HL7DateMapper;
import org.apache.commons.codec.binary.Base64;
import org.mapstruct.BeanMapping;
import org.mapstruct.Mapper;
import org.mapstruct.ReportingPolicy;
import org.mapstruct.factory.Mappers;

import java.util.Optional;

@Mapper(unmappedSourcePolicy = ReportingPolicy.ERROR)
public interface HL7ObservationMapper {

<span class="fc" id="L20">    HL7ObservationMapper INSTANCE = Mappers.getMapper(HL7ObservationMapper.class);</span>
<span class="fc" id="L21">    HL7CodeMapper HL7CODE_MAPPER = Mappers.getMapper(HL7CodeMapper.class);</span>
<span class="fc" id="L22">    HL7DateMapper HL7DATE_MAPPER = Mappers.getMapper(HL7DateMapper.class);</span>

    /**
     * Reasons for exclusion:
     * - messageProperties: This tracks message-level time zone information to be used when processing the OBX, but not content from the OBX itself
     * - obxSetId: Examples from customers suggest this changes across profiles even when the result itself is the same
     * - processed: This is purely an internal marker to indicate if the OBX has been processed; it does not contain OBX content
     * - testId: getTestId() can be excluded because the response is generated from testCode, which is not excluded
     * - textValueType: isTextValueType() can be excluded because the response is generated from valueType, which is not excluded
     *
     * @param hl7Observation The observation to map
     * @return A comparison object representing the meaning-bearing components of the OBX segment
     */
    @BeanMapping(ignoreUnmappedSourceProperties = {&quot;messageProperties&quot;, &quot;obxSetId&quot;, &quot;processed&quot;, &quot;testId&quot;, &quot;textValueType&quot;})
    HL7ObservationComparisonDTO map(HL7Observation hl7Observation);

    /**
     * Handle HL7Code objects
     */
    default HL7CodeComparisonDTO map(HL7Code hl7Code) {
<span class="fc" id="L42">        return HL7CODE_MAPPER.map(hl7Code);</span>
    }

    /**
     * Handle HL7Date objects
     */
    default HL7DateComparisonDTO map(HL7Date hl7Date) {
<span class="fc" id="L49">        return HL7DATE_MAPPER.map(hl7Date);</span>
    }

    /**
     * For simplicity, encode byte[] into a Base64 string
     */
    default Optional&lt;String&gt; mapToOptional(byte[] value) {
<span class="fc" id="L56">        return Optional.ofNullable(value).map(Base64::encodeBase64String);</span>
    }

    /**
     * Generic mapping of source non-Optional value to a target Optional value
     */
    default &lt;T&gt; Optional&lt;T&gt; mapToOptional(T value) {
<span class="fc" id="L63">        return Optional.ofNullable(value);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>