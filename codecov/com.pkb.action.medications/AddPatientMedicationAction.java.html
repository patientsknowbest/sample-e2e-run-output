<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AddPatientMedicationAction.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">E2E Tests Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.pkb.action.medications</a> &gt; <span class="el_source">AddPatientMedicationAction.java</span></div><h1>AddPatientMedicationAction.java</h1><pre class="source lang-java linenums">package com.pkb.action.medications;

import com.opensymphony.xwork2.Action;
import com.pkb.action.BaseAction;
import com.pkb.action.file.ChunkedUploadAction;
import com.pkb.app.entity.EHRRequestContext;
import com.pkb.app.entity.LoggedInEHRRequestContext;
import com.pkb.app.entity.SourceDetails;
import com.pkb.bean.IMedicationWebBean;
import com.pkb.bean.impl.MedicationWebBean;
import com.pkb.coding.entity.CodeableConcept;
import com.pkb.datamodel.consent.RequiresConsent;
import com.pkb.document.entity.Attachment;
import com.pkb.entities.enums.MenuDataType;
import com.pkb.medication.entity.Medication;
import com.pkb.medication.entity.Medication.MedicationStatus;
import com.pkb.medication.entity.MedicationUnit;
import com.pkb.medication.entity.PKBMedicationFrequency;
import com.pkb.notification.entity.Activity;
import com.pkb.notification.entity.ActivityProperty;
import com.pkb.service.medication.MedicationManager;
import com.pkb.service.user.impl.UserManager;
import io.vavr.control.Either;
import org.apache.struts2.interceptor.validation.SkipValidation;

import java.text.ParseException;
import java.time.format.DateTimeFormatter;
import java.time.format.DateTimeParseException;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Date;
import java.util.EnumMap;
import java.util.LinkedList;
import java.util.List;
import java.util.Map;
import java.util.Objects;
import java.util.UUID;
import java.util.stream.Collectors;

import static com.pkb.user.entity.PKBPerson.Lazy.CONTACTS;
import static java.lang.String.format;
import static org.apache.commons.collections4.CollectionUtils.isNotEmpty;
import static org.apache.commons.lang3.StringUtils.isBlank;
import static org.apache.commons.lang3.StringUtils.isNotBlank;


/**
 * Action for adding, editing and deleting patient medications
 *
 * @author russell
 */
<span class="fc" id="L52">public class AddPatientMedicationAction extends ChunkedUploadAction {</span>

    private static final long serialVersionUID = 1L;
    private static final int FIRST_INDEX  = 0;
    private static final String FIELD_NAME_FORMAT_DESCRIPTION = &quot;inputDtos[%s].description&quot;;
    private static final String FIELD_NAME_FORMAT_START_DATE = &quot;inputDtos[%s].startDate&quot;;
    private static final String FIELD_NAME_FORMAT_END_DATE = &quot;inputDtos[%s].endDate&quot;;
    private static final String FIELD_NAME_FORMAT_DOSE_VALUE = &quot;inputDtos[%s].doseValue&quot;;
    private static final int DESCRIPTION_CHARACTER_LIMIT = 150;
    private static final String FILE_UPLOAD_BUTTON_TEXT_PROPERTY = &quot;addPatientMedication.txt.choose_file&quot;;
    private static final String MULTIPLE_FILE_UPLOAD_BUTTON_TEXT_PROPERTY = &quot;addPatientMedication.txt.choose_another_file&quot;;
    private static final String NAMESPACE_AUTH = &quot;auth&quot;;

<span class="fc" id="L65">    private List&lt;PKBMedicationFrequency&gt; frequencies = new ArrayList&lt;&gt;(); //out</span>
<span class="fc" id="L66">    private List&lt;MedicationInputDto&gt; inputDtos = new ArrayList&lt;&gt;();</span>

    //for editing an individual medication
    private Long medicationId;
    private Long dataPointId;
    private UUID uniqueId;
    private List&lt;Medication&gt; medications;

<span class="fc" id="L74">    private String tab = &quot;treatments&quot;;</span>

<span class="fc" id="L76">    private String subTab = &quot;medications&quot;;</span>

    private Long patientId;
    private Long patientAccountId;

    private MedicationManager medicationManager;

    private IMedicationWebBean medicationWebBean;

    private void loadFrequencies() {
<span class="fc" id="L86">        frequencies = Arrays.asList(PKBMedicationFrequency.values());</span>
<span class="fc" id="L87">    }</span>

    private BaseAction.Users setUsersVariables() {
<span class="fc" id="L90">        var users = getContextAndLoggedInUsers(CONTACTS);</span>
<span class="fc" id="L91">        patientId = users.contextUser().getId();</span>
<span class="fc" id="L92">        patientAccountId = userManager.getDefaultAccountId(patientId);</span>
<span class="fc" id="L93">        return users;</span>
    }

    @Override
    public String input() {
<span class="fc" id="L98">        loadFrequencies();</span>
<span class="fc" id="L99">        MedicationInputDto inputDto = new MedicationInputDto();</span>
<span class="fc" id="L100">        fileUploadButtonTextProperty = FILE_UPLOAD_BUTTON_TEXT_PROPERTY;</span>
<span class="fc" id="L101">        multipleFileUploadButtonTextProperty = MULTIPLE_FILE_UPLOAD_BUTTON_TEXT_PROPERTY;</span>

<span class="fc bfc" id="L103" title="All 2 branches covered.">        if (isEditMode()) {</span>
<span class="fc" id="L104">            LoggedInEHRRequestContext loggedInEHRRequestContext = getLoggedInEHRRequestContext();</span>
<span class="fc" id="L105">            Medication medication = medicationManager.getMedication(loggedInEHRRequestContext, patientAccountId, medicationId);</span>
<span class="fc" id="L106">            medications = List.of(medication);</span>

<span class="fc bfc" id="L108" title="All 2 branches covered.">            if (hasErrors()) {</span>
<span class="fc" id="L109">                populateAttachmentsFromSession();</span>
            } else {
<span class="pc bpc" id="L111" title="1 of 2 branches missed.">                if (hasNotPermissionsToEditDatapoint(medication, loggedInEHRRequestContext)) {</span>
<span class="nc" id="L112">                    return removeAttachmentsAndCancel();</span>
                }
<span class="fc" id="L114">                disablePrivacyFlagEditForm();</span>

<span class="fc" id="L116">                DateTimeFormatter format = getGlobalDateInputFormatter();</span>

<span class="fc" id="L118">                inputDto.setDescription(medication.getMedication().getTextForDisplay());</span>
<span class="pc bpc" id="L119" title="1 of 2 branches missed.">                if (medication.getDoseValue() != null) {</span>
<span class="fc" id="L120">                    inputDto.setDoseValue(MedicationWebBean.formatDose(medication.getDoseValue()));</span>
                }
<span class="fc" id="L122">                inputDto.setDoseUnitsId(medication.getDoseUnitPkbId());</span>
<span class="fc bfc" id="L123" title="All 4 branches covered.">                if (medication.getDoseUnitPkbId() == null &amp;&amp; medication.getDoseUnit() != null) {</span>
<span class="fc" id="L124">                    inputDto.setDoseUnitsFreetext(medication.getDoseUnit().getTextForDisplay());</span>
                }
<span class="fc bfc" id="L126" title="All 2 branches covered.">                if (medication.getFrequency() != null) {</span>
<span class="fc" id="L127">                    inputDto.setFrequencyCode(medication.getFrequency().getCode());</span>
                } else {
<span class="fc" id="L129">                    inputDto.setFrequencyFreetext(medication.getFrequencyDisplayStr());</span>
                }
<span class="pc bpc" id="L131" title="1 of 2 branches missed.">                if (medication.getStartDate() != null) {</span>
<span class="fc" id="L132">                    inputDto.setStartDate(dateToString(medication.getStartDate(), format));</span>
                }
<span class="fc bfc" id="L134" title="All 2 branches covered.">                if (medication.getEndDate() != null) {</span>
<span class="fc" id="L135">                    inputDto.setEndDate(dateToString(medication.getEndDate(), format));</span>
                }
<span class="fc" id="L137">                inputDto.setInstruction(medication.getInstructions());</span>

<span class="fc" id="L139">                uniqueId = medication.getBaseFields().getUniqueId();</span>

<span class="fc" id="L141">                populateAttachmentsFromDB(loggedInEHRRequestContext, medicationId);</span>
<span class="fc" id="L142">                messageWebBean.setAttachmentsInSession(attachments, session);</span>
<span class="fc" id="L143">                inputDtos.add(inputDto);</span>
            }
<span class="fc" id="L145">        } else {</span>
<span class="fc bfc" id="L146" title="All 2 branches covered.">            if (hasErrors()) {</span>
<span class="fc" id="L147">                populateAttachmentsFromSession();</span>
            } else {
                // Remove populated attachments from previous, interrupted additions
<span class="fc" id="L150">                messageWebBean.removeAttachmentsFromSession(session);</span>
<span class="fc" id="L151">                inputDtos.add(inputDto);</span>
            }
<span class="fc" id="L153">            setDefaultFlag();</span>
        }

<span class="fc" id="L156">        return Action.INPUT;</span>
    }

    @Override
    public void validate() {
<span class="fc" id="L161">        refillPrivacyFlags();</span>
<span class="fc" id="L162">        DateTimeFormatter format = getGlobalDateInputFormatter();</span>
<span class="fc" id="L163">        inputDtos.removeIf(Objects::isNull);</span>

<span class="fc bfc" id="L165" title="All 2 branches covered.">        for (int i = 0; i &lt; inputDtos.size(); ++i) {</span>
<span class="fc" id="L166">            MedicationInputDto dto = inputDtos.get(i);</span>
<span class="pc bpc" id="L167" title="1 of 2 branches missed.">            if (isBlank(dto.getDescription())) {</span>
<span class="nc" id="L168">                addFieldError(format(FIELD_NAME_FORMAT_DESCRIPTION, i), getText(&quot;addPatientMedicationAction.err.substance_required&quot;));</span>
<span class="fc bfc" id="L169" title="All 2 branches covered.">            } else if (dto.getDescription().length() &gt; DESCRIPTION_CHARACTER_LIMIT) {</span>
<span class="fc" id="L170">                addFieldError(&quot;inputDtos[&quot; + i + &quot;].description&quot;, getText(&quot;addPatientMedicationAction.err.substance_length&quot;));</span>
            }

<span class="fc bfc" id="L173" title="All 2 branches covered.">            if (isNotBlank(dto.getStartDate())) {</span>
                try {
<span class="fc" id="L175">                    format.parse(dto.getStartDate().trim());</span>
<span class="fc" id="L176">                } catch (DateTimeParseException ignored) {</span>
<span class="fc" id="L177">                    addFieldError(format(FIELD_NAME_FORMAT_START_DATE, i), getText(&quot;addPatientMedicationAction.err.enter_valid_date&quot;));</span>
<span class="fc" id="L178">                }</span>
            }

<span class="fc bfc" id="L181" title="All 2 branches covered.">            if (isNotBlank(dto.getEndDate())) {</span>
                try {
<span class="fc" id="L183">                    format.parse(dto.getEndDate().trim());</span>
<span class="fc" id="L184">                }  catch (DateTimeParseException ignored) {</span>
<span class="fc" id="L185">                    addFieldError(format(FIELD_NAME_FORMAT_END_DATE, i), getText(&quot;addPatientMedicationAction.err.enter_valid_date&quot;));</span>
<span class="fc" id="L186">                }</span>
            }

<span class="fc bfc" id="L189" title="All 2 branches covered.">            if (isNotBlank(dto.getDoseValue())) {</span>
                try {
<span class="fc" id="L191">                    Double.parseDouble(dto.getDoseValue().trim());</span>
<span class="fc" id="L192">                } catch (NumberFormatException ignored) {</span>
<span class="fc" id="L193">                    addFieldError(format(FIELD_NAME_FORMAT_DOSE_VALUE, i), getText(&quot;addPatientMedicationAction.err.dose_invalid&quot;));</span>
<span class="fc" id="L194">                }</span>
            }
        }
<span class="fc" id="L197">    }</span>

    public String saveMedication() throws ParseException {
<span class="fc" id="L200">        setUsersVariables();</span>
<span class="fc" id="L201">        LoggedInEHRRequestContext loggedInEHRRequestContext = getLoggedInEHRRequestContext();</span>
<span class="fc" id="L202">        attachments = messageWebBean.getAttachmentsFromSession(session);</span>

<span class="fc" id="L204">        var sourceDetails = new SourceDetails(loggedInEHRRequestContext);</span>
<span class="fc bfc" id="L205" title="All 2 branches covered.">        if (isEditMode()) {</span>
<span class="fc" id="L206">            Medication medication = medicationManager.getMedication(loggedInEHRRequestContext, patientAccountId, medicationId);</span>
<span class="pc bpc" id="L207" title="1 of 2 branches missed.">            if (hasNotPermissionsToEditDatapoint(medication, loggedInEHRRequestContext)) {</span>
<span class="nc" id="L208">                return removeAttachmentsAndCancel();</span>
            }
<span class="fc" id="L210">            medication.setSource(sourceDetails);</span>
<span class="fc" id="L211">            medication.getBaseFields().setUniqueId(uniqueId);</span>
<span class="fc" id="L212">            populateMedication(medication, inputDtos.get(FIRST_INDEX));</span>
<span class="fc" id="L213">            medications = List.of(medication);</span>

<span class="fc" id="L215">            medicationManager.transactional(() -&gt; {</span>
<span class="fc" id="L216">                Either&lt;String, UUID&gt; maybeMedication = medicationManager.updateMedication(loggedInEHRRequestContext, medication);</span>
<span class="fc" id="L217">                maybeMedication.peekLeft(this::handleExcludedDataPoint);</span>
<span class="fc" id="L218">                maybeMedication.peek(uniqueId -&gt; logActivity(patientId, Activity.Action.EDITED_MEDICATION_RECORD, medication.getMedication().getDisplayText(), medication));</span>
<span class="fc" id="L219">            });</span>
<span class="fc" id="L220">        } else {</span>
<span class="fc" id="L221">            medications = populateMedications();</span>

<span class="fc" id="L223">            medications.forEach(m -&gt; medicationManager.transactional(() -&gt; {</span>
<span class="fc" id="L224">                Either&lt;String, UUID&gt; maybeMedication = medicationManager.addMedication(loggedInEHRRequestContext, m);</span>
<span class="fc" id="L225">                maybeMedication.peekLeft(this::handleExcludedDataPoint);</span>
<span class="fc" id="L226">                maybeMedication.peek(uniqueId -&gt; logActivity(patientId, Activity.Action.ADDED_MEDICATION_RECORD, m.getMedication().getDisplayText(), m));</span>
<span class="fc" id="L227">            }));</span>
        }
<span class="fc" id="L229">        messageWebBean.removeAttachmentsFromSession(session);</span>

<span class="fc" id="L231">        return Action.SUCCESS;</span>
    }

    public boolean isEditMode() {
<span class="pc bpc" id="L235" title="1 of 4 branches missed.">        return (medicationId != null) &amp;&amp; (medicationId != 0);</span>
    }

    private List&lt;Medication&gt; populateMedications() {
<span class="fc" id="L239">        List&lt;Medication&gt; medications = new LinkedList&lt;&gt;();</span>

<span class="fc" id="L241">        EHRRequestContext requestContext = getEHRRequestContext();</span>
<span class="fc bfc" id="L242" title="All 2 branches covered.">        for (MedicationInputDto inputDto : inputDtos) {</span>
<span class="fc" id="L243">            Medication medication = new Medication(new SourceDetails(requestContext));</span>
<span class="fc" id="L244">            populateMedication(medication, inputDto);</span>
<span class="fc" id="L245">            fillPrivacyFlagIn(medication);</span>
<span class="fc" id="L246">            medications.add(medication);</span>
<span class="fc" id="L247">        }</span>

<span class="fc" id="L249">        return medications;</span>
    }

    private void populateMedication(Medication medication, MedicationInputDto dto) {
<span class="fc" id="L253">        medication.setPatientLdapUID(patientId);</span>
<span class="fc" id="L254">        medication.setPatientAccountId(patientAccountId);</span>
<span class="fc" id="L255">        medication.setMedication(new CodeableConcept.Builder(dto.getDescription()).build());</span>
<span class="fc" id="L256">        medication.setAttachments(attachments);</span>

<span class="fc bfc" id="L258" title="All 2 branches covered.">        if (isNotBlank(dto.getFrequencyCode())) {</span>
<span class="fc" id="L259">            PKBMedicationFrequency freqFromCode = PKBMedicationFrequency.getFromCode(dto.getFrequencyCode());</span>
<span class="fc" id="L260">            medication.setFrequency(freqFromCode);</span>
<span class="fc bfc" id="L261" title="All 2 branches covered.">        } else if (isNotBlank(dto.getFrequencyFreetext())) {</span>
<span class="fc" id="L262">            medication.setFrequency(null);</span>
<span class="fc" id="L263">            medication.setFrequencyDisplayStr(dto.getFrequencyFreetext());</span>
        } else {
<span class="fc" id="L265">            medication.setFrequency(null);</span>
<span class="fc" id="L266">            medication.setFrequencyDisplayStr(null);</span>
        }

        // from webapp , the data will be positive
        // the data entered will mean patient is on medication
        // negative data will have a different view
<span class="fc" id="L272">        medication.setPatientOnMedication(Boolean.TRUE);</span>

<span class="fc" id="L274">        DateTimeFormatter format = getGlobalDateInputFormatter();</span>

<span class="fc bfc" id="L276" title="All 2 branches covered.">        if (isNotBlank(dto.getStartDate())) {</span>
<span class="fc" id="L277">            medication.setStartDate(Date.from(parseToInstantWithFormatter(dto.getStartDate().trim(), format)));</span>
        }
        else {
<span class="fc" id="L280">            medication.setStartDate(null);</span>
        }
<span class="fc bfc" id="L282" title="All 2 branches covered.">        if (isNotBlank(dto.getEndDate())) {</span>
<span class="fc" id="L283">            medication.setEndDate(Date.from(parseToInstantWithFormatter(dto.getEndDate().trim(), format)));</span>
        } else {
<span class="fc" id="L285">            medication.setEndDate(null);</span>
        }

<span class="fc" id="L288">        medication.setInstructions(dto.getInstruction());</span>
<span class="fc bfc" id="L289" title="All 2 branches covered.">        if (dto.getDoseUnitsId() != null) {</span>
<span class="fc" id="L290">            medication.setDoseUnitPkbId(dto.getDoseUnitsId());</span>
<span class="fc bfc" id="L291" title="All 2 branches covered.">        } else if (isNotBlank(dto.getDoseUnitsFreetext())) {</span>
<span class="fc" id="L292">            medication.setDoseUnitPkbId(null);</span>
<span class="fc" id="L293">            medication.setDoseUnit(new CodeableConcept.Builder(dto.getDoseUnitsFreetext()).build());</span>
        } else {
<span class="fc" id="L295">            medication.setDoseUnit(null);</span>
<span class="fc" id="L296">            medication.setDoseUnitPkbId(null);</span>
        }

<span class="fc bfc" id="L299" title="All 2 branches covered.">        if (isNotBlank(dto.getDoseValue())) {</span>
<span class="fc" id="L300">            medication.setDoseValue(Double.parseDouble(dto.getDoseValue().trim()));</span>
        } else {
<span class="fc" id="L302">            medication.setDoseValue(null);</span>
        }
<span class="fc" id="L304">    }</span>

    private void populateAttachmentsFromSession() {
<span class="fc" id="L307">        populateAttachments(messageWebBean.getAttachmentsFromSession(session));</span>
<span class="fc" id="L308">    }</span>

    private void populateAttachmentsFromDB(LoggedInEHRRequestContext context, Long medicationId) {
<span class="fc" id="L311">        populateAttachments(medicationManager.getMedicationAttachmentsWithoutContents(context, medicationId));</span>
<span class="fc" id="L312">    }</span>

    private void populateAttachments(List&lt;Attachment&gt; attachments) {
<span class="fc bfc" id="L315" title="All 2 branches covered.">        if (isNotEmpty(attachments)) {</span>
<span class="fc" id="L316">            this.attachments.addAll(attachments);</span>
        }
<span class="fc" id="L318">    }</span>

    public String editPrivacyForm() {
<span class="fc" id="L321">        LoggedInEHRRequestContext loggedInEHRRequestContext = getLoggedInEHRRequestContext();</span>
<span class="fc" id="L322">        Medication medication = medicationWebBean.setMedicationUp(loggedInEHRRequestContext, loggedInUserUtil.getLoggedInUserPrimaryTeam(), dataPointId);</span>
<span class="fc" id="L323">        setUsersVariables();</span>
<span class="pc bpc" id="L324" title="1 of 2 branches missed.">        if (hasNotPermissionsToEditPrivacyLabels(medication, loggedInEHRRequestContext)) {</span>
<span class="nc" id="L325">            return CANCEL;</span>
        }
<span class="fc" id="L327">        fillPrivacyFlagsFrom(medication);</span>
<span class="fc" id="L328">        medications = List.of(medication);</span>
<span class="fc" id="L329">        return INPUT;</span>
    }

    @SkipValidation
    public String editPrivacySave() {
<span class="fc" id="L334">        var users = setUsersVariables();</span>
<span class="fc" id="L335">        LoggedInEHRRequestContext context = getLoggedInEHRRequestContext();</span>
<span class="fc" id="L336">        Medication medication = medicationWebBean.setMedicationUp(context, loggedInUserUtil.getLoggedInUserPrimaryTeam(), dataPointId);</span>
<span class="fc" id="L337">        medications = List.of(medication);</span>
<span class="pc bpc" id="L338" title="1 of 2 branches missed.">        if (hasNotPermissionsToEditPrivacyLabels(medication, users.loggedInUser(), loggedInUserUtil.getLoggedInUserPrimaryTeam())) {</span>
<span class="nc" id="L339">            return CANCEL;</span>
        }
<span class="fc" id="L341">        privacyService.handlePrivacyChange(medication, MenuDataType.medication, getNewFlag(), context, patientAccountId,</span>
<span class="fc" id="L342">                users.contextUser(), users.loggedInUser());</span>
<span class="fc" id="L343">        return SUCCESS;</span>
    }

    @SkipValidation
    public String editPrivacyCancel() {
<span class="fc" id="L348">        return CANCEL;</span>
    }

    public String cancel() {
<span class="fc" id="L352">        return removeAttachmentsAndCancel();</span>
    }

    private String removeAttachmentsAndCancel() {
<span class="fc" id="L356">        messageWebBean.removeAttachmentsFromSession(session);</span>
<span class="fc" id="L357">        return CANCEL;</span>
    }

    private void logActivity(long patientId, com.pkb.notification.entity.Activity.Action action, String description,
                             RequiresConsent consentRequired) {

        // Log the activity and notify the patient
<span class="fc" id="L364">        Map&lt;ActivityProperty, String&gt; actionProperties = new EnumMap&lt;&gt;(ActivityProperty.class);</span>
<span class="fc" id="L365">        actionProperties.put(ActivityProperty.MEDICATION_STATUS, MedicationStatus.ACTIVE.name());</span>
<span class="fc" id="L366">        actionProperties.put(ActivityProperty.MED_DESCRIPTION, description);</span>
<span class="fc" id="L367">        actionProperties.put(ActivityProperty.PATIENT_ID, Long.toString(patientId));</span>
<span class="fc bfc" id="L368" title="All 2 branches covered.">        actionProperties.put(ActivityProperty.MEDICATION_ID, medicationId == null ? &quot;&quot;</span>
<span class="fc" id="L369">                : medicationId.toString());</span>
<span class="pc bpc" id="L370" title="1 of 2 branches missed.">        actionProperties.put(ActivityProperty.DATA_POINT_ID, dataPointId == null ? &quot;&quot;</span>
<span class="nc" id="L371">                : dataPointId.toString());</span>
<span class="fc" id="L372">        logActivity(action, dateTimeService.now(), patientId, true, actionProperties, consentRequired);</span>
<span class="fc" id="L373">    }</span>

    public Map&lt;Long, String&gt; getMedicationUnits() {
<span class="fc" id="L376">        Map&lt;Long, String&gt; medicationUnits = MedicationUnit.stream()</span>
<span class="fc" id="L377">                .collect(Collectors.toMap(MedicationUnit::getId, it -&gt; getText(it.getTextKey())));</span>
        // Add an empty option
<span class="fc" id="L379">        medicationUnits.put(null, &quot;&quot;);</span>
<span class="fc" id="L380">        return medicationUnits;</span>
    }

    @Override
    public String getCustomStyle() {
<span class="fc" id="L385">        return MOBILE_OPTIMIZED_STYLE;</span>
    }

    public void setUserManager(UserManager userManager) {
<span class="fc" id="L389">        this.userManager = userManager;</span>
<span class="fc" id="L390">    }</span>

    public UserManager getUserManager() {
<span class="fc" id="L393">        return userManager;</span>
    }

    public void setMedicationManager(MedicationManager medicationManager) {
<span class="fc" id="L397">        this.medicationManager = medicationManager;</span>
<span class="fc" id="L398">    }</span>

    public MedicationManager getMedicationManager() {
<span class="fc" id="L401">        return medicationManager;</span>
    }

    public void setMedicationWebBean(IMedicationWebBean medicationWebBean) {
<span class="fc" id="L405">        this.medicationWebBean = medicationWebBean;</span>
<span class="fc" id="L406">    }</span>

    public IMedicationWebBean getMedicationWebBean() {
<span class="fc" id="L409">        return medicationWebBean;</span>
    }

    public Long getMedicationId() {
<span class="fc" id="L413">        return medicationId;</span>
    }

    public void setMedicationId(Long medicationId) {
<span class="fc" id="L417">        this.medicationId = medicationId;</span>
<span class="fc" id="L418">    }</span>

    public Long getDataPointId() {
<span class="fc" id="L421">        return dataPointId;</span>
    }

    public void setDataPointId(Long dataPointId) {
<span class="fc" id="L425">        this.dataPointId = dataPointId;</span>
<span class="fc" id="L426">    }</span>

    public List&lt;Medication&gt; getMedications() {
<span class="fc" id="L429">        return medications;</span>
    }

    public void setMedications(List&lt;Medication&gt; medications) {
<span class="fc" id="L433">        this.medications = medications;</span>
<span class="fc" id="L434">    }</span>

    public List&lt;PKBMedicationFrequency&gt; getFrequencies() {
<span class="fc" id="L437">        return frequencies;</span>
    }

    public void setFrequencies(List&lt;PKBMedicationFrequency&gt; frequencies) {
<span class="fc" id="L441">        this.frequencies = frequencies;</span>
<span class="fc" id="L442">    }</span>

    public UUID getUniqueId() {
<span class="fc" id="L445">        return uniqueId;</span>
    }

    public void setUniqueId(UUID uniqueId) {
<span class="fc" id="L449">        this.uniqueId = uniqueId;</span>
<span class="fc" id="L450">    }</span>

    public Long getPatientId() {
<span class="fc" id="L453">        return patientId;</span>
    }

    public void setPatientId(Long patientId) {
<span class="fc" id="L457">        this.patientId = patientId;</span>
<span class="fc" id="L458">    }</span>

    public Long getPatientAccountId() {
<span class="fc" id="L461">        return patientAccountId;</span>
    }

    public void setPatientAccountId(Long patientAccountId) {
<span class="fc" id="L465">        this.patientAccountId = patientAccountId;</span>
<span class="fc" id="L466">    }</span>

    public String getTab() {
<span class="fc" id="L469">        return tab;</span>
    }

    public void setTab(String tab) {
<span class="fc" id="L473">        this.tab = tab;</span>
<span class="fc" id="L474">    }</span>

    public String getSubTab() {
<span class="fc" id="L477">        return subTab;</span>
    }

    public void setSubTab(String subTab) {
<span class="fc" id="L481">        this.subTab = subTab;</span>
<span class="fc" id="L482">    }</span>

    public List&lt;MedicationInputDto&gt; getInputDtos() {
<span class="fc" id="L485">        return inputDtos;</span>
    }

    public void setInputDtos(List&lt;MedicationInputDto&gt; inputDtos) {
<span class="fc" id="L489">        this.inputDtos = inputDtos;</span>
<span class="fc" id="L490">    }</span>

    @Override
    public String getNamespace() {
<span class="fc" id="L494">        return NAMESPACE_AUTH;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>