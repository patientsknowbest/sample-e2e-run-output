<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Issues.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">E2E Tests Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.pkb.api.fhir.util</a> &gt; <span class="el_source">Issues.java</span></div><h1>Issues.java</h1><pre class="source lang-java linenums">package com.pkb.api.fhir.util;

import io.vavr.collection.List;
import io.vavr.collection.Seq;
import org.hl7.fhir.dstu3.model.OperationOutcome.IssueSeverity;
import org.hl7.fhir.dstu3.model.OperationOutcome.IssueType;
import org.hl7.fhir.dstu3.model.OperationOutcome.OperationOutcomeIssueComponent;

import javax.annotation.CheckReturnValue;

import static io.vavr.API.List;
import static java.util.stream.Collectors.joining;
import static org.hl7.fhir.dstu3.model.OperationOutcome.IssueType.PROCESSING;

public class Issues {
    private List&lt;OperationOutcomeIssueComponent&gt; issues;

<span class="fc" id="L18">    private Issues(List&lt;OperationOutcomeIssueComponent&gt; issues) {</span>
<span class="fc" id="L19">        this.issues = issues;</span>
<span class="fc" id="L20">    }</span>

    public static Issues empty() {
<span class="fc" id="L23">        return new Issues(List());</span>
    }

    /**
     * Combines issues without filtering.
     */
    public static Issues combine(Seq&lt;Issues&gt; issuesSeq) {
<span class="nc" id="L30">        return issuesSeq.foldLeft(Issues.empty(), (i, a) -&gt; a.add(i));</span>
    }
    
    /**
     * Combines issues, stripping any with the same diagnostics
     */
    public static Issues flatten(Seq&lt;Issues&gt; issuesList) {
<span class="fc" id="L37">        return issuesList.foldLeft(empty(), (combinedIssues, issues) -&gt;</span>
<span class="fc bfc" id="L38" title="All 2 branches covered.">                combinedIssues.add(new Issues((issues.issues.filter(i -&gt; !combinedIssues.containsSameDiagnostics(i))))));</span>
    }

    public static Issues of(java.util.List&lt;OperationOutcomeIssueComponent&gt; issues) {
<span class="nc" id="L42">        return new Issues(List.ofAll(issues.stream().map(OperationOutcomeIssueComponent::copy)));</span>
    }

    public static Issues of(List&lt;OperationOutcomeIssueComponent&gt; issues) {
<span class="fc" id="L46">        return new Issues(issues.map(OperationOutcomeIssueComponent::copy));</span>
    }

    public static Issues errorFrom(String diagnostics, IssueType issueType) {
<span class="fc" id="L50">        return empty().add(diagnostics, issueType, IssueSeverity.ERROR);</span>
    }

    public static Issues errorFrom(String diagnostics) {
<span class="fc" id="L54">        return empty().add(diagnostics, IssueSeverity.ERROR);</span>
    }

    public static Issues issueFrom(String diagnostics, IssueSeverity severity) {
<span class="fc" id="L58">        return empty().add(diagnostics, severity);</span>
    }
    
    @CheckReturnValue
    public Issues add(OperationOutcomeIssueComponent issue) {
<span class="fc" id="L63">        return new Issues(issues.append(issue.copy()));</span>
    }

    @CheckReturnValue
    public Issues add(String diagnostics, IssueSeverity severity) {
<span class="fc" id="L68">        return add(diagnostics, PROCESSING, severity);</span>
    }

    @CheckReturnValue
    public Issues add(String diagnostics, IssueType issueType, IssueSeverity severity) {
<span class="fc" id="L73">        return add(new OperationOutcomeIssueComponent()</span>
<span class="fc" id="L74">                .setSeverity(severity)</span>
<span class="fc" id="L75">                .setCode(issueType)</span>
<span class="fc" id="L76">                .setDiagnostics(diagnostics));</span>
    }

    @CheckReturnValue
    public Issues add(Issues other) {
<span class="fc" id="L81">        return new Issues(this.issues.appendAll(other.issues));</span>
    }
    
    private boolean containsSameDiagnostics(OperationOutcomeIssueComponent issue) {
<span class="fc" id="L85">        return issues.find(i -&gt; i.getDiagnostics().equals(issue.getDiagnostics())).isDefined();</span>
    }

    public final List&lt;OperationOutcomeIssueComponent&gt; get() {
<span class="fc" id="L89">        return issues.map(OperationOutcomeIssueComponent::copy);</span>
    }

    public boolean isEmpty() {
<span class="fc" id="L93">        return issues.isEmpty();</span>
    }

    @Override
    public String toString() {
<span class="fc" id="L98">        return issues.map(OperationOutcomeIssueComponent::getDiagnostics).collect(joining(&quot;, &quot;));</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>