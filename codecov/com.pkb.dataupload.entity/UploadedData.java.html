<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UploadedData.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">E2E Tests Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.pkb.dataupload.entity</a> &gt; <span class="el_source">UploadedData.java</span></div><h1>UploadedData.java</h1><pre class="source lang-java linenums">//------------------------------------------------------------------------------
//
// Copyright (c) 2011 PatientsKnowBest, Inc. All Rights Reserved.
//
// $Id: $
//
//------------------------------------------------------------------------------

package com.pkb.dataupload.entity;

import com.pkb.entities.enums.HL7MessageType;
import com.pkb.entities.enums.Route;
import com.pkb.institute.entity.Org;
import com.pkb.institute.entity.Team;
import org.hibernate.annotations.Cache;
import org.hibernate.annotations.CacheConcurrencyStrategy;
import org.hibernate.annotations.DynamicInsert;
import org.hibernate.annotations.Type;

import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.EnumType;
import javax.persistence.Enumerated;
import javax.persistence.FetchType;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.ManyToOne;
import javax.persistence.Table;
import javax.persistence.Temporal;
import javax.persistence.TemporalType;
import javax.persistence.Version;
import java.io.Serializable;
import java.util.Date;
import java.util.UUID;

/**
 * Data uploaded to a patient's account is stored here after validation (as status NEW).
 * When possible (with test results: when a user with access requests test results) the data
 * is added to the patient's account and the queue entry status is changed to COMPLETED.
 *
 * @author robwhelan
 */
@Entity
@DynamicInsert
@Cache(usage = CacheConcurrencyStrategy.NONSTRICT_READ_WRITE)
@Table
<span class="fc" id="L48">public class UploadedData implements Serializable {</span>

    private static final long serialVersionUID = 1L;

<span class="fc" id="L52">    public enum Destination {</span>
<span class="fc" id="L53">        TEST_RESULT, RADIOLOGY, PATIENT_INFO_UPDATE, PATIENT_ADD, ALLERGY_UPDATE, DIAGNOSIS_UPDATE, MEDICATION_UPDATE, SYMPTOM_UPDATE,</span>
<span class="fc" id="L54">        PHPLAN, MEDICAL_RECORDS, CORE_DEVICES, DEVICE_MEASUREMENTS, DEVICE_NOTIFICATION, DEVICE_DOWNLOAD, MEASUREMENT, DOCUMENT,</span>
<span class="fc" id="L55">        APPOINTMENT, ENCOUNTER, UNCATEGORISED_OBSERVATION</span>
    }

<span class="fc" id="L58">    public enum Format {</span>
<span class="fc" id="L59">        HL7(Route.HL7_API),</span>
<span class="fc" id="L60">        JSON_VALIDIC(Route.CORE_DEVICES),</span>
<span class="fc" id="L61">        XML_EMIS(Route.WEBAPP), // EMIS XML export uploaded via webapp</span>
<span class="fc" id="L62">        XML_SCISTORE(Route.SCISTORE),</span>
<span class="fc" id="L63">        FHIR_API(Route.FHIR_API);</span>

        private Route routeAssociated;

<span class="fc" id="L67">        Format(Route routeAssociated) {</span>
<span class="fc" id="L68">            this.routeAssociated = routeAssociated;</span>
<span class="fc" id="L69">        }</span>

        public Route getRouteAssociated() {
<span class="fc" id="L72">            return routeAssociated;</span>
        }
    }

<span class="fc" id="L76">    public enum Status {</span>
        /** Data is currently being processed. */
<span class="fc" id="L78">        IN_PROGRESS,</span>
        /** Data is ready for processing. */
<span class="fc" id="L80">        NEW,</span>
        /** Data has been processed successfully. */
<span class="fc" id="L82">        COMPLETED,</span>
        /** ??? */
<span class="fc" id="L84">        OBSOLETE,</span>
        /** Soft demographics check failed. Messages in this state can be managed by an Organisation Administrator. */
<span class="fc" id="L86">        PATIENT_INFO_MISMATCH,</span>
        /**
         * Messages in this state have been identified as containing data for the wrong patient. The typical workflow is
         * when a message is first placed into the PATIENT_INFO_MISMATCH state before being manually rejected by an
         * Organisation Administrator (see: https://manual.patientsknowbest.com/organisation-administrator).
         * Alternatively, the message might have been moved directly into this state as a result of smart soft-matching.
         */
<span class="fc" id="L93">        REJECTED,</span>
        /** Data has been processed but the whole data or part of it was not mappable (data contained unknown field). */
<span class="fc" id="L95">        COMPLETED_UNMAPPED,</span>
        /**
         * An unknown error occurred whilst trying to process the message. This should never happen.
         * Addtionally, ACTIVE entries were migrated to the ERROR state. See PHR-5222, PHR-9569.
         */
<span class="fc" id="L100">        ERROR,</span>
        /**
         * There are other messages for this external message ID already queued (this means in state
         * PATIENT_INFO_MISMATCH). This status will soon be removed, see PHR-5237.
         */
<span class="fc" id="L105">        PREVIOUS_DATA_QUEUED</span>
    }

    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Long id;

    @Version
    @Column
    private Long version;

    @ManyToOne(fetch = FetchType.LAZY)
    private Org sourceOrg;

    @ManyToOne(fetch = FetchType.LAZY)
    private Org connectingOrg;

    @Column(name = &quot;hl7partner_id&quot;)
    private Long hl7PartnerId;

    @ManyToOne(fetch = FetchType.LAZY)
    private Team sourceTeam;

    @Column(name = &quot;person_id&quot;)
    private Long personId;

    @Column(length = 32)
    @Enumerated(EnumType.STRING)
    private Destination destination;

    @Column(length = 32)
    @Enumerated(EnumType.STRING)
    private Format format;

    @Column(length = 256)
    private String embeddedId;

    @Column(length = 256)
    private String externalMessageId;

    @Type(type = &quot;pg-uuid&quot;)
    @Column(name = &quot;document_metadata_id&quot;)
    private UUID documentMetadataId;

    @Column(length = 32)
    @Enumerated(EnumType.STRING)
    private Status status;

    @Temporal(TemporalType.TIMESTAMP)
    @Column
    private Date created;

    @Temporal(TemporalType.TIMESTAMP)
    @Column
    private Date edited;

    @Column
    private Long updateTo;

    @Column
    private Long subsetOfParentId;

    @Column(columnDefinition = &quot;TEXT&quot;)
    private String destinationSpecificData;

    @Column(columnDefinition = &quot;TEXT&quot;)
    private String patientInfoMismatchXml;

    @Column(name = &quot;hl7_message_type&quot;)
    @Enumerated(EnumType.STRING)
    @Type(type = &quot;com.vladmihalcea.hibernate.type.basic.PostgreSQLEnumType&quot;)
    private HL7MessageType hl7MessageType;

    @Column(name=&quot;responsibleorganisationidentifier&quot;, columnDefinition = &quot;TEXT&quot;)
    private String responsibleOrganisationIdentifier;

    public Long getId() {
<span class="fc" id="L182">        return id;</span>
    }

    public void setId(Long id) {
<span class="nc" id="L186">        this.id = id;</span>
<span class="nc" id="L187">    }</span>

    public Destination getDestination() {
<span class="fc" id="L190">        return destination;</span>
    }

    public void setDestination(Destination destination) {
<span class="fc" id="L194">        this.destination = destination;</span>
<span class="fc" id="L195">    }</span>

    public UUID getDocumentMetadataId() {
<span class="fc" id="L198">        return documentMetadataId;</span>
    }

    public void setDocumentMetadataId(UUID documentMetadataId) {
<span class="fc" id="L202">        this.documentMetadataId = documentMetadataId;</span>
<span class="fc" id="L203">    }</span>

    /**
     * Valid values for a status here: NEW/ACTIVE/COMPLETED/PATIENT_INFO_MISMATCH
     *
     * @param status
     */
    public Status getStatus() {
<span class="fc" id="L211">        return status;</span>
    }

    /**
     * Valid values for a status here: NEW/ACTIVE/COMPLETED/PATIENT_INFO_MISMATCH
     *
     * @param status
     */
    public void setStatus(Status status) {
<span class="fc" id="L220">        this.status = status;</span>
<span class="fc" id="L221">    }</span>

    public Format getFormat() {
<span class="fc" id="L224">        return format;</span>
    }

    public void setFormat(Format format) {
<span class="fc" id="L228">        this.format = format;</span>
<span class="fc" id="L229">    }</span>

    public String getEmbeddedId() {
<span class="fc" id="L232">        return embeddedId;</span>
    }

    public void setEmbeddedId(String embeddedId) {
<span class="fc" id="L236">        this.embeddedId = embeddedId;</span>
<span class="fc" id="L237">    }</span>

    public String getExternalMessageId() {
<span class="fc" id="L240">        return externalMessageId;</span>
    }

    public void setExternalMessageId(String externalMessageId) {
<span class="fc" id="L244">        this.externalMessageId = externalMessageId;</span>
<span class="fc" id="L245">    }</span>

    public Org getSourceOrg() {
<span class="fc" id="L248">        return sourceOrg;</span>
    }

    public void setSourceOrg(Org sourceOrg) {
<span class="fc" id="L252">        this.sourceOrg = sourceOrg;</span>
<span class="fc" id="L253">    }</span>

    public Org getConnectingOrg() {
<span class="fc" id="L256">        return connectingOrg;</span>
    }

    public void setConnectingOrg(Org connectingOrg) {
<span class="fc" id="L260">        this.connectingOrg = connectingOrg;</span>
<span class="fc" id="L261">    }</span>

    public Team getSourceTeam() {
<span class="fc" id="L264">        return sourceTeam;</span>
    }

    public void setSourceTeam(Team sourceTeam) {
<span class="fc" id="L268">        this.sourceTeam = sourceTeam;</span>
<span class="fc" id="L269">    }</span>

    public Date getCreated() {
<span class="fc" id="L272">        return created;</span>
    }

    public void setCreated(Date created) {
<span class="fc" id="L276">        this.created = created;</span>
<span class="fc" id="L277">    }</span>

    public Date getEdited() {
<span class="nc" id="L280">        return edited;</span>
    }

    public void setEdited(Date edited) {
<span class="fc" id="L284">        this.edited = edited;</span>
<span class="fc" id="L285">    }</span>

    public Long getUpdateTo() {
<span class="fc" id="L288">        return updateTo;</span>
    }

    public void setUpdateTo(Long updateTo) {
<span class="fc" id="L292">        this.updateTo = updateTo;</span>
<span class="fc" id="L293">    }</span>

    public Long getSubsetOfParentId() {
<span class="fc" id="L296">        return subsetOfParentId;</span>
    }

    public void setSubsetOfParentId(Long subsetOfParentId) {
<span class="fc" id="L300">        this.subsetOfParentId = subsetOfParentId;</span>
<span class="fc" id="L301">    }</span>

    public String getDestinationSpecificData() {
<span class="nc" id="L304">        return destinationSpecificData;</span>
    }

    public void setDestinationSpecificData(String destinationSpecificData) {
<span class="fc" id="L308">        this.destinationSpecificData = destinationSpecificData;</span>
<span class="fc" id="L309">    }</span>

    public String getPatientInfoMismatchXml() {
<span class="fc" id="L312">        return patientInfoMismatchXml;</span>
    }

    public void setPatientInfoMismatchXml(String patientInfoMismatchXml) {
<span class="fc" id="L316">        this.patientInfoMismatchXml = patientInfoMismatchXml;</span>
<span class="fc" id="L317">    }</span>

    public Long getVersion() {
<span class="fc" id="L320">        return version;</span>
    }

    public void setVersion(Long version) {
<span class="fc" id="L324">        this.version = version;</span>
<span class="fc" id="L325">    }</span>

    public Long getHl7PartnerId() {
<span class="fc" id="L328">        return hl7PartnerId;</span>
    }

    public void setHl7PartnerId(Long hl7PartnerId) {
<span class="fc" id="L332">        this.hl7PartnerId = hl7PartnerId;</span>
<span class="fc" id="L333">    }</span>

    public HL7MessageType getHl7MessageType() {
<span class="fc" id="L336">        return hl7MessageType;</span>
    }

    public void setHl7MessageType(HL7MessageType hl7MessageType) {
<span class="fc" id="L340">        this.hl7MessageType = hl7MessageType;</span>
<span class="fc" id="L341">    }</span>

    public Long getPersonId() {
<span class="fc" id="L344">        return personId;</span>
    }

    public void setPersonId(Long personId) {
<span class="fc" id="L348">        this.personId = personId;</span>
<span class="fc" id="L349">    }</span>

<span class="fc" id="L351">    public String getResponsibleOrganisationIdentifier() { return responsibleOrganisationIdentifier; }</span>

    public void setResponsibleOrganisationIdentifier(String responsibleOrganisationIdentifier) {
<span class="fc" id="L354">        this.responsibleOrganisationIdentifier = responsibleOrganisationIdentifier;</span>
<span class="fc" id="L355">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>