<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Kms.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">E2E Tests Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.pkb.kms.client.core</a> &gt; <span class="el_source">Kms.kt</span></div><h1>Kms.kt</h1><pre class="source lang-java linenums">package com.pkb.kms.client.core

import com.pkb.crypto.dto.AccountKeysDTO
import com.pkb.crypto.dto.AccountSymmetricKeyDTO
import com.pkb.crypto.dto.DplKeyDTO
import com.pkb.crypto.dto.UserPrivateKeyDTO
import com.pkb.entities.enums.SSOType
import com.pkb.kms.shared.representation.AccountIds
import com.pkb.kms.shared.representation.AccountKeyAvailability
import com.pkb.kms.shared.representation.AccountPrivateId
import com.pkb.kms.shared.representation.AccountPublicId
import com.pkb.kms.shared.representation.DplKeyId
import com.pkb.kms.shared.representation.DplKeyRequest
import com.pkb.kms.shared.representation.EncryptionRequest
import com.pkb.kms.shared.representation.EncryptionResponse
import com.pkb.kms.shared.representation.GrantUserAccessToAccountRequest
import com.pkb.kms.shared.representation.KmsError
import com.pkb.kms.shared.representation.LoginRequest
import com.pkb.kms.shared.representation.NhsLoginRequest
import com.pkb.kms.shared.representation.OrgPublicId
import com.pkb.kms.shared.representation.PersonPublicId
import com.pkb.kms.shared.representation.SSOLoginRequest
import com.pkb.kms.shared.representation.SsoCredentialsCreateRequest
import com.pkb.kms.shared.representation.SymmetricKeyRequest
import com.pkb.kms.shared.representation.TeamPublicId
import io.vavr.control.Either

/**
 * The interface to the KMS.
 */
@Suppress(&quot;unused&quot;)
interface Kms {

    fun login(requestId: String?, request: LoginRequest): Either&lt;KmsError, Void&gt;

    fun nhsLogin(requestId: String?, request: NhsLoginRequest): Either&lt;KmsError, UserPrivateKeyDTO&gt;

    fun ssoLogin(requestId: String?, request: SSOLoginRequest): Either&lt;KmsError, UserPrivateKeyDTO&gt;

    fun addNhsLoginCredentials(requestId: String?, request: NhsLoginRequest): Either&lt;KmsError, Void&gt;

    fun expireNhsLoginCredentials(requestId: String?, personPublicIds: List&lt;PersonPublicId&gt;): Either&lt;KmsError, Void&gt;

    fun addExternalCredentialRecovery(requestId: String?,
                                      personPublicId: PersonPublicId): Either&lt;KmsError, Void&gt;

    fun recoverCredentials(requestId: String?,
                           personPublicId: PersonPublicId): Either&lt;KmsError, UserPrivateKeyDTO&gt;

    fun expireExternalCredentialRecovery(requestId: String?,
                                         personPublicId: PersonPublicId): Either&lt;KmsError, Void&gt;

    fun createSSOCredential(requestId: String?, ssoCredentialsCreateRequest: SsoCredentialsCreateRequest): Either&lt;KmsError, Void&gt;
    fun createSSOAuthRecord(requestId: String?, ssoCredentialsCreateRequest: SsoCredentialsCreateRequest): Either&lt;KmsError, Void&gt;

    fun ssoAuthRecordExists(requestId: String?, personPublicId: PersonPublicId, ssoType: SSOType): Either&lt;KmsError, Boolean&gt;

    fun getSSOCredentialStatus(requestId: String?, personPublicId: PersonPublicId): Either&lt;KmsError, Set&lt;SSOType&gt;&gt;

    fun emisKeyValid(requestId: String?, personPublicId: PersonPublicId, passwordHash: String): Either&lt;KmsError, Boolean&gt;

    fun getAccountKeys(requestId: String?,
                       accountPublicIds: List&lt;AccountPublicId&gt;,
                       personPublicId: PersonPublicId,
                       forceReload: Boolean): Either&lt;KmsError, List&lt;AccountKeysDTO&gt;&gt;

    fun getAccountKeysAsOrg(requestId: String?,
                            accountPublicIds: List&lt;AccountPublicId&gt;,
                            orgPublicId: OrgPublicId,
                            forceReload: Boolean): Either&lt;KmsError, List&lt;AccountKeysDTO&gt;&gt;

    fun getAccountKeysTrusted(requestId: String?, accountPublicIds: List&lt;AccountPublicId&gt;)
            : Either&lt;KmsError, List&lt;AccountKeysDTO&gt;&gt;

    fun getAccountKeysTrustedIgnoreMissing(requestId: String?, accountPublicIds: List&lt;AccountPublicId&gt;)
            : Either&lt;KmsError, List&lt;AccountKeysDTO&gt;&gt;

    fun evictUserKeys(requestId: String?, personPublicId: PersonPublicId): Either&lt;KmsError, Void&gt;

    fun evictOrgKeys(requestId: String?, orgId: Long): Either&lt;KmsError, Void&gt;

    fun evictAccountKeys(requestId: String?, accountPublicId: AccountPublicId): Either&lt;KmsError, Void&gt;

    fun evictAccountKeys(requestId: String?,
                         accountPublicId: AccountPublicId,
                         includeUnauthenticatedKey: Boolean): Either&lt;KmsError, Void&gt;

    fun evictKeys(requestId: String?): Either&lt;KmsError, Void&gt;

    fun generateSymmetricKey(requestID: String?,
                             accountPublicId: SymmetricKeyRequest): Either&lt;KmsError, AccountSymmetricKeyDTO&gt;

    fun getSymmetricKeys(requestID: String?,
                         accountPublicIds: Collection&lt;AccountPublicId&gt;): Either&lt;KmsError, Map&lt;AccountPublicId, AccountSymmetricKeyDTO&gt;&gt;

    fun getSymmetricKey(requestID: String?,
                        accountPublicId: AccountPublicId): Either&lt;KmsError, AccountSymmetricKeyDTO&gt; =
<span class="fc" id="L98">        getSymmetricKeys(requestID, listOf(accountPublicId))</span>
<span class="fc" id="L99">                .map { it[accountPublicId] }</span>

    fun getAccountKeyCacheStatus(requestID: String?,
                                 accountPublicIds: List&lt;AccountPublicId&gt;): Either&lt;KmsError, List&lt;AccountPublicId&gt;&gt;


    fun checkAccountKeyAvailabilityForUser(requestId: String?, personPublicId: PersonPublicId): Either&lt;KmsError, AccountKeyAvailability&gt;

    /**
     * Additional functions to make some of the API a bit cleaner where arguments require preprocessing
     * e.g. correctly concatenate or wrap them to a list.
     */
    fun getAccountKeysForSingleAccount(requestId: String?,
                                       accountPublicId: AccountPublicId,
                                       personPublicId: PersonPublicId,
                                       forceReload: Boolean): Either&lt;KmsError, AccountKeysDTO&gt; =
<span class="fc" id="L115">        getAccountKeys(requestId, listOf(accountPublicId), personPublicId, forceReload)</span>
<span class="fc" id="L116">                .map { it.first() }</span>


    fun getAccountKeysForSingleAccountAsOrg(
        requestId: String?,
        accountPublicId: AccountPublicId,
        orgPublicId: OrgPublicId,
        forceReload: Boolean
    ): Either&lt;KmsError, AccountKeysDTO&gt; =
<span class="fc" id="L125">        getAccountKeysAsOrg(requestId, listOf(accountPublicId), orgPublicId, forceReload)</span>
<span class="fc" id="L126">            .map { it.first() }</span>

    fun expireNhsLoginCredentials(requestId: String?, personPublicId: PersonPublicId) =
<span class="fc" id="L129">        expireNhsLoginCredentials(requestId, listOf(personPublicId))</span>

    fun getOrgAccountKeysCacheStatus(requestID: String): Either&lt;KmsError, List&lt;Long&gt;&gt;

    fun getUserPrivateKeyCacheStatus(
        requestID: String?,
        personPublicIDs: List&lt;PersonPublicId&gt;
    ): Either&lt;KmsError, List&lt;PersonPublicId&gt;&gt;

    fun userKeyExists(
        requestID: String?,
        personPublicID: PersonPublicId
    ): Either&lt;KmsError, Boolean&gt;

    fun getUserPrivateKeyTrusted(
        requestID: String?,
        personPublicID: PersonPublicId
    ): Either&lt;KmsError, UserPrivateKeyDTO&gt;

    fun encrypt(requestId: String?, request: EncryptionRequest): Either&lt;KmsError, EncryptionResponse&gt;

    fun grantAccessToAccountOwner(requestId: String?, request: GrantUserAccessToAccountRequest): Either&lt;KmsError, Void&gt;

    fun grantAccessToAccountTrusted(requestId: String?, request: GrantUserAccessToAccountRequest): Either&lt;KmsError, Void&gt;

    fun revokeAccessToAccountTrusted(requestId: String?, accountPublicId: AccountPublicId, personPublicId: PersonPublicId): Either&lt;KmsError, Void&gt;

    fun grantOrgAccess(requestId: String?, accountPublicId: AccountPublicId, orgPublicId: OrgPublicId): Either&lt;KmsError, Void&gt;

    fun grantOrgAccessMultiple(requestId: String?, accountPublicIds: List&lt;AccountPublicId&gt;, orgPublicId: OrgPublicId): Either&lt;KmsError, List&lt;AccountPublicId&gt;&gt;

    fun createDplKey(requestId: String?, dplKeyRequest: DplKeyRequest): Either&lt;KmsError, DplKeyDTO&gt;

    fun getDplKeysForUser(requestId: String?, keyIds: List&lt;DplKeyId&gt;, requesterPersonId: PersonPublicId, targetPersonId: PersonPublicId): Either&lt;KmsError, List&lt;DplKeyDTO&gt;&gt;

    fun getDplKeysForUserAsOrg(requestId: String?, keyIds: List&lt;DplKeyId&gt;, requesterOrgId: OrgPublicId, targetPersonId: PersonPublicId): Either&lt;KmsError, List&lt;DplKeyDTO&gt;&gt;

    fun getDplKeysForTeam(requestId: String?, keyIds: List&lt;DplKeyId&gt;, requesterPersonId: PersonPublicId, targetTeamId: TeamPublicId): Either&lt;KmsError, List&lt;DplKeyDTO&gt;&gt;

    fun getDplKeysForTeamAsOrg(requestId: String?, keyIds: List&lt;DplKeyId&gt;, requesterOrgId: OrgPublicId, targetTeamId: TeamPublicId): Either&lt;KmsError, List&lt;DplKeyDTO&gt;&gt;

    fun createAccountAndGrantOrgAccess(requestId: String?, orgPublicId: OrgPublicId): Either&lt;KmsError, AccountIds&gt;

    fun createAccount(requestId: String?): Either&lt;KmsError, AccountIds&gt;

    @Suppress(&quot;FunctionName&quot;)
    fun TEST_ONLY_getAccountKeyCacheStatus(requestId: String?,
                                           accountPublicIds: List&lt;AccountPublicId&gt;): Either&lt;KmsError, Map&lt;String, Set&lt;AccountPublicId&gt;&gt;&gt;

    @Suppress(&quot;FunctionName&quot;)
    fun TEST_ONLY_getAccountSymmetricKeyCacheStatus(requestId: String?,
                                                    accountPublicIds: List&lt;AccountPublicId&gt;): Either&lt;KmsError, Map&lt;String, Set&lt;AccountPublicId&gt;&gt;&gt;

    @Suppress(&quot;FunctionName&quot;)
    fun TEST_ONLY_getDplKeyCacheStatus(requestId: String?,
                                       dplKeyIds: List&lt;DplKeyId&gt;,
                                       accountPrivateId: AccountPrivateId): Either&lt;KmsError, List&lt;DplKeyId&gt;&gt;




}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>