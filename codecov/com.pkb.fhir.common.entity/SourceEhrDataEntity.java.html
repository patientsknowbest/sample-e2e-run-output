<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SourceEhrDataEntity.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">E2E Tests Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.pkb.fhir.common.entity</a> &gt; <span class="el_source">SourceEhrDataEntity.java</span></div><h1>SourceEhrDataEntity.java</h1><pre class="source lang-java linenums">package com.pkb.fhir.common.entity;

import com.pkb.entities.enums.MenuDataType;
import com.pkb.fhir.common.retrieve.AppointmentEhrDataDto;
import com.pkb.fhir.common.retrieve.ConditionEhrDataDto;
import org.hibernate.annotations.Formula;
import org.hibernate.annotations.Type;

import javax.persistence.Column;
import javax.persistence.ColumnResult;
import javax.persistence.ConstructorResult;
import javax.persistence.Entity;
import javax.persistence.Id;
import javax.persistence.NamedNativeQuery;
import javax.persistence.SqlResultSetMapping;
import javax.persistence.Table;
import java.time.LocalDateTime;
import java.util.UUID;

/**
 * This is a bit horrible.
 * This class exists as a pseudo-copy of AppMenuData so it can hold @NamedNativeQueries.
 * See {@link com.pkb.fhir.common.repository.SourceEhrDataRepository} for why these need to exist.
 */
@Entity
@Table(schema = &quot;app&quot;, name = &quot;menu_data&quot;)
@NamedNativeQuery(
        name = &quot;find_appointment_dto&quot;,
        query =
                &quot;SELECT  &quot; +
                        //Basic menu data concepts
                        &quot;md.id AS id, &quot; +
                        &quot;patient.public_id AS patientId, &quot; +
                        &quot;md.uniqueid AS uniqueId, &quot; +
                        //Appointment-specific fields
                        &quot;md.date01 AS start, &quot; +
                        &quot;md.date02 AS end, &quot; +
                        &quot;md.string01 as commonId, &quot; +
                        &quot;md.string02 as status, &quot; +
                        &quot;md.string03 as externalId, &quot; +
                        &quot;md.code01Code as typeCode, &quot; +
                        &quot;md.code01CodeSystem as typeCodingSystem, &quot; +
                        //menu_data source information
                        &quot;md.sourceorgid AS menuDataSourceOrgId, &quot; +
                        &quot;md.sourceteamid AS menuDataSourceTeamId, &quot; +
                        &quot;md.sourcepersonid AS menuDataSourcePersonId, &quot; +
                        &quot;md.entereddate AS created, &quot; +
                        &quot;md.persisteddate AS persistedDate, &quot; +
                        &quot;md.uploadeddataid AS uploadedDataId, &quot; +
                        &quot;md.hl7partnerid AS hl7PartnerId, &quot; +
                        &quot;md.route AS route, &quot; +
                        &quot;md.responsibleorganisationidentifier AS responsibleOrganisationIdentifier, &quot; +
                        //privacy_flags information
                        &quot;pf.source_person_id AS pfSourcePersonId, &quot; +
                        &quot;pf.source_team_id AS pfSourceTeamId, &quot; +
                        &quot;pf.source_org_id AS pfSourceOrgId, &quot; +
                        &quot;pf.access_route AS pfAccessRoute, &quot; +
                        &quot;pf.change_date AS pfChangeDate, &quot; +
                        &quot;CASE pf.require_general &quot; +
                        &quot;WHEN false THEN '' &quot; +
                        &quot;WHEN true THEN 'GENERAL_HEALTH' &quot; +
                        &quot;ELSE CASE WHEN md.requiregeneral THEN 'GENERAL_HEALTH' ELSE '' END END AS requireGeneral, &quot; +
                        &quot;CASE pf.require_sexual_health &quot; +
                        &quot;WHEN false THEN '' &quot; +
                        &quot;WHEN true THEN 'SEXUAL_HEALTH' &quot; +
                        &quot;ELSE CASE WHEN md.requiresexualhealth THEN 'SEXUAL_HEALTH' ELSE '' END END AS requireSexualHealth, &quot; +
                        &quot;CASE pf.require_mental_health &quot; +
                        &quot;WHEN false THEN '' &quot; +
                        &quot;WHEN true THEN 'MENTAL_HEALTH' &quot; +
                        &quot;ELSE CASE WHEN md.requirementalhealth THEN 'MENTAL_HEALTH' ELSE '' END END AS requireMentalHealth, &quot; +
                        &quot;CASE pf.require_social_care &quot; +
                        &quot;WHEN false THEN '' &quot; +
                        &quot;WHEN true THEN 'SOCIAL_CARE' &quot; +
                        &quot;ELSE CASE WHEN md.requiresocialcare THEN 'SOCIAL_CARE' ELSE '' END END AS requireSocialCare &quot; +
                        //The actual table joins
                        &quot;FROM app.menu_data md &quot; +
                        &quot;JOIN pkbperson patient ON md.account_id = patient.defaultaccountid &quot; +
                        &quot;LEFT OUTER JOIN privacy_flags pf ON md.uniqueid = pf.uniqueid AND pf.id = (SELECT pf2.id FROM privacy_flags pf2 WHERE md.uniqueid = pf2.uniqueid ORDER BY pf2.change_date DESC, pf2.id DESC LIMIT 1) &quot; +
                        &quot;WHERE md.id IN (:ids) &quot; +
                        &quot;ORDER BY id&quot;,
        resultSetMapping = &quot;appointment_dto&quot;
)
@SqlResultSetMapping(
        name = &quot;appointment_dto&quot;,
        classes = @ConstructorResult(
                targetClass = AppointmentEhrDataDto.class,
                columns = {
                        @ColumnResult(name = &quot;id&quot;, type = Long.class),
                        @ColumnResult(name = &quot;patientId&quot;, type = UUID.class),
                        @ColumnResult(name = &quot;uniqueId&quot;, type = UUID.class),
                        @ColumnResult(name = &quot;start&quot;, type = LocalDateTime.class),
                        @ColumnResult(name = &quot;end&quot;, type = LocalDateTime.class),
                        @ColumnResult(name = &quot;commonId&quot;, type = String.class),
                        @ColumnResult(name = &quot;status&quot;, type = String.class),
                        @ColumnResult(name = &quot;externalId&quot;, type = String.class),
                        @ColumnResult(name = &quot;typeCode&quot;, type = String.class),
                        @ColumnResult(name = &quot;typeCodingSystem&quot;, type = String.class),
                        @ColumnResult(name = &quot;menuDataSourceOrgId&quot;, type = Long.class),
                        @ColumnResult(name = &quot;menuDataSourceTeamId&quot;, type = Long.class),
                        @ColumnResult(name = &quot;menuDataSourcePersonId&quot;, type = Long.class),
                        @ColumnResult(name = &quot;created&quot;, type = LocalDateTime.class),
                        @ColumnResult(name = &quot;persistedDate&quot;, type = LocalDateTime.class),
                        @ColumnResult(name = &quot;uploadedDataId&quot;, type = Long.class),
                        @ColumnResult(name = &quot;hl7PartnerId&quot;, type = Long.class),
                        @ColumnResult(name = &quot;route&quot;, type = String.class),
                        @ColumnResult(name = &quot;responsibleOrganisationIdentifier&quot;, type = String.class),
                        @ColumnResult(name = &quot;pfSourcePersonId&quot;, type = Long.class),
                        @ColumnResult(name = &quot;pfSourceTeamId&quot;, type = Long.class),
                        @ColumnResult(name = &quot;pfSourceOrgId&quot;, type = Long.class),
                        @ColumnResult(name = &quot;pfAccessRoute&quot;, type = String.class),
                        @ColumnResult(name = &quot;pfChangeDate&quot;, type = LocalDateTime.class),
                        @ColumnResult(name = &quot;requireGeneral&quot;, type = String.class),
                        @ColumnResult(name = &quot;requireSexualHealth&quot;, type = String.class),
                        @ColumnResult(name = &quot;requireMentalHealth&quot;, type = String.class),
                        @ColumnResult(name = &quot;requireSocialCare&quot;, type = String.class)
                }
        )
)
@NamedNativeQuery(
        name = &quot;find_condition_dto&quot;,
        query =
                &quot;SELECT &quot; +
                        //Basic menu_data concepts
                        &quot;md.id,&quot; +
                        &quot;patient.public_id AS patientId, &quot; +
                        &quot;md.uniqueid AS uniqueId, &quot; +
                        //Condition-specific fields
                        &quot;md.date01 AS start,&quot; +
                        &quot;md.date02 AS end,&quot; +
                        &quot;md.date03 AS dateAsserted,&quot; +
                        &quot;md.long01 AS diagnosisCodingReceivedId,&quot; +
                        &quot;md.string05 AS category,&quot; +
                        &quot;md.boolean01 AS patientHasCondition, &quot; +
                        //menu_data source information
                        &quot;md.sourceorgid AS menuDataSourceOrgId, &quot; +
                        &quot;md.sourceteamid AS menuDataSourceTeamId, &quot; +
                        &quot;md.sourcepersonid AS menuDataSourcePersonId, &quot; +
                        &quot;md.entereddate AS created, &quot; +
                        &quot;md.persisteddate AS persistedDate, &quot; +
                        &quot;md.uploadeddataid AS uploadedDataId, &quot; +
                        &quot;md.hl7partnerid AS hl7PartnerId, &quot; +
                        &quot;md.route AS route, &quot; +
                        &quot;md.responsibleorganisationidentifier AS responsibleOrganisationIdentifier, &quot; +
                        //privacy_flags information
                        &quot;pf.source_person_id AS pfSourcePersonId, &quot; +
                        &quot;pf.source_team_id AS pfSourceTeamId, &quot; +
                        &quot;pf.source_org_id AS pfSourceOrgId, &quot; +
                        &quot;pf.access_route AS pfAccessRoute, &quot; +
                        &quot;pf.change_date AS pfChangeDate, &quot; +
                        &quot;CASE pf.require_general &quot; +
                        &quot;WHEN false THEN '' &quot; +
                        &quot;WHEN true THEN 'GENERAL_HEALTH' &quot; +
                        &quot;ELSE CASE WHEN md.requiregeneral THEN 'GENERAL_HEALTH' ELSE '' END END AS requireGeneral, &quot; +
                        &quot;CASE pf.require_sexual_health &quot; +
                        &quot;WHEN false THEN '' &quot; +
                        &quot;WHEN true THEN 'SEXUAL_HEALTH' &quot; +
                        &quot;ELSE CASE WHEN md.requiresexualhealth THEN 'SEXUAL_HEALTH' ELSE '' END END AS requireSexualHealth, &quot; +
                        &quot;CASE pf.require_mental_health &quot; +
                        &quot;WHEN false THEN '' &quot; +
                        &quot;WHEN true THEN 'MENTAL_HEALTH' &quot; +
                        &quot;ELSE CASE WHEN md.requirementalhealth THEN 'MENTAL_HEALTH' ELSE '' END END AS requireMentalHealth, &quot; +
                        &quot;CASE pf.require_social_care &quot; +
                        &quot;WHEN false THEN '' &quot; +
                        &quot;WHEN true THEN 'SOCIAL_CARE' &quot; +
                        &quot;ELSE CASE WHEN md.requiresocialcare THEN 'SOCIAL_CARE' ELSE '' END END AS requireSocialCare &quot; +
                        //The actual table joins
                        &quot;FROM app.menu_data md JOIN pkbperson patient ON md.account_id = patient.defaultaccountid &quot; +
                        &quot;LEFT OUTER JOIN privacy_flags pf ON md.uniqueid = pf.uniqueid AND pf.id = (SELECT pf2.id FROM privacy_flags pf2 WHERE md.uniqueid = pf2.uniqueid ORDER BY pf2.change_date DESC, pf2.id DESC LIMIT 1) &quot; +
                        &quot;WHERE md.id IN (:ids)&quot; +
                        &quot;ORDER BY md.id&quot;,
        resultSetMapping = &quot;condition_dto&quot;
)
@SqlResultSetMapping(
        name = &quot;condition_dto&quot;,
        classes = @ConstructorResult(
                targetClass = ConditionEhrDataDto.class,
                columns = {
                        @ColumnResult(name = &quot;id&quot;, type = Long.class),
                        @ColumnResult(name = &quot;patientId&quot;, type = UUID.class),
                        @ColumnResult(name = &quot;uniqueId&quot;, type = UUID.class),
                        @ColumnResult(name = &quot;start&quot;, type = LocalDateTime.class),
                        @ColumnResult(name = &quot;end&quot;, type = LocalDateTime.class),
                        @ColumnResult(name = &quot;dateAsserted&quot;, type = LocalDateTime.class),
                        @ColumnResult(name = &quot;diagnosisCodingReceivedId&quot;, type = Long.class),
                        @ColumnResult(name = &quot;category&quot;, type = String.class),
                        @ColumnResult(name = &quot;patientHasCondition&quot;, type = Boolean.class),
                        @ColumnResult(name = &quot;menuDataSourceOrgId&quot;, type = Long.class),
                        @ColumnResult(name = &quot;menuDataSourceTeamId&quot;, type = Long.class),
                        @ColumnResult(name = &quot;menuDataSourcePersonId&quot;, type = Long.class),
                        @ColumnResult(name = &quot;created&quot;, type = LocalDateTime.class),
                        @ColumnResult(name = &quot;persistedDate&quot;, type = LocalDateTime.class),
                        @ColumnResult(name = &quot;uploadedDataId&quot;, type = Long.class),
                        @ColumnResult(name = &quot;hl7PartnerId&quot;, type = Long.class),
                        @ColumnResult(name = &quot;route&quot;, type = String.class),
                        @ColumnResult(name = &quot;responsibleOrganisationIdentifier&quot;, type = String.class),
                        @ColumnResult(name = &quot;pfSourcePersonId&quot;, type = Long.class),
                        @ColumnResult(name = &quot;pfSourceTeamId&quot;, type = Long.class),
                        @ColumnResult(name = &quot;pfSourceOrgId&quot;, type = Long.class),
                        @ColumnResult(name = &quot;pfAccessRoute&quot;, type = String.class),
                        @ColumnResult(name = &quot;pfChangeDate&quot;, type = LocalDateTime.class),
                        @ColumnResult(name = &quot;requireGeneral&quot;, type = String.class),
                        @ColumnResult(name = &quot;requireSexualHealth&quot;, type = String.class),
                        @ColumnResult(name = &quot;requireMentalHealth&quot;, type = String.class),
                        @ColumnResult(name = &quot;requireSocialCare&quot;, type = String.class)
                }
        )
)
<span class="nc" id="L208">public class SourceEhrDataEntity {</span>
    @Id
    private long id;
    @Column(name = &quot;account_id&quot;, updatable = false)
    private long accountId;
    @Column(name = &quot;encrypted_data&quot;)
    private byte[] encryptedData;
    @Column(name = &quot;symmetric_encryption_key_id&quot;)
    private Long symmetricEncryptionKeyId;
    @Column(name = &quot;symmetric_encryption_nonce_base64&quot;)
    private String nonceBase64;
    @Column(name = &quot;secret_key_algorithm&quot;)
    private String secretKeyAlgorithm;
    @Column(name = &quot;secret_key_inline&quot;)
    private byte[] secretKeyInline;
    @Column(name = &quot;datatype&quot;)
    @Type(type = &quot;com.vladmihalcea.hibernate.type.basic.PostgreSQLEnumType&quot;)
    private MenuDataType dataType;

    @Formula(&quot;(select a.public_id from core.account a where a.id = account_id)&quot;)
    private UUID accountPublicId;

    @Column(name = &quot;long01&quot;)
    private Long selfConnectingId;

    @Column(name = &quot;deleted&quot;)
    private boolean deleted;


    public long getId() {
<span class="nc" id="L238">        return id;</span>
    }

    public void setId(long id) {
<span class="nc" id="L242">        this.id = id;</span>
<span class="nc" id="L243">    }</span>

    public long getAccountId() {
<span class="nc" id="L246">        return accountId;</span>
    }

    public void setAccountId(long accountId) {
<span class="nc" id="L250">        this.accountId = accountId;</span>
<span class="nc" id="L251">    }</span>

    public byte[] getEncryptedData() {
<span class="nc" id="L254">        return encryptedData;</span>
    }

    public void setEncryptedData(byte[] encryptedData) {
<span class="nc" id="L258">        this.encryptedData = encryptedData;</span>
<span class="nc" id="L259">    }</span>


    public UUID getAccountPublicId() {
<span class="nc" id="L263">        return accountPublicId;</span>
    }

    public void setAccountPublicId(UUID accountPublicId) {
<span class="nc" id="L267">        this.accountPublicId = accountPublicId;</span>
<span class="nc" id="L268">    }</span>

    public Long getSymmetricEncryptionKeyId() {
<span class="nc" id="L271">        return symmetricEncryptionKeyId;</span>
    }

    public void setSymmetricEncryptionKeyId(Long symmetricEncryptionKeyId) {
<span class="nc" id="L275">        this.symmetricEncryptionKeyId = symmetricEncryptionKeyId;</span>
<span class="nc" id="L276">    }</span>

    public String getNonceBase64() {
<span class="nc" id="L279">        return nonceBase64;</span>
    }

    public void setNonceBase64(String nonceBase64) {
<span class="nc" id="L283">        this.nonceBase64 = nonceBase64;</span>
<span class="nc" id="L284">    }</span>

    public String getSecretKeyAlgorithm() {
<span class="nc" id="L287">        return secretKeyAlgorithm;</span>
    }

    public void setSecretKeyAlgorithm(String secretKeyAlgorithm) {
<span class="nc" id="L291">        this.secretKeyAlgorithm = secretKeyAlgorithm;</span>
<span class="nc" id="L292">    }</span>

    public byte[] getSecretKeyInline() {
<span class="nc" id="L295">        return secretKeyInline;</span>
    }

    public void setSecretKeyInline(byte[] secretKeyInline) {
<span class="nc" id="L299">        this.secretKeyInline = secretKeyInline;</span>
<span class="nc" id="L300">    }</span>

    public MenuDataType getDataType() {
<span class="nc" id="L303">        return dataType;</span>
    }

    public void setDataType(MenuDataType dataType) {
<span class="nc" id="L307">        this.dataType = dataType;</span>
<span class="nc" id="L308">    }</span>

    public Long getSelfConnectingId() {
<span class="nc" id="L311">        return selfConnectingId;</span>
    }

    public void setSelfConnectingId(Long selfConnectingId) {
<span class="nc" id="L315">        this.selfConnectingId = selfConnectingId;</span>
<span class="nc" id="L316">    }</span>

    public boolean isDeleted() {
<span class="nc" id="L319">        return deleted;</span>
    }

    public void setDeleted(boolean deleted) {
<span class="nc" id="L323">        this.deleted = deleted;</span>
<span class="nc" id="L324">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>